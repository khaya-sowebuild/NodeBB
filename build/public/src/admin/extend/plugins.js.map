{"version":3,"sources":["public/src/admin/extend/plugins.js"],"names":["define","jqueryui","translator","Benchpress","Plugins","init","pluginsList","$","numPlugins","querySelectorAll","length","pluginID","translate","html","append","val","on","pluginEl","this","parents","attr","btn","pluginData","ajaxify","data","installed","toggleActivate","socket","emit","err","status","app","alertError","active","buttonText","toggleClass","prepend","clone","alert","alert_id","title","message","type","timeout","clickfn","require","instance","rebuildAndRestart","license","parse","bootbox","dialog","size","buttons","cancel","label","className","save","callback","toggleInstall","suggest","payload","confirm","compile","responseText","removeAttr","version","confirmInstall","parent","semver","gt","find","text","upgrade","config","term","each","pluginId","indexOf","modal","activePlugins","forEach","plugin","sortable","plugins","children","index","el","push","name","order","populateUpgradeablePlugins","populateActivePlugins","id","isActive","remove","refresh","apply","arguments","nbbVersion","match","ajax","registry","package","dataType","done","undefined","fail","hasClass"],"mappings":"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","file":"public/src/admin/extend/plugins.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('admin/extend/plugins', ['jqueryui', 'translator', 'benchpress'], function (jqueryui, translator, Benchpress) {\r\n\tvar Plugins = {};\r\n\tPlugins.init = function () {\r\n\t\tvar pluginsList = $('.plugins');\r\n\t\tvar numPlugins = pluginsList[0].querySelectorAll('li').length;\r\n\t\tvar pluginID;\r\n\r\n\t\tif (!numPlugins) {\r\n\t\t\ttranslator.translate('<li><p><i>[[admin/extend/plugins:none-found]]</i></p></li>', function (html) {\r\n\t\t\t\tpluginsList.append(html);\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t$('#plugin-search').val('');\r\n\r\n\t\tpluginsList.on('click', 'button[data-action=\"toggleActive\"]', function () {\r\n\t\t\tvar pluginEl = $(this).parents('li');\r\n\t\t\tpluginID = pluginEl.attr('data-plugin-id');\r\n\t\t\tvar btn = $('[id=\"' + pluginID + '\"] [data-action=\"toggleActive\"]');\r\n\r\n\t\t\tvar pluginData = ajaxify.data.installed[pluginEl.attr('data-plugin-index')];\r\n\r\n\t\t\tfunction toggleActivate() {\r\n\t\t\t\tsocket.emit('admin.plugins.toggleActive', pluginID, function (err, status) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\treturn app.alertError(err);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttranslator.translate('<i class=\"fa fa-power-off\"></i> [[admin/extend/plugins:plugin-item.' + (status.active ? 'deactivate' : 'activate') + ']]', function (buttonText) {\r\n\t\t\t\t\t\tbtn.html(buttonText);\r\n\t\t\t\t\t\tbtn.toggleClass('btn-warning', status.active).toggleClass('btn-success', !status.active);\r\n\r\n\t\t\t\t\t\t// clone it to active plugins tab\r\n\t\t\t\t\t\tif (status.active && !$('#active [id=\"' + pluginID + '\"]').length) {\r\n\t\t\t\t\t\t\t$('#active ul').prepend(pluginEl.clone(true));\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Toggle active state in template data\r\n\t\t\t\t\t\tpluginData.active = !pluginData.active;\r\n\r\n\t\t\t\t\t\tapp.alert({\r\n\t\t\t\t\t\t\talert_id: 'plugin_toggled',\r\n\t\t\t\t\t\t\ttitle: '[[admin/extend/plugins:alert.' + (status.active ? 'enabled' : 'disabled') + ']]',\r\n\t\t\t\t\t\t\tmessage: '[[admin/extend/plugins:alert.' + (status.active ? 'activate-success' : 'deactivate-success') + ']]',\r\n\t\t\t\t\t\t\ttype: status.active ? 'warning' : 'success',\r\n\t\t\t\t\t\t\ttimeout: 5000,\r\n\t\t\t\t\t\t\tclickfn: function () {\r\n\t\t\t\t\t\t\t\trequire(['admin/modules/instance'], function (instance) {\r\n\t\t\t\t\t\t\t\t\tinstance.rebuildAndRestart();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (pluginData.license && pluginData.active !== true) {\r\n\t\t\t\tBenchpress.parse('admin/partials/plugins/license', pluginData, function (html) {\r\n\t\t\t\t\tbootbox.dialog({\r\n\t\t\t\t\t\ttitle: '[[admin/extend/plugins:license.title]]',\r\n\t\t\t\t\t\tmessage: html,\r\n\t\t\t\t\t\tsize: 'large',\r\n\t\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\tcancel: {\r\n\t\t\t\t\t\t\t\tlabel: '[[modules:bootbox.cancel]]',\r\n\t\t\t\t\t\t\t\tclassName: 'btn-link',\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tsave: {\r\n\t\t\t\t\t\t\t\tlabel: '[[modules:bootbox.confirm]]',\r\n\t\t\t\t\t\t\t\tclassName: 'btn-primary',\r\n\t\t\t\t\t\t\t\tcallback: toggleActivate,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\ttoggleActivate(pluginID);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tpluginsList.on('click', 'button[data-action=\"toggleInstall\"]', function () {\r\n\t\t\tvar btn = $(this);\r\n\t\t\tbtn.attr('disabled', true);\r\n\t\t\tpluginID = $(this).parents('li').attr('data-plugin-id');\r\n\r\n\t\t\tif ($(this).attr('data-installed') === '1') {\r\n\t\t\t\treturn Plugins.toggleInstall(pluginID, $(this).parents('li').attr('data-version'));\r\n\t\t\t}\r\n\r\n\t\t\tPlugins.suggest(pluginID, function (err, payload) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\tbootbox.confirm(translator.compile('admin/extend/plugins:alert.suggest-error', err.status, err.responseText), function (confirm) {\r\n\t\t\t\t\t\tif (confirm) {\r\n\t\t\t\t\t\t\tPlugins.toggleInstall(pluginID, 'latest');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tbtn.removeAttr('disabled');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (payload.version !== 'latest') {\r\n\t\t\t\t\tPlugins.toggleInstall(pluginID, payload.version);\r\n\t\t\t\t} else if (payload.version === 'latest') {\r\n\t\t\t\t\tconfirmInstall(pluginID, function (confirm) {\r\n\t\t\t\t\t\tif (confirm) {\r\n\t\t\t\t\t\t\tPlugins.toggleInstall(pluginID, 'latest');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tbtn.removeAttr('disabled');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbtn.removeAttr('disabled');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tpluginsList.on('click', 'button[data-action=\"upgrade\"]', function () {\r\n\t\t\tvar btn = $(this);\r\n\t\t\tvar parent = btn.parents('li');\r\n\t\t\tpluginID = parent.attr('data-plugin-id');\r\n\r\n\t\t\tPlugins.suggest(pluginID, function (err, payload) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn bootbox.alert('[[admin/extend/plugins:alert.package-manager-unreachable]]');\r\n\t\t\t\t}\r\n\r\n\t\t\t\trequire(['semver'], function (semver) {\r\n\t\t\t\t\tif (payload.version !== 'latest' && semver.gt(payload.version, parent.find('.currentVersion').text())) {\r\n\t\t\t\t\t\tupgrade(pluginID, btn, payload.version);\r\n\t\t\t\t\t} else if (payload.version === 'latest') {\r\n\t\t\t\t\t\tconfirmInstall(pluginID, function () {\r\n\t\t\t\t\t\t\tupgrade(pluginID, btn, payload.version);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbootbox.alert(translator.compile('admin/extend/plugins:alert.incompatible', app.config.version, payload.version));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('#plugin-search').on('input propertychange', function () {\r\n\t\t\tvar term = $(this).val();\r\n\t\t\t$('.plugins li').each(function () {\r\n\t\t\t\tvar pluginId = $(this).attr('data-plugin-id');\r\n\t\t\t\t$(this).toggleClass('hide', pluginId && pluginId.indexOf(term) === -1);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('#plugin-order').on('click', function () {\r\n\t\t\t$('#order-active-plugins-modal').modal('show');\r\n\t\t\tsocket.emit('admin.plugins.getActive', function (err, activePlugins) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err);\r\n\t\t\t\t}\r\n\t\t\t\tvar html = '';\r\n\t\t\t\tactivePlugins.forEach(function (plugin) {\r\n\t\t\t\t\thtml += '<li class=\"\">' + plugin + '</li>';\r\n\t\t\t\t});\r\n\t\t\t\tif (!activePlugins.length) {\r\n\t\t\t\t\ttranslator.translate('[[admin/extend/plugins:none-active]]', function (text) {\r\n\t\t\t\t\t\t$('#order-active-plugins-modal .plugin-list').html(text).sortable();\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t$('#order-active-plugins-modal .plugin-list').html(html).sortable();\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('#save-plugin-order').on('click', function () {\r\n\t\t\tvar plugins = $('#order-active-plugins-modal .plugin-list').children();\r\n\t\t\tvar data = [];\r\n\t\t\tplugins.each(function (index, el) {\r\n\t\t\t\tdata.push({ name: $(el).text(), order: index });\r\n\t\t\t});\r\n\r\n\t\t\tsocket.emit('admin.plugins.orderActivePlugins', data, function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\t\t\t\t$('#order-active-plugins-modal').modal('hide');\r\n\r\n\t\t\t\tapp.alert({\r\n\t\t\t\t\talert_id: 'plugin_reordered',\r\n\t\t\t\t\ttitle: '[[admin/extend/plugins:alert.reorder]]',\r\n\t\t\t\t\tmessage: '[[admin/extend/plugins:alert.reorder-success]]',\r\n\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\ttimeout: 5000,\r\n\t\t\t\t\tclickfn: function () {\r\n\t\t\t\t\t\trequire(['admin/modules/instance'], function (instance) {\r\n\t\t\t\t\t\t\tinstance.rebuildAndRestart();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tpopulateUpgradeablePlugins();\r\n\t\tpopulateActivePlugins();\r\n\t};\r\n\r\n\tfunction confirmInstall(pluginID, callback) {\r\n\t\tbootbox.confirm(translator.compile('admin/extend/plugins:alert.possibly-incompatible', pluginID), function (confirm) {\r\n\t\t\tcallback(confirm);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction upgrade(pluginID, btn, version) {\r\n\t\tbtn.attr('disabled', true).find('i').attr('class', 'fa fa-refresh fa-spin');\r\n\t\tsocket.emit('admin.plugins.upgrade', {\r\n\t\t\tid: pluginID,\r\n\t\t\tversion: version,\r\n\t\t}, function (err, isActive) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\t\t\tvar parent = btn.parents('li');\r\n\t\t\tparent.find('.fa-exclamation-triangle').remove();\r\n\t\t\tparent.find('.currentVersion').text(version);\r\n\t\t\tbtn.remove();\r\n\t\t\tif (isActive) {\r\n\t\t\t\tapp.alert({\r\n\t\t\t\t\talert_id: 'plugin_upgraded',\r\n\t\t\t\t\ttitle: '[[admin/extend/plugins:alert.upgraded]]',\r\n\t\t\t\t\tmessage: '[[admin/extend/plugins:alert.upgrade-success]]',\r\n\t\t\t\t\ttype: 'warning',\r\n\t\t\t\t\ttimeout: 5000,\r\n\t\t\t\t\tclickfn: function () {\r\n\t\t\t\t\t\trequire(['admin/modules/instance'], function (instance) {\r\n\t\t\t\t\t\t\tinstance.rebuildAndRestart();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tPlugins.toggleInstall = function (pluginID, version, callback) {\r\n\t\tvar btn = $('li[data-plugin-id=\"' + pluginID + '\"] button[data-action=\"toggleInstall\"]');\r\n\t\tbtn.find('i').attr('class', 'fa fa-refresh fa-spin');\r\n\r\n\t\tsocket.emit('admin.plugins.toggleInstall', {\r\n\t\t\tid: pluginID,\r\n\t\t\tversion: version,\r\n\t\t}, function (err, pluginData) {\r\n\t\t\tif (err) {\r\n\t\t\t\tbtn.removeAttr('disabled');\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\r\n\t\t\tajaxify.refresh();\r\n\r\n\t\t\tapp.alert({\r\n\t\t\t\talert_id: 'plugin_toggled',\r\n\t\t\t\ttitle: '[[admin/extend/plugins:alert.' + (pluginData.installed ? 'installed' : 'uninstalled') + ']]',\r\n\t\t\t\tmessage: '[[admin/extend/plugins:alert.' + (pluginData.installed ? 'install-success' : 'uninstall-success') + ']]',\r\n\t\t\t\ttype: 'info',\r\n\t\t\t\ttimeout: 5000,\r\n\t\t\t});\r\n\r\n\t\t\tif (typeof callback === 'function') {\r\n\t\t\t\tcallback.apply(this, arguments);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tPlugins.suggest = function (pluginId, callback) {\r\n\t\tvar nbbVersion = app.config.version.match(/^\\d+\\.\\d+\\.\\d+/);\r\n\t\t$.ajax((app.config.registry || 'https://packages.nodebb.org') + '/api/v1/suggest', {\r\n\t\t\ttype: 'GET',\r\n\t\t\tdata: {\r\n\t\t\t\tpackage: pluginId,\r\n\t\t\t\tversion: nbbVersion[0],\r\n\t\t\t},\r\n\t\t\tdataType: 'json',\r\n\t\t}).done(function (payload) {\r\n\t\t\tcallback(undefined, payload);\r\n\t\t}).fail(callback);\r\n\t};\r\n\r\n\tfunction populateUpgradeablePlugins() {\r\n\t\t$('#installed ul li').each(function () {\r\n\t\t\tif ($(this).children('[data-action=\"upgrade\"]').length) {\r\n\t\t\t\t$('#upgrade ul').append($(this).clone(true));\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction populateActivePlugins() {\r\n\t\t$('#installed ul li').each(function () {\r\n\t\t\tif ($(this).hasClass('active')) {\r\n\t\t\t\t$('#active ul').append($(this).clone(true));\r\n\t\t\t} else {\r\n\t\t\t\t$('#deactive ul').append($(this).clone(true));\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\treturn Plugins;\r\n});\r\n"]}