{"version":3,"sources":["public/src/admin/extend/widgets.js"],"names":["define","Widgets","init","$","on","ev","$this","this","removeClass","parent","addClass","attr","preventDefault","val","trigger","loadWidgetData","setupCloneButton","prepareWidgets","insertAfter","closest","draggable","helper","e","target","parents","clone","distance","connectToSortable","width","css","each","replace","sortable","update","event","ui","createDatePicker","item","appendToggle","connectWith","panel","bootbox","confirm","remove","evt","is","length","children","toggleClass","saveWidgets","saveData","i","el","template","location","area","widgets","find","widgetData","data","serializeArray","d","hasOwnProperty","name","Array","isArray","push","value","widget","socket","emit","err","app","alertError","message","alert","alert_id","type","title","timeout","btn","selector","container","classList","join","className","currentYear","Date","getFullYear","datepicker","changeMonth","changeYear","yearRange","hasClass","droppable","accept","drop","hoverClass","append","html","populateWidget","text","input","prop","get","RELATIVE_PATH","areas","widgetArea","k","widgetEl","cloneBtn","translateHtml","currentTemplate","templateToClone","currentAreas","map","areasToClone","indexOf","undefined","filter","ii","alertSuccess"],"mappings":"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","file":"public/src/admin/extend/widgets.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('admin/extend/widgets', ['jqueryui'], function () {\r\n\tvar Widgets = {};\r\n\r\n\tWidgets.init = function () {\r\n\t\t$('#widgets .nav-pills a').on('click', function (ev) {\r\n\t\t\tvar $this = $(this);\r\n\t\t\t$('#widgets .nav-pills li').removeClass('active');\r\n\t\t\t$this.parent().addClass('active');\r\n\r\n\t\t\t$('#widgets .tab-pane').removeClass('active');\r\n\t\t\t$('#widgets .tab-pane[data-template=\"' + $this.attr('data-template') + '\"]').addClass('active');\r\n\r\n\t\t\tev.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\t$('#widget-selector').on('change', function () {\r\n\t\t\t$('.available-widgets [data-widget]').addClass('hide');\r\n\t\t\t$('.available-widgets [data-widget=\"' + $(this).val() + '\"]').removeClass('hide');\r\n\t\t});\r\n\r\n\t\t$('#widget-selector').trigger('change');\r\n\r\n\t\tloadWidgetData();\r\n\t\tsetupCloneButton();\r\n\t};\r\n\r\n\tfunction prepareWidgets() {\r\n\t\t$('[data-location=\"drafts\"]').insertAfter($('[data-location=\"drafts\"]').closest('.tab-content'));\r\n\r\n\t\t$('#widgets .available-widgets .widget-panel').draggable({\r\n\t\t\thelper: function (e) {\r\n\t\t\t\treturn $(e.target).parents('.widget-panel').clone();\r\n\t\t\t},\r\n\t\t\tdistance: 10,\r\n\t\t\tconnectToSortable: '.widget-area',\r\n\t\t});\r\n\r\n\t\t$('#widgets .available-containers .containers > [data-container-html]')\r\n\t\t\t.draggable({\r\n\t\t\t\thelper: function (e) {\r\n\t\t\t\t\tvar target = $(e.target);\r\n\t\t\t\t\ttarget = target.attr('data-container-html') ? target : target.parents('[data-container-html]');\r\n\r\n\t\t\t\t\treturn target.clone().addClass('block').width(target.width()).css('opacity', '0.5');\r\n\t\t\t\t},\r\n\t\t\t\tdistance: 10,\r\n\t\t\t})\r\n\t\t\t.each(function () {\r\n\t\t\t\t$(this).attr('data-container-html', $(this).attr('data-container-html').replace(/\\\\\\{([\\s\\S]*?)\\\\\\}/g, '{$1}'));\r\n\t\t\t});\r\n\r\n\t\t$('#widgets .widget-area').sortable({\r\n\t\t\tupdate: function (event, ui) {\r\n\t\t\t\tcreateDatePicker(ui.item);\r\n\t\t\t\tappendToggle(ui.item);\r\n\t\t\t},\r\n\t\t\tconnectWith: 'div',\r\n\t\t}).on('click', '.delete-widget', function () {\r\n\t\t\tvar panel = $(this).parents('.widget-panel');\r\n\r\n\t\t\tbootbox.confirm('[[admin/extend/widgets:alert.confirm-delete]]', function (confirm) {\r\n\t\t\t\tif (confirm) {\r\n\t\t\t\t\tpanel.remove();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}).on('mouseup', '> .panel > .panel-heading', function (evt) {\r\n\t\t\tif (!($(this).parent().is('.ui-sortable-helper') || $(evt.target).closest('.delete-widget').length)) {\r\n\t\t\t\t$(this).parent().children('.panel-body').toggleClass('hidden');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$('#save').on('click', saveWidgets);\r\n\r\n\t\tfunction saveWidgets() {\r\n\t\t\tvar saveData = [];\r\n\t\t\t$('#widgets [data-template][data-location]').each(function (i, el) {\r\n\t\t\t\tel = $(el);\r\n\r\n\t\t\t\tvar template = el.attr('data-template');\r\n\t\t\t\tvar location = el.attr('data-location');\r\n\t\t\t\tvar area = el.children('.widget-area');\r\n\t\t\t\tvar widgets = [];\r\n\r\n\t\t\t\tarea.find('.widget-panel[data-widget]').each(function () {\r\n\t\t\t\t\tvar widgetData = {};\r\n\t\t\t\t\tvar data = $(this).find('form').serializeArray();\r\n\r\n\t\t\t\t\tfor (var d in data) {\r\n\t\t\t\t\t\tif (data.hasOwnProperty(d)) {\r\n\t\t\t\t\t\t\tif (data[d].name) {\r\n\t\t\t\t\t\t\t\tif (widgetData[data[d].name]) {\r\n\t\t\t\t\t\t\t\t\tif (!Array.isArray(widgetData[data[d].name])) {\r\n\t\t\t\t\t\t\t\t\t\twidgetData[data[d].name] = [\r\n\t\t\t\t\t\t\t\t\t\t\twidgetData[data[d].name],\r\n\t\t\t\t\t\t\t\t\t\t];\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\twidgetData[data[d].name].push(data[d].value);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\twidgetData[data[d].name] = data[d].value;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\twidgets.push({\r\n\t\t\t\t\t\twidget: $(this).attr('data-widget'),\r\n\t\t\t\t\t\tdata: widgetData,\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\tsaveData.push({\r\n\t\t\t\t\ttemplate: template,\r\n\t\t\t\t\tlocation: location,\r\n\t\t\t\t\twidgets: widgets,\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tsocket.emit('admin.widgets.set', saveData, function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\tapp.alertError(err.message);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tapp.alert({\r\n\t\t\t\t\talert_id: 'admin:widgets',\r\n\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\ttitle: '[[admin/extend/widgets:alert.updated]]',\r\n\t\t\t\t\tmessage: '[[admin/extend/widgets:alert.update-success]]',\r\n\t\t\t\t\ttimeout: 2500,\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t$('.color-selector').on('click', '.btn', function () {\r\n\t\t\tvar btn = $(this);\r\n\t\t\tvar selector = btn.parents('.color-selector');\r\n\t\t\tvar container = selector.parents('[data-container-html]');\r\n\t\t\tvar classList = [];\r\n\r\n\t\t\tselector.children().each(function () {\r\n\t\t\t\tclassList.push($(this).attr('data-class'));\r\n\t\t\t});\r\n\r\n\t\t\tcontainer\r\n\t\t\t\t.removeClass(classList.join(' '))\r\n\t\t\t\t.addClass(btn.attr('data-class'));\r\n\r\n\t\t\tcontainer.attr('data-container-html', container.attr('data-container-html')\r\n\t\t\t\t.replace(/class=\"[a-zA-Z0-9-\\s]+\"/, 'class=\"' + container[0].className.replace(' pointer ui-draggable ui-draggable-handle', '') + '\"'));\r\n\t\t});\r\n\t}\r\n\r\n\tfunction createDatePicker(el) {\r\n\t\tvar currentYear = new Date().getFullYear();\r\n\t\tel.find('.date-selector').datepicker({\r\n\t\t\tchangeMonth: true,\r\n\t\t\tchangeYear: true,\r\n\t\t\tyearRange: currentYear + ':' + (currentYear + 100),\r\n\t\t});\r\n\t}\r\n\r\n\tfunction appendToggle(el) {\r\n\t\tif (!el.hasClass('block')) {\r\n\t\t\tel.addClass('block').css('width', '').css('height', '')\r\n\t\t\t\t.droppable({\r\n\t\t\t\t\taccept: '[data-container-html]',\r\n\t\t\t\t\tdrop: function (event, ui) {\r\n\t\t\t\t\t\tvar el = $(this);\r\n\r\n\t\t\t\t\t\tel.find('.panel-body .container-html').val(ui.draggable.attr('data-container-html'));\r\n\t\t\t\t\t\tel.find('.panel-body').removeClass('hidden');\r\n\t\t\t\t\t},\r\n\t\t\t\t\thoverClass: 'panel-info',\r\n\t\t\t\t})\r\n\t\t\t\t.children('.panel-heading')\r\n\t\t\t\t.append('<div class=\"pull-right pointer\"><span class=\"delete-widget\"><i class=\"fa fa-times-circle\"></i></span></div><div class=\"pull-left pointer\"><span class=\"toggle-widget\"><i class=\"fa fa-chevron-circle-down\"></i></span>&nbsp;</div>')\r\n\t\t\t\t.children('small').html('');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction loadWidgetData() {\r\n\t\tfunction populateWidget(widget, data) {\r\n\t\t\tif (data.title) {\r\n\t\t\t\tvar title = widget.find('.panel-heading strong');\r\n\t\t\t\ttitle.text(title.text() + ' - ' + data.title);\r\n\t\t\t}\r\n\r\n\t\t\twidget.find('input, textarea, select').each(function () {\r\n\t\t\t\tvar input = $(this);\r\n\t\t\t\tvar value = data[input.attr('name')];\r\n\r\n\t\t\t\tif (input.attr('type') === 'checkbox') {\r\n\t\t\t\t\tinput.prop('checked', !!value).trigger('change');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tinput.val(value);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn widget;\r\n\t\t}\r\n\r\n\t\t$.get(RELATIVE_PATH + '/api/admin/extend/widgets', function (data) {\r\n\t\t\tvar areas = data.areas;\r\n\r\n\t\t\tfor (var i = 0; i < areas.length; i += 1) {\r\n\t\t\t\tvar area = areas[i];\r\n\t\t\t\tvar widgetArea = $('#widgets .area[data-template=\"' + area.template + '\"][data-location=\"' + area.location + '\"]').find('.widget-area');\r\n\r\n\t\t\t\twidgetArea.html('');\r\n\r\n\t\t\t\tfor (var k = 0; k < area.data.length; k += 1) {\r\n\t\t\t\t\tvar widgetData = area.data[k];\r\n\t\t\t\t\tvar widgetEl = $('.available-widgets [data-widget=\"' + widgetData.widget + '\"]').clone(true).removeClass('hide');\r\n\r\n\t\t\t\t\twidgetArea.append(populateWidget(widgetEl, widgetData.data));\r\n\t\t\t\t\tappendToggle(widgetEl);\r\n\t\t\t\t\tcreateDatePicker(widgetEl);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tprepareWidgets();\r\n\t\t});\r\n\t}\r\n\r\n\tfunction setupCloneButton() {\r\n\t\tvar clone = $('[component=\"clone\"]');\r\n\t\tvar cloneBtn = $('[component=\"clone/button\"]');\r\n\r\n\t\tclone.find('.dropdown-menu li').on('click', function () {\r\n\t\t\tvar template = $(this).find('a').text();\r\n\t\t\tcloneBtn.translateHtml('[[admin/extend/widgets:clone-from]] <strong>' + template + '</strong>');\r\n\t\t\tcloneBtn.attr('data-template', template);\r\n\t\t});\r\n\r\n\t\tcloneBtn.on('click', function () {\r\n\t\t\tvar template = cloneBtn.attr('data-template');\r\n\t\t\tif (!template) {\r\n\t\t\t\treturn app.alertError('[[admin/extend/widgets:error.select-clone]]');\r\n\t\t\t}\r\n\r\n\t\t\tvar currentTemplate = $('#active-widgets .active.tab-pane[data-template] .area');\r\n\t\t\tvar templateToClone = $('#active-widgets .tab-pane[data-template=\"' + template + '\"] .area');\r\n\r\n\t\t\tvar currentAreas = currentTemplate.map(function () {\r\n\t\t\t\treturn $(this).attr('data-location');\r\n\t\t\t}).get();\r\n\r\n\t\t\tvar areasToClone = templateToClone.map(function () {\r\n\t\t\t\tvar location = $(this).attr('data-location');\r\n\t\t\t\treturn currentAreas.indexOf(location) !== -1 ? location : undefined;\r\n\t\t\t}).get().filter(function (i) { return i; });\r\n\r\n\t\t\tfunction clone(location) {\r\n\t\t\t\t$('#active-widgets .tab-pane[data-template=\"' + template + '\"] [data-location=\"' + location + '\"]').each(function () {\r\n\t\t\t\t\t$(this).find('[data-widget]').each(function () {\r\n\t\t\t\t\t\tvar widget = $(this).clone(true);\r\n\t\t\t\t\t\t$('#active-widgets .active.tab-pane[data-template]:not([data-template=\"global\"]) [data-location=\"' + location + '\"] .widget-area').append(widget);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0, ii = areasToClone.length; i < ii; i++) {\r\n\t\t\t\tvar location = areasToClone[i];\r\n\t\t\t\tclone(location);\r\n\t\t\t}\r\n\r\n\t\t\tapp.alertSuccess('[[admin/extend/widgets:alert.clone-success]]');\r\n\t\t});\r\n\t}\r\n\r\n\treturn Widgets;\r\n});\r\n"]}