{"version":3,"sources":["public/src/admin/general/navigation.js"],"names":["define","translator","iconSelect","Benchpress","navigation","available","init","ajaxify","data","$","each","this","val","unescape","translate","html","find","draggable","connectToSortable","helper","distance","stop","drop","sortable","droppable","accept","on","iconEl","el","newIconClass","attr","index","parents","siblings","toggleClass","onSelect","remove","toggle","save","clickedIndex","removeClass","addClass","detailsForm","children","length","ev","ui","id","iconClass","enabled","parseInt","last","title","escape","text","parse","li","after","append","componentHandler","upgradeDom","nav","indices","push","forEach","form","serializeArray","properties","input","name","slice","value","prop","hasOwnProperty","socket","emit","err","app","alertError","message","alertSuccess","btn","disabled","hasClass"],"mappings":"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","file":"public/src/admin/general/navigation.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('admin/general/navigation', ['translator', 'iconSelect', 'benchpress', 'jqueryui'], function (translator, iconSelect, Benchpress) {\r\n\tvar navigation = {};\r\n\tvar available;\r\n\r\n\tnavigation.init = function () {\r\n\t\tavailable = ajaxify.data.available;\r\n\r\n\t\t$('#enabled .unescape').each(function () {\r\n\t\t\t$(this).val(translator.unescape($(this).val()));\r\n\t\t});\r\n\r\n\t\ttranslator.translate($('#available').html(), function (html) {\r\n\t\t\t$('#available').html(translator.unescape(html))\r\n\t\t\t\t.find('li .drag-item').draggable({\r\n\t\t\t\t\tconnectToSortable: '#active-navigation',\r\n\t\t\t\t\thelper: 'clone',\r\n\t\t\t\t\tdistance: 10,\r\n\t\t\t\t\tstop: drop,\r\n\t\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('#active-navigation').sortable().droppable({\r\n\t\t\taccept: $('#available li .drag-item'),\r\n\t\t});\r\n\r\n\t\t$('#enabled').on('click', '.iconPicker', function () {\r\n\t\t\tvar iconEl = $(this).find('i');\r\n\t\t\ticonSelect.init(iconEl, function (el) {\r\n\t\t\t\tvar newIconClass = el.attr('value');\r\n\t\t\t\tvar index = iconEl.parents('[data-index]').attr('data-index');\r\n\t\t\t\t$('#active-navigation [data-index=\"' + index + '\"] i').attr('class', 'fa fa-fw ' + newIconClass);\r\n\t\t\t\ticonEl.siblings('[name=\"iconClass\"]').val(newIconClass);\r\n\t\t\t\ticonEl.siblings('.change-icon-link').toggleClass('hidden', !!newIconClass);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('#active-navigation').on('click', 'li', onSelect);\r\n\r\n\t\t$('#enabled')\r\n\t\t\t.on('click', '.delete', remove)\r\n\t\t\t.on('click', '.toggle', toggle);\r\n\r\n\t\t$('#save').on('click', save);\r\n\t};\r\n\r\n\tfunction onSelect() {\r\n\t\tvar clickedIndex = $(this).attr('data-index');\r\n\t\t$('#active-navigation li').removeClass('active');\r\n\t\t$(this).addClass('active');\r\n\r\n\t\tvar detailsForm = $('#enabled').children('[data-index=\"' + clickedIndex + '\"]');\r\n\t\t$('#enabled li').addClass('hidden');\r\n\r\n\t\tif (detailsForm.length) {\r\n\t\t\tdetailsForm.removeClass('hidden');\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction drop(ev, ui) {\r\n\t\tvar id = ui.helper.attr('data-id');\r\n\t\tvar el = $('#active-navigation [data-id=\"' + id + '\"]');\r\n\t\tvar data = id === 'custom' ? { iconClass: 'fa-navicon' } : available[id];\r\n\r\n\t\tdata.enabled = false;\r\n\t\tdata.index = (parseInt($('#enabled').children().last().attr('data-index'), 10) || 0) + 1;\r\n\t\tdata.title = translator.escape(data.title);\r\n\t\tdata.text = translator.escape(data.text);\r\n\t\tBenchpress.parse('admin/general/navigation', 'navigation', { navigation: [data] }, function (li) {\r\n\t\t\ttranslator.translate(li, function (li) {\r\n\t\t\t\tli = $(translator.unescape(li));\r\n\t\t\t\tel.after(li);\r\n\t\t\t\tel.remove();\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tBenchpress.parse('admin/general/navigation', 'enabled', { enabled: [data] }, function (li) {\r\n\t\t\ttranslator.translate(li, function (li) {\r\n\t\t\t\tli = $(translator.unescape(li));\r\n\t\t\t\t$('#enabled').append(li);\r\n\t\t\t\tcomponentHandler.upgradeDom();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction save() {\r\n\t\tvar nav = [];\r\n\r\n\t\tvar indices = [];\r\n\t\t$('#active-navigation li').each(function () {\r\n\t\t\tindices.push($(this).attr('data-index'));\r\n\t\t});\r\n\r\n\t\tindices.forEach(function (index) {\r\n\t\t\tvar el = $('#enabled').children('[data-index=\"' + index + '\"]');\r\n\t\t\tvar form = el.find('form').serializeArray();\r\n\t\t\tvar data = {};\r\n\t\t\tvar properties = {};\r\n\r\n\t\t\tform.forEach(function (input) {\r\n\t\t\t\tif (input.name.slice(0, 9) === 'property:' && input.value === 'on') {\r\n\t\t\t\t\tproperties[input.name.slice(9)] = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdata[input.name] = translator.escape(input.value);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tdata.properties = {};\r\n\r\n\t\t\tfor (var prop in properties) {\r\n\t\t\t\tif (properties.hasOwnProperty(prop)) {\r\n\t\t\t\t\tdata.properties[prop] = properties[prop];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tnav.push(data);\r\n\t\t});\r\n\r\n\t\tsocket.emit('admin.navigation.save', nav, function (err) {\r\n\t\t\tif (err) {\r\n\t\t\t\tapp.alertError(err.message);\r\n\t\t\t} else {\r\n\t\t\t\tapp.alertSuccess('Successfully saved navigation');\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction remove() {\r\n\t\tvar index = $(this).parents('[data-index]').attr('data-index');\r\n\t\t$('#active-navigation [data-index=\"' + index + '\"]').remove();\r\n\t\t$('#enabled [data-index=\"' + index + '\"]').remove();\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction toggle() {\r\n\t\tvar btn = $(this);\r\n\t\tvar disabled = btn.hasClass('btn-success');\r\n\t\ttranslator.translate(disabled ? '[[admin/general/navigation:btn.disable]]' : '[[admin/general/navigation:btn.enable]]', function (html) {\r\n\t\t\tbtn.toggleClass('btn-warning').toggleClass('btn-success').html(html);\r\n\t\t\tbtn.parents('li').find('[name=\"enabled\"]').val(disabled ? 'on' : '');\r\n\t\t});\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn navigation;\r\n});\r\n"]}