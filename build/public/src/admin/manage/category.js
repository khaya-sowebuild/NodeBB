"use strict";define("admin/manage/category",["uploader","iconSelect","admin/modules/colorpicker","autocomplete","translator","categorySelector","benchpress"],function(a,e,t,n,i,r,o){var c={};var s={};c.init=function(){$("#category-settings select").each(function(){var a=$(this);a.val(a.attr("data-value"))});$("#category-selector").on("change",function(){ajaxify.go("admin/manage/categories/"+$(this).val()+window.location.hash)});function n(a,e){var n=$(e);var i=n.parents("[data-cid]").find(".category-preview");t.enable(n,function(a,e){if(n.attr("data-name")==="bgColor"){i.css("background-color","#"+e)}else if(n.attr("data-name")==="color"){i.css("color","#"+e)}d(n[0])})}l();$("#category-settings input, #category-settings select").not($(".privilege-table-container input")).on("change",function(a){d(a.target)}).on("keydown",function(a){if(a.which===13){a.preventDefault();return false}});$('[data-name="imageClass"]').on("change",function(){$(".category-preview").css("background-size",$(this).val())});$('[data-name="bgColor"], [data-name="color"]').each(n);$("#save").on("click",function(){if(Object.keys(s).length){socket.emit("admin.categories.update",s,function(a,e){if(a){return app.alertError(a.message)}if(e&&e.length){app.flags._unsaved=false;app.alert({title:"Updated Categories",message:"Category IDs "+e.join(", ")+" was successfully updated.",type:"success",timeout:2e3})}});s={}}return false});$(".purge").on("click",function(a){a.preventDefault();o.parse("admin/partials/categories/purge",{name:ajaxify.data.category.name,topic_count:ajaxify.data.category.topic_count},function(a){var e=bootbox.dialog({title:"[[admin/manage/categories:purge]]",message:a,size:"large",buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){e.find(".modal-footer button").prop("disabled",true);var a=setInterval(function(){socket.emit("categories.getTopicCount",ajaxify.data.category.cid,function(a,t){if(a){return app.alertError(a)}var n=0;if(ajaxify.data.category.topic_count>0){n=Math.max(0,1-t/ajaxify.data.category.topic_count)*100}e.find(".progress-bar").css({width:n+"%"})})},1e3);socket.emit("admin.categories.purge",ajaxify.data.category.cid,function(t){if(t){return app.alertError(t.message)}if(a){clearInterval(a)}e.modal("hide");app.alertSuccess("[[admin/manage/categories:alert.purge-success]]");ajaxify.go("admin/manage/categories")});return false}}}})})});$(".copy-settings").on("click",function(){r.modal(function(a){socket.emit("admin.categories.copySettingsFrom",{fromCid:a,toCid:ajaxify.data.category.cid},function(a){if(a){return app.alertError(a.message)}app.alertSuccess("[[admin/manage/categories:alert.copy-success]]");ajaxify.refresh()})});return false});$(".upload-button").on("click",function(){var e=$(this);var t=e.attr("data-cid");a.show({title:"[[admin/manage/categories:alert.upload-image]]",route:config.relative_path+"/api/admin/category/uploadpicture",params:{cid:t}},function(a){$("#category-image").val(a);var t=e.parent().parent().siblings(".category-preview");t.css("background","url("+a+"?"+(new Date).getTime()+")");d($("#category-image"))})});$("#category-image").on("change",function(){$(".category-preview").css("background-image",$(this).val()?'url("'+$(this).val()+'")':"")});$(".delete-image").on("click",function(a){a.preventDefault();var e=$("#category-image");var t=$(".category-preview");e.val("");t.css("background-image","");d(e[0]);$(this).parent().addClass("hide").hide()});$(".category-preview").on("click",function(){e.init($(this).find("i"),d)});$('[type="checkbox"]').on("change",function(){d($(this))});$('button[data-action="setParent"], button[data-action="changeParent"]').on("click",c.launchParentSelector);$('button[data-action="removeParent"]').on("click",function(){var a={};a[ajaxify.data.category.cid]={parentCid:0};socket.emit("admin.categories.update",a,function(a){if(a){return app.alertError(a.message)}$('button[data-action="removeParent"]').parent().addClass("hide");$('button[data-action="changeParent"]').parent().addClass("hide");$('button[data-action="setParent"]').removeClass("hide")})})};function d(a){var e=ajaxify.data.category.cid;if(e){var t;if($(a).is(":checkbox")){t=$(a).is(":checked")?1:0}else{t=$(a).val()}s[e]=s[e]||{};s[e][$(a).attr("data-name")]=t;app.flags=app.flags||{};app.flags._unsaved=true}}function l(){var a=$("#tag-whitelist");a.tagsinput({confirmKeys:[13,44],trimValue:true});ajaxify.data.category.tagWhitelist.forEach(function(e){a.tagsinput("add",e)});a.on("itemAdded itemRemoved",function(){d(a)})}c.launchParentSelector=function(){var a=ajaxify.data.allCategories.filter(function(a){return a&&!a.disabled&&parseInt(a.cid,10)!==parseInt(ajaxify.data.category.cid,10)});r.modal(a,function(a){var e={};e[ajaxify.data.category.cid]={parentCid:a};socket.emit("admin.categories.update",e,function(e){if(e){return app.alertError(e.message)}var t=ajaxify.data.allCategories.filter(function(e){return e&&parseInt(e.cid,10)===parseInt(a,10)});t=t[0];$('button[data-action="removeParent"]').parent().removeClass("hide");$('button[data-action="setParent"]').addClass("hide");var n='<i class="fa '+t.icon+'"></i> '+t.name;$('button[data-action="changeParent"]').html(n).parent().removeClass("hide")})})};return c});
//# sourceMappingURL=public/src/admin/manage/category.js.map