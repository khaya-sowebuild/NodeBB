{"version":3,"sources":["public/src/admin/manage/users.js"],"names":["define","translator","Benchpress","Users","init","navPills","$","pathname","window","location","find","length","config","relative_path","removeClass","parent","addClass","getSelectedUids","uids","each","this","is","push","attr","update","className","state","parents","toggleClass","unselectAll","prop","removeSelected","remove","done","successMessage","flag","err","app","alertError","message","alertSuccess","on","bootbox","confirm","socket","emit","reason","parse","html","dialog","title","show","buttons","close","label","submit","callback","formData","serializeArray","reduce","data","cur","name","value","until","Date","now","parseInt","unit","ajaxify","refresh","handleUserCreate","onEscape","cancel","create","createUser","call","modal","username","document","getElementById","email","password","passwordAgain","errorEl","translateHtml","user","timeoutId","clearTimeout","$this","type","setTimeout","searchBy","query","val","translate","not","first","after","timeago","users","compile","timing","handleInvite","prompt"],"mappings":"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","file":"public/src/admin/manage/users.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('admin/manage/users', ['translator', 'benchpress'], function (translator, Benchpress) {\r\n\tvar Users = {};\r\n\r\n\tUsers.init = function () {\r\n\t\tvar navPills = $('.nav-pills li');\r\n\t\tvar pathname = window.location.pathname;\r\n\t\tif (!navPills.find('a[href=\"' + pathname + '\"]').length) {\r\n\t\t\tpathname = config.relative_path + '/admin/manage/users/latest';\r\n\t\t}\r\n\t\tnavPills.removeClass('active').find('a[href=\"' + pathname + '\"]').parent().addClass('active');\r\n\r\n\t\tfunction getSelectedUids() {\r\n\t\t\tvar uids = [];\r\n\r\n\t\t\t$('.users-table [component=\"user/select/single\"]').each(function () {\r\n\t\t\t\tif ($(this).is(':checked')) {\r\n\t\t\t\t\tuids.push($(this).attr('data-uid'));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn uids;\r\n\t\t}\r\n\r\n\t\tfunction update(className, state) {\r\n\t\t\t$('.users-table [component=\"user/select/single\"]:checked').parents('.user-row').find(className).each(function () {\r\n\t\t\t\t$(this).toggleClass('hidden', !state);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction unselectAll() {\r\n\t\t\t$('.users-table [component=\"user/select/single\"]').prop('checked', false);\r\n\t\t\t$('.users-table [component=\"user/select/all\"]').prop('checked', false);\r\n\t\t}\r\n\r\n\t\tfunction removeSelected() {\r\n\t\t\t$('.users-table [component=\"user/select/single\"]:checked').parents('.user-row').remove();\r\n\t\t}\r\n\r\n\t\tfunction done(successMessage, className, flag) {\r\n\t\t\treturn function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\t\t\t\tapp.alertSuccess(successMessage);\r\n\t\t\t\tif (className) {\r\n\t\t\t\t\tupdate(className, flag);\r\n\t\t\t\t}\r\n\t\t\t\tunselectAll();\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t$('[component=\"user/select/all\"]').on('click', function () {\r\n\t\t\tif ($(this).is(':checked')) {\r\n\t\t\t\t$('.users-table [component=\"user/select/single\"]').prop('checked', true);\r\n\t\t\t} else {\r\n\t\t\t\t$('.users-table [component=\"user/select/single\"]').prop('checked', false);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$('.ban-user').on('click', function () {\r\n\t\t\tvar uids = getSelectedUids();\r\n\t\t\tif (!uids.length) {\r\n\t\t\t\tapp.alertError('[[error:no-users-selected]]');\r\n\t\t\t\treturn false;\t// specifically to keep the menu open\r\n\t\t\t}\r\n\r\n\t\t\tbootbox.confirm((uids.length > 1 ? '[[admin/manage/users:alerts.confirm-ban-multi]]' : '[[admin/manage/users:alerts.confirm-ban]]'), function (confirm) {\r\n\t\t\t\tif (confirm) {\r\n\t\t\t\t\tsocket.emit('user.banUsers', { uids: uids, reason: '' }, done('[[admin/manage/users:alerts.ban-success]]', '.ban', true));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.ban-user-temporary').on('click', function () {\r\n\t\t\tvar uids = getSelectedUids();\r\n\t\t\tif (!uids.length) {\r\n\t\t\t\tapp.alertError('[[error:no-users-selected]]');\r\n\t\t\t\treturn false;\t// specifically to keep the menu open\r\n\t\t\t}\r\n\r\n\t\t\tBenchpress.parse('admin/partials/temporary-ban', {}, function (html) {\r\n\t\t\t\tbootbox.dialog({\r\n\t\t\t\t\tclassName: 'ban-modal',\r\n\t\t\t\t\ttitle: '[[user:ban_account]]',\r\n\t\t\t\t\tmessage: html,\r\n\t\t\t\t\tshow: true,\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tclose: {\r\n\t\t\t\t\t\t\tlabel: '[[global:close]]',\r\n\t\t\t\t\t\t\tclassName: 'btn-link',\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsubmit: {\r\n\t\t\t\t\t\t\tlabel: '[[admin/manage/users:alerts.button-ban-x, ' + uids.length + ']]',\r\n\t\t\t\t\t\t\tcallback: function () {\r\n\t\t\t\t\t\t\t\tvar formData = $('.ban-modal form').serializeArray().reduce(function (data, cur) {\r\n\t\t\t\t\t\t\t\t\tdata[cur.name] = cur.value;\r\n\t\t\t\t\t\t\t\t\treturn data;\r\n\t\t\t\t\t\t\t\t}, {});\r\n\t\t\t\t\t\t\t\tvar until = formData.length > 0 ? (Date.now() + (formData.length * 1000 * 60 * 60 * (parseInt(formData.unit, 10) ? 24 : 1))) : 0;\r\n\t\t\t\t\t\t\t\tsocket.emit('user.banUsers', { uids: uids, until: until, reason: formData.reason }, done('[[admin/manage/users:alerts.ban-success]]', '.ban', true));\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.unban-user').on('click', function () {\r\n\t\t\tvar uids = getSelectedUids();\r\n\t\t\tif (!uids.length) {\r\n\t\t\t\tapp.alertError('[[error:no-users-selected]]');\r\n\t\t\t\treturn false;\t// specifically to keep the menu open\r\n\t\t\t}\r\n\r\n\t\t\tsocket.emit('user.unbanUsers', uids, done('[[admin/manage/users:alerts.unban-success]]', '.ban', false));\r\n\t\t});\r\n\r\n\t\t$('.reset-lockout').on('click', function () {\r\n\t\t\tvar uids = getSelectedUids();\r\n\t\t\tif (!uids.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tsocket.emit('admin.user.resetLockouts', uids, done('[[admin/manage/users:alerts.lockout-reset-success]]'));\r\n\t\t});\r\n\r\n\t\t$('.validate-email').on('click', function () {\r\n\t\t\tvar uids = getSelectedUids();\r\n\t\t\tif (!uids.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-validate-email]]', function (confirm) {\r\n\t\t\t\tif (!confirm) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tsocket.emit('admin.user.validateEmail', uids, function (err) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.validate-email-success]]');\r\n\t\t\t\t\tupdate('.notvalidated', false);\r\n\t\t\t\t\tupdate('.validated', true);\r\n\t\t\t\t\tunselectAll();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.send-validation-email').on('click', function () {\r\n\t\t\tvar uids = getSelectedUids();\r\n\t\t\tif (!uids.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tsocket.emit('admin.user.sendValidationEmail', uids, function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\t\t\t\tapp.alertSuccess('[[notifications:email-confirm-sent]]');\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.password-reset-email').on('click', function () {\r\n\t\t\tvar uids = getSelectedUids();\r\n\t\t\tif (!uids.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.password-reset-confirm]]', function (confirm) {\r\n\t\t\t\tif (confirm) {\r\n\t\t\t\t\tsocket.emit('admin.user.sendPasswordResetEmail', uids, done('[[notifications:email-confirm-sent]]'));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.delete-user').on('click', function () {\r\n\t\t\tvar uids = getSelectedUids();\r\n\t\t\tif (!uids.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-delete]]', function (confirm) {\r\n\t\t\t\tif (confirm) {\r\n\t\t\t\t\tsocket.emit('admin.user.deleteUsers', uids, function (err) {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.delete-success]]');\r\n\t\t\t\t\t\tremoveSelected();\r\n\t\t\t\t\t\tunselectAll();\r\n\t\t\t\t\t\tif (!$('.users-table [component=\"user/select/single\"]').length) {\r\n\t\t\t\t\t\t\tajaxify.refresh();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.delete-user-and-content').on('click', function () {\r\n\t\t\tvar uids = getSelectedUids();\r\n\t\t\tif (!uids.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-purge]]', function (confirm) {\r\n\t\t\t\tif (confirm) {\r\n\t\t\t\t\tsocket.emit('admin.user.deleteUsersAndContent', uids, function (err) {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.delete-success]]');\r\n\t\t\t\t\t\tremoveSelected();\r\n\t\t\t\t\t\tunselectAll();\r\n\t\t\t\t\t\tif (!$('.users-table [component=\"user/select/single\"]').length) {\r\n\t\t\t\t\t\t\tajaxify.refresh();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tfunction handleUserCreate() {\r\n\t\t\t$('#createUser').on('click', function () {\r\n\t\t\t\tBenchpress.parse('admin/partials/create_user_modal', {}, function (html) {\r\n\t\t\t\t\tbootbox.dialog({\r\n\t\t\t\t\t\tmessage: html,\r\n\t\t\t\t\t\ttitle: '[[admin/manage/users:alerts.create]]',\r\n\t\t\t\t\t\tonEscape: true,\r\n\t\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\tcancel: {\r\n\t\t\t\t\t\t\t\tlabel: '[[admin/manage/users:alerts.button-cancel]]',\r\n\t\t\t\t\t\t\t\tclassName: 'btn-link',\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcreate: {\r\n\t\t\t\t\t\t\t\tlabel: '[[admin/manage/users:alerts.button-create]]',\r\n\t\t\t\t\t\t\t\tclassName: 'btn-primary',\r\n\t\t\t\t\t\t\t\tcallback: function () {\r\n\t\t\t\t\t\t\t\t\tcreateUser.call(this);\r\n\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction createUser() {\r\n\t\t\tvar modal = this;\r\n\t\t\tvar username = document.getElementById('create-user-name').value;\r\n\t\t\tvar email = document.getElementById('create-user-email').value;\r\n\t\t\tvar password = document.getElementById('create-user-password').value;\r\n\t\t\tvar passwordAgain = document.getElementById('create-user-password-again').value;\r\n\r\n\t\t\tvar errorEl = $('#create-modal-error');\r\n\r\n\t\t\tif (password !== passwordAgain) {\r\n\t\t\t\treturn errorEl.translateHtml('[[admin/manage/users:alerts.error-x, [[admin/manage/users:alerts.error-passwords-different]]]]').removeClass('hide');\r\n\t\t\t}\r\n\r\n\t\t\tvar user = {\r\n\t\t\t\tusername: username,\r\n\t\t\t\temail: email,\r\n\t\t\t\tpassword: password,\r\n\t\t\t};\r\n\r\n\t\t\tsocket.emit('admin.user.createUser', user, function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn errorEl.translateHtml('[[admin/manage/users:alerts.error-x, ' + err.message + ']]').removeClass('hide');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmodal.modal('hide');\r\n\t\t\t\tmodal.on('hidden.bs.modal', function () {\r\n\t\t\t\t\tajaxify.refresh();\r\n\t\t\t\t});\r\n\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.create-success]]');\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tvar timeoutId = 0;\r\n\r\n\t\t$('#search-user-uid, #search-user-name, #search-user-email, #search-user-ip').on('keyup', function () {\r\n\t\t\tif (timeoutId !== 0) {\r\n\t\t\t\tclearTimeout(timeoutId);\r\n\t\t\t\ttimeoutId = 0;\r\n\t\t\t}\r\n\r\n\t\t\tvar $this = $(this);\r\n\t\t\tvar type = $this.attr('data-search-type');\r\n\r\n\t\t\ttimeoutId = setTimeout(function () {\r\n\t\t\t\t$('.fa-spinner').removeClass('hidden');\r\n\r\n\t\t\t\tsocket.emit('admin.user.search', { searchBy: type, query: $this.val() }, function (err, data) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tBenchpress.parse('admin/manage/users', 'users', data, function (html) {\r\n\t\t\t\t\t\ttranslator.translate(html, function (html) {\r\n\t\t\t\t\t\t\thtml = $(html);\r\n\t\t\t\t\t\t\t$('.users-table tr').not(':first').remove();\r\n\t\t\t\t\t\t\t$('.users-table tr').first().after(html);\r\n\t\t\t\t\t\t\thtml.find('.timeago').timeago();\r\n\t\t\t\t\t\t\t$('.fa-spinner').addClass('hidden');\r\n\r\n\t\t\t\t\t\t\tif (data && data.users.length === 0) {\r\n\t\t\t\t\t\t\t\t$('#user-notfound-notify').translateHtml('[[admin/manage/users:search.not-found]]')\r\n\t\t\t\t\t\t\t\t\t.removeClass('hide')\r\n\t\t\t\t\t\t\t\t\t.addClass('label-danger')\r\n\t\t\t\t\t\t\t\t\t.removeClass('label-success');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$('#user-notfound-notify').translateHtml(translator.compile('admin/manage/users:alerts.x-users-found', data.users.length, data.timing))\r\n\t\t\t\t\t\t\t\t\t.removeClass('hide')\r\n\t\t\t\t\t\t\t\t\t.addClass('label-success')\r\n\t\t\t\t\t\t\t\t\t.removeClass('label-danger');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}, 250);\r\n\t\t});\r\n\r\n\t\thandleUserCreate();\r\n\r\n\t\thandleInvite();\r\n\t};\r\n\r\n\tfunction handleInvite() {\r\n\t\t$('[component=\"user/invite\"]').on('click', function () {\r\n\t\t\tbootbox.prompt('[[admin/manage/users:alerts.prompt-email]]', function (email) {\r\n\t\t\t\tif (!email) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsocket.emit('user.invite', email, function (err) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.email-sent-to, ' + email + ']]');\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\r\n\treturn Users;\r\n});\r\n"]}