{"version":3,"sources":["public/src/client/account/header.js"],"names":["define","coverPhoto","pictureCropper","components","translator","Benchpress","AccountHeader","isAdminOrSelfOrGlobalMod","init","ajaxify","data","isAdmin","isSelf","isGlobalModerator","hidePrivateLinks","selectActivePill","setupCoverPhoto","get","on","toggleFollow","socket","emit","uid","err","roomId","app","alertError","message","openChat","newChat","parent","removeClass","banAccount","unbanAccount","deleteAccount","flagAccount","toggleBlockAccount","user","parseInt","theirid","$","addClass","each","href","this","find","attr","decodeURIComponent","window","location","pathname","imageData","position","callback","show","title","socketMethod","aspectRatio","NaN","allowSkippingCrop","restrictImageDimension","paramName","paramValue","accept","imageUrlOnServer","startsWith","config","relative_path","Date","now","css","removeCover","type","toggleClass","alertSuccess","username","parse","html","bootbox","dialog","className","buttons","close","label","submit","formData","serializeArray","reduce","cur","name","value","until","length","unit","uids","reason","refresh","translate","translated","confirm","history","back","require","flags","showFlagModal","id","targetEl","blockeeUid","blockerUid","blocked","text"],"mappings":"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","file":"public/src/client/account/header.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/account/header', [\r\n\t'coverPhoto',\r\n\t'pictureCropper',\r\n\t'components',\r\n\t'translator',\r\n\t'benchpress',\r\n], function (coverPhoto, pictureCropper, components, translator, Benchpress) {\r\n\tvar AccountHeader = {};\r\n\tvar isAdminOrSelfOrGlobalMod;\r\n\r\n\tAccountHeader.init = function () {\r\n\t\tisAdminOrSelfOrGlobalMod = ajaxify.data.isAdmin || ajaxify.data.isSelf || ajaxify.data.isGlobalModerator;\r\n\r\n\t\thidePrivateLinks();\r\n\t\tselectActivePill();\r\n\r\n\t\tif (isAdminOrSelfOrGlobalMod) {\r\n\t\t\tsetupCoverPhoto();\r\n\t\t}\r\n\r\n\t\tcomponents.get('account/follow').on('click', function () {\r\n\t\t\ttoggleFollow('follow');\r\n\t\t});\r\n\r\n\t\tcomponents.get('account/unfollow').on('click', function () {\r\n\t\t\ttoggleFollow('unfollow');\r\n\t\t});\r\n\r\n\t\tcomponents.get('account/chat').on('click', function () {\r\n\t\t\tsocket.emit('modules.chats.hasPrivateChat', ajaxify.data.uid, function (err, roomId) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\t\t\t\tif (roomId) {\r\n\t\t\t\t\tapp.openChat(roomId);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tapp.newChat(ajaxify.data.uid);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tcomponents.get('account/new-chat').on('click', function () {\r\n\t\t\tapp.newChat(ajaxify.data.uid, function () {\r\n\t\t\t\tcomponents.get('account/chat').parent().removeClass('hidden');\r\n\t\t\t});\r\n\t\t});\r\n\r\n\r\n\t\tcomponents.get('account/ban').on('click', banAccount);\r\n\t\tcomponents.get('account/unban').on('click', unbanAccount);\r\n\t\tcomponents.get('account/delete').on('click', deleteAccount);\r\n\t\tcomponents.get('account/flag').on('click', flagAccount);\r\n\t\tcomponents.get('account/block').on('click', toggleBlockAccount);\r\n\t};\r\n\r\n\tfunction hidePrivateLinks() {\r\n\t\tif (!app.user.uid || app.user.uid !== parseInt(ajaxify.data.theirid, 10)) {\r\n\t\t\t$('.account-sub-links .plugin-link.private').addClass('hide');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction selectActivePill() {\r\n\t\t$('.account-sub-links li').removeClass('active').each(function () {\r\n\t\t\tvar href = $(this).find('a').attr('href');\r\n\r\n\t\t\tif (decodeURIComponent(href) === decodeURIComponent(window.location.pathname)) {\r\n\t\t\t\t$(this).addClass('active');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction setupCoverPhoto() {\r\n\t\tcoverPhoto.init(\r\n\t\t\tcomponents.get('account/cover'),\r\n\t\t\tfunction (imageData, position, callback) {\r\n\t\t\t\tsocket.emit('user.updateCover', {\r\n\t\t\t\t\tuid: ajaxify.data.uid,\r\n\t\t\t\t\timageData: imageData,\r\n\t\t\t\t\tposition: position,\r\n\t\t\t\t}, callback);\r\n\t\t\t},\r\n\t\t\tfunction () {\r\n\t\t\t\tpictureCropper.show({\r\n\t\t\t\t\ttitle: '[[user:upload_cover_picture]]',\r\n\t\t\t\t\tsocketMethod: 'user.updateCover',\r\n\t\t\t\t\taspectRatio: NaN,\r\n\t\t\t\t\tallowSkippingCrop: true,\r\n\t\t\t\t\trestrictImageDimension: false,\r\n\t\t\t\t\tparamName: 'uid',\r\n\t\t\t\t\tparamValue: ajaxify.data.theirid,\r\n\t\t\t\t\taccept: '.png,.jpg,.bmp',\r\n\t\t\t\t}, function (imageUrlOnServer) {\r\n\t\t\t\t\timageUrlOnServer = (!imageUrlOnServer.startsWith('http') ? config.relative_path : '') + imageUrlOnServer + '?' + Date.now();\r\n\t\t\t\t\tcomponents.get('account/cover').css('background-image', 'url(' + imageUrlOnServer + ')');\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tremoveCover\r\n\t\t);\r\n\t}\r\n\r\n\tfunction toggleFollow(type) {\r\n\t\tsocket.emit('user.' + type, {\r\n\t\t\tuid: ajaxify.data.uid,\r\n\t\t}, function (err) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\r\n\t\t\tcomponents.get('account/follow').toggleClass('hide', type === 'follow');\r\n\t\t\tcomponents.get('account/unfollow').toggleClass('hide', type === 'unfollow');\r\n\t\t\tapp.alertSuccess('[[global:alert.' + type + ', ' + ajaxify.data.username + ']]');\r\n\t\t});\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction banAccount() {\r\n\t\tBenchpress.parse('admin/partials/temporary-ban', {}, function (html) {\r\n\t\t\tbootbox.dialog({\r\n\t\t\t\tclassName: 'ban-modal',\r\n\t\t\t\ttitle: '[[user:ban_account]]',\r\n\t\t\t\tmessage: html,\r\n\t\t\t\tshow: true,\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tclose: {\r\n\t\t\t\t\t\tlabel: '[[global:close]]',\r\n\t\t\t\t\t\tclassName: 'btn-link',\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsubmit: {\r\n\t\t\t\t\t\tlabel: '[[user:ban_account]]',\r\n\t\t\t\t\t\tcallback: function () {\r\n\t\t\t\t\t\t\tvar formData = $('.ban-modal form').serializeArray().reduce(function (data, cur) {\r\n\t\t\t\t\t\t\t\tdata[cur.name] = cur.value;\r\n\t\t\t\t\t\t\t\treturn data;\r\n\t\t\t\t\t\t\t}, {});\r\n\r\n\t\t\t\t\t\t\tvar until = formData.length > 0 ? (Date.now() + (formData.length * 1000 * 60 * 60 * (parseInt(formData.unit, 10) ? 24 : 1))) : 0;\r\n\r\n\t\t\t\t\t\t\tsocket.emit('user.banUsers', {\r\n\t\t\t\t\t\t\t\tuids: [ajaxify.data.theirid],\r\n\t\t\t\t\t\t\t\tuntil: until,\r\n\t\t\t\t\t\t\t\treason: formData.reason || '',\r\n\t\t\t\t\t\t\t}, function (err) {\r\n\t\t\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tajaxify.refresh();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction unbanAccount() {\r\n\t\tsocket.emit('user.unbanUsers', [ajaxify.data.theirid], function (err) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\t\t\tajaxify.refresh();\r\n\t\t});\r\n\t}\r\n\r\n\tfunction deleteAccount() {\r\n\t\ttranslator.translate('[[user:delete_this_account_confirm]]', function (translated) {\r\n\t\t\tbootbox.confirm(translated, function (confirm) {\r\n\t\t\t\tif (!confirm) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsocket.emit('admin.user.deleteUsersAndContent', [ajaxify.data.theirid], function (err) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tapp.alertSuccess('[[user:account-deleted]]');\r\n\t\t\t\t\thistory.back();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction flagAccount() {\r\n\t\trequire(['flags'], function (flags) {\r\n\t\t\tflags.showFlagModal({\r\n\t\t\t\ttype: 'user',\r\n\t\t\t\tid: ajaxify.data.uid,\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction toggleBlockAccount() {\r\n\t\tvar targetEl = this;\r\n\t\tsocket.emit('user.toggleBlock', {\r\n\t\t\tblockeeUid: ajaxify.data.uid,\r\n\t\t\tblockerUid: app.user.uid,\r\n\t\t}, function (err, blocked) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\r\n\t\t\ttranslator.translate('[[user:' + (blocked ? 'unblock' : 'block') + '_user]]', function (label) {\r\n\t\t\t\t$(targetEl).text(label);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t// Keep dropdown open\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction removeCover() {\r\n\t\ttranslator.translate('[[user:remove_cover_picture_confirm]]', function (translated) {\r\n\t\t\tbootbox.confirm(translated, function (confirm) {\r\n\t\t\t\tif (!confirm) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsocket.emit('user.removeCover', {\r\n\t\t\t\t\tuid: ajaxify.data.uid,\r\n\t\t\t\t}, function (err) {\r\n\t\t\t\t\tif (!err) {\r\n\t\t\t\t\t\tajaxify.refresh();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tapp.alertError(err.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\treturn AccountHeader;\r\n});\r\n"]}