{"version":3,"sources":["public/src/client/account/sessions.js"],"names":["define","header","components","Sessions","init","prepareSessionRevocation","get","on","parentEl","$","this","parents","uuid","attr","ajax","url","config","relative_path","ajaxify","data","userslug","method","headers","x-csrf-token","csrf_token","done","remove","fail","err","errorObj","JSON","parse","responseText","loggedIn","window","location","href","title","app","alertError","e"],"mappings":"AAAA,aAGAA,OAAO,0BAA2B,uBAAwB,cAAe,SAAUC,EAAQC,GAC1F,IAAIC,KAEJA,EAASC,KAAO,WACfH,EAAOG,OACPD,EAASE,4BAGVF,EAASE,yBAA2B,WACnCH,EAAWI,IAAI,iBAAiBC,GAAG,QAAS,gBAAiB,WAC5D,IAAIC,EAAWC,EAAEC,MAAMC,QAAQ,eAC/B,IAAIC,EAAOJ,EAASK,KAAK,aAEzB,GAAID,EAAM,CAGTH,EAAEK,MACDC,IAAKC,OAAOC,cAAgB,aAAeC,QAAQC,KAAKC,SAAW,YAAcR,EACjFS,OAAQ,SACRC,SACCC,eAAgBP,OAAOQ,cAEtBC,KAAK,WACPjB,EAASkB,WACPC,KAAK,SAAUC,GACjB,IACC,IAAIC,EAAWC,KAAKC,MAAMH,EAAII,cAC9B,GAAIH,EAASI,WAAa,MAAO,CAChCC,OAAOC,SAASC,KAAOpB,OAAOC,cAAgB,gBAAkBY,EAASQ,MAE1EC,IAAIC,WAAWV,EAASQ,OACvB,MAAOG,GACRF,IAAIC,WAAW,iCAOpB,OAAOpC","file":"public/src/client/account/sessions.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/account/sessions', ['forum/account/header', 'components'], function (header, components) {\r\n\tvar Sessions = {};\r\n\r\n\tSessions.init = function () {\r\n\t\theader.init();\r\n\t\tSessions.prepareSessionRevocation();\r\n\t};\r\n\r\n\tSessions.prepareSessionRevocation = function () {\r\n\t\tcomponents.get('user/sessions').on('click', '[data-action]', function () {\r\n\t\t\tvar parentEl = $(this).parents('[data-uuid]');\r\n\t\t\tvar uuid = parentEl.attr('data-uuid');\r\n\r\n\t\t\tif (uuid) {\r\n\t\t\t\t// This is done via DELETE because a user shouldn't be able to\r\n\t\t\t\t// revoke his own session! This is what logout is for\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: config.relative_path + '/api/user/' + ajaxify.data.userslug + '/session/' + uuid,\r\n\t\t\t\t\tmethod: 'delete',\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\t'x-csrf-token': config.csrf_token,\r\n\t\t\t\t\t},\r\n\t\t\t\t}).done(function () {\r\n\t\t\t\t\tparentEl.remove();\r\n\t\t\t\t}).fail(function (err) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tvar errorObj = JSON.parse(err.responseText);\r\n\t\t\t\t\t\tif (errorObj.loggedIn === false) {\r\n\t\t\t\t\t\t\twindow.location.href = config.relative_path + '/login?error=' + errorObj.title;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tapp.alertError(errorObj.title);\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tapp.alertError('[[error:invalid-data]]');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\treturn Sessions;\r\n});\r\n"]}