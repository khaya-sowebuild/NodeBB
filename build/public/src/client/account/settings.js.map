{"version":3,"sources":["public/src/client/account/settings.js"],"names":["define","header","components","sounds","AccountSettings","$","window","on","ajaxify","data","template","name","val","config","bootswatchSkin","changePageSkin","init","settings","loadSettings","homePageRoute","homePageCustom","get","relative_path","saveSettings","fail","app","alertError","this","toggleCustomRoute","find","e","preventDefault","soundName","parent","playSound","timeago","skinName","css","defaultBootswatchSkin","remove","cssSource","length","attr","append","currentSkinClassName","split","filter","className","startsWith","removeClass","join","addClass","each","id","input","setting","is","socket","emit","uid","theirid","err","newSettings","message","alertSuccess","requireReload","key","hasOwnProperty","userLang","loadMap","parseInt","user","alert","type","timeout","clickfn","refresh","show","hide"],"mappings":"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","file":"public/src/client/account/settings.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/account/settings', ['forum/account/header', 'components', 'sounds'], function (header, components, sounds) {\r\n\tvar\tAccountSettings = {};\r\n\r\n\t$(window).on('action:ajaxify.start', function () {\r\n\t\tif (ajaxify.data.template.name === 'account/settings' && $('#bootswatchSkin').val() !== config.bootswatchSkin) {\r\n\t\t\tchangePageSkin(config.bootswatchSkin);\r\n\t\t}\r\n\t});\r\n\r\n\tAccountSettings.init = function () {\r\n\t\theader.init();\r\n\r\n\t\t$('#submitBtn').on('click', function () {\r\n\t\t\tvar settings = loadSettings();\r\n\r\n\t\t\tif (settings.homePageRoute === 'custom' && settings.homePageCustom) {\r\n\t\t\t\t$.get(config.relative_path + '/' + settings.homePageCustom, function () {\r\n\t\t\t\t\tsaveSettings(settings);\r\n\t\t\t\t}).fail(function () {\r\n\t\t\t\t\tapp.alertError('[[error:invalid-home-page-route]]');\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tsaveSettings(settings);\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\t$('#bootswatchSkin').on('change', function () {\r\n\t\t\tchangePageSkin($(this).val());\r\n\t\t});\r\n\r\n\t\t$('[data-property=\"homePageRoute\"]').on('change', toggleCustomRoute);\r\n\r\n\t\t$('.account').find('button[data-action=\"play\"]').on('click', function (e) {\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tvar\tsoundName = $(this).parent().parent().find('select').val();\r\n\t\t\tsounds.playSound(soundName);\r\n\t\t});\r\n\r\n\t\ttoggleCustomRoute();\r\n\r\n\t\tcomponents.get('user/sessions').find('.timeago').timeago();\r\n\t};\r\n\r\n\tfunction changePageSkin(skinName) {\r\n\t\tvar css = $('#bootswatchCSS');\r\n\t\tif (skinName === 'noskin' || (skinName === 'default' && config.defaultBootswatchSkin === 'noskin')) {\r\n\t\t\tcss.remove();\r\n\t\t} else {\r\n\t\t\tif (skinName === 'default') {\r\n\t\t\t\tskinName = config.defaultBootswatchSkin;\r\n\t\t\t}\r\n\t\t\tvar cssSource = '//maxcdn.bootstrapcdn.com/bootswatch/3.3.7/' + skinName + '/bootstrap.min.css';\r\n\t\t\tif (css.length) {\r\n\t\t\t\tcss.attr('href', cssSource);\r\n\t\t\t} else {\r\n\t\t\t\tcss = $('<link id=\"bootswatchCSS\" href=\"' + cssSource + '\" rel=\"stylesheet\" media=\"screen\">');\r\n\t\t\t\t$('head').append(css);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar currentSkinClassName = $('body').attr('class').split(/\\s+/).filter(function (className) {\r\n\t\t\treturn className.startsWith('skin-');\r\n\t\t});\r\n\t\t$('body').removeClass(currentSkinClassName.join(' ')).addClass('skin-' + skinName);\r\n\t}\r\n\r\n\tfunction loadSettings() {\r\n\t\tvar settings = {};\r\n\r\n\t\t$('.account').find('input, textarea, select').each(function (id, input) {\r\n\t\t\tinput = $(input);\r\n\t\t\tvar setting = input.attr('data-property');\r\n\t\t\tif (input.is('select')) {\r\n\t\t\t\tsettings[setting] = input.val();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tswitch (input.attr('type')) {\r\n\t\t\tcase 'text':\r\n\t\t\tcase 'textarea':\r\n\t\t\t\tsettings[setting] = input.val();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'checkbox':\r\n\t\t\t\tsettings[setting] = input.is(':checked') ? 1 : 0;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn settings;\r\n\t}\r\n\r\n\tfunction saveSettings(settings) {\r\n\t\tsocket.emit('user.saveSettings', { uid: ajaxify.data.theirid, settings: settings }, function (err, newSettings) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\r\n\t\t\tapp.alertSuccess('[[success:settings-saved]]');\r\n\t\t\tvar requireReload = false;\r\n\t\t\tfor (var key in newSettings) {\r\n\t\t\t\tif (newSettings.hasOwnProperty(key)) {\r\n\t\t\t\t\tif (key === 'userLang' && config.userLang !== newSettings.userLang) {\r\n\t\t\t\t\t\trequireReload = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (config.hasOwnProperty(key)) {\r\n\t\t\t\t\t\tconfig[key] = newSettings[key];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tsounds.loadMap();\r\n\r\n\t\t\tif (requireReload && parseInt(app.user.uid, 10) === parseInt(ajaxify.data.theirid, 10)) {\r\n\t\t\t\tapp.alert({\r\n\t\t\t\t\tid: 'setting-change',\r\n\t\t\t\t\tmessage: '[[user:settings-require-reload]]',\r\n\t\t\t\t\ttype: 'warning',\r\n\t\t\t\t\ttimeout: 5000,\r\n\t\t\t\t\tclickfn: function () {\r\n\t\t\t\t\t\tajaxify.refresh();\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction toggleCustomRoute() {\r\n\t\tif ($('[data-property=\"homePageRoute\"]').val() === 'custom') {\r\n\t\t\t$('#homePageCustom').show();\r\n\t\t} else {\r\n\t\t\t$('#homePageCustom').hide();\r\n\t\t\t$('[data-property=\"homePageCustom\"]').val('');\r\n\t\t}\r\n\t}\r\n\r\n\treturn AccountSettings;\r\n});\r\n"]}