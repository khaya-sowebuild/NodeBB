{"version":3,"sources":["public/src/client/categories.js"],"names":["define","components","categories","$","window","on","ev","data","ajaxify","currentPage","url","socket","removeListener","onNewPost","init","app","enterRoom","tooltip","placement","posts","length","topic","renderNewPost","cid","post","category","get","numRecentReplies","attr","parseInt","recentPosts","find","parseAndTranslate","html","addClass","hide","appendTo","insertBefore","first","fadeIn","createUserTooltips","timeago","last","remove","trigger"],"mappings":"AAAA,aAGAA,OAAO,oBAAqB,cAAe,SAAUC,GACpD,IAAIC,KAEJC,EAAEC,QAAQC,GAAG,uBAAwB,SAAUC,EAAIC,GAClD,GAAIC,QAAQC,cAAgBF,EAAKG,IAAK,CACrCC,OAAOC,eAAe,iBAAkBV,EAAWW,cAIrDX,EAAWY,KAAO,WACjBC,IAAIC,UAAU,cAEdL,OAAOC,eAAe,iBAAkBV,EAAWW,WACnDF,OAAON,GAAG,iBAAkBH,EAAWW,WAEvCV,EAAE,oBAAoBc,SACrBC,UAAW,YAIbhB,EAAWW,UAAY,SAAUN,GAChC,GAAIA,GAAQA,EAAKY,OAASZ,EAAKY,MAAMC,QAAUb,EAAKY,MAAM,GAAGE,MAAO,CACnEC,EAAcf,EAAKY,MAAM,GAAGE,MAAME,IAAKhB,EAAKY,MAAM,MAIpD,SAASG,EAAcC,EAAKC,GAC3B,IAAIC,EAAWxB,EAAWyB,IAAI,sBAAuB,MAAOH,GAC5D,IAAII,EAAmBF,EAASG,KAAK,yBACrC,IAAKD,IAAqBE,SAASF,EAAkB,IAAK,CACzD,OAGD,IAAIG,EAAcL,EAASM,KAAK,gCAEhChB,IAAIiB,kBAAkB,+BAAgC,SAAWb,OAAQK,IAAS,SAAUS,GAC3FA,EAAKF,KAAK,0CAA0CG,SAAS,kBAC7DD,EAAKE,OACL,GAAIL,EAAYV,SAAW,EAAG,CAC7Ba,EAAKG,SAASX,OACR,CACNQ,EAAKI,aAAaP,EAAYQ,SAG/BL,EAAKM,SAELxB,IAAIyB,qBACJP,EAAKF,KAAK,YAAYU,UAEtB,GAAIhB,EAASM,KAAK,gCAAgCX,OAASS,SAASF,EAAkB,IAAK,CAC1FG,EAAYY,OAAOC,SAGpBxC,EAAEC,QAAQwC,QAAQ,uBAAyBzB,OAAQK,OAIrD,OAAOtB","file":"public/src/client/categories.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/categories', ['components'], function (components) {\r\n\tvar\tcategories = {};\r\n\r\n\t$(window).on('action:ajaxify.start', function (ev, data) {\r\n\t\tif (ajaxify.currentPage !== data.url) {\r\n\t\t\tsocket.removeListener('event:new_post', categories.onNewPost);\r\n\t\t}\r\n\t});\r\n\r\n\tcategories.init = function () {\r\n\t\tapp.enterRoom('categories');\r\n\r\n\t\tsocket.removeListener('event:new_post', categories.onNewPost);\r\n\t\tsocket.on('event:new_post', categories.onNewPost);\r\n\r\n\t\t$('.category-header').tooltip({\r\n\t\t\tplacement: 'bottom',\r\n\t\t});\r\n\t};\r\n\r\n\tcategories.onNewPost = function (data) {\r\n\t\tif (data && data.posts && data.posts.length && data.posts[0].topic) {\r\n\t\t\trenderNewPost(data.posts[0].topic.cid, data.posts[0]);\r\n\t\t}\r\n\t};\r\n\r\n\tfunction renderNewPost(cid, post) {\r\n\t\tvar category = components.get('categories/category', 'cid', cid);\r\n\t\tvar numRecentReplies = category.attr('data-numRecentReplies');\r\n\t\tif (!numRecentReplies || !parseInt(numRecentReplies, 10)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar recentPosts = category.find('[component=\"category/posts\"]');\r\n\r\n\t\tapp.parseAndTranslate('partials/categories/lastpost', 'posts', { posts: [post] }, function (html) {\r\n\t\t\thtml.find('.post-content img:not(.not-responsive)').addClass('img-responsive');\r\n\t\t\thtml.hide();\r\n\t\t\tif (recentPosts.length === 0) {\r\n\t\t\t\thtml.appendTo(category);\r\n\t\t\t} else {\r\n\t\t\t\thtml.insertBefore(recentPosts.first());\r\n\t\t\t}\r\n\r\n\t\t\thtml.fadeIn();\r\n\r\n\t\t\tapp.createUserTooltips();\r\n\t\t\thtml.find('.timeago').timeago();\r\n\r\n\t\t\tif (category.find('[component=\"category/posts\"]').length > parseInt(numRecentReplies, 10)) {\r\n\t\t\t\trecentPosts.last().remove();\r\n\t\t\t}\r\n\r\n\t\t\t$(window).trigger('action:posts.loaded', { posts: [post] });\r\n\t\t});\r\n\t}\r\n\r\n\treturn categories;\r\n});\r\n"]}