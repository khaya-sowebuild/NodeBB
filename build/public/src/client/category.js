"use strict";define("forum/category",["forum/infinitescroll","share","navigator","forum/category/tools","forum/recent","sort","components","translator","topicSelect","handleBack"],function(t,o,e,a,i,n,r,c,s,g){var l={};$(window).on("action:ajaxify.start",function(t,o){if(!String(o.url).startsWith("category/")){e.disable();d()}});function d(){a.removeListeners();i.removeListeners()}l.init=function(){var t=ajaxify.data.cid;app.enterRoom("category_"+t);o.addShareHandlers(ajaxify.data.name);a.init(t);i.watchForNewPosts();n.handleSort("categoryTopicSort","user.setCategorySort","category/"+ajaxify.data.slug);u();g.init(function(t,o){m(t,1,o)});p();f(t);$(window).trigger("action:topics.loaded",{topics:ajaxify.data.topics});$(window).trigger("action:category.loaded",{cid:ajaxify.data.cid})};function p(){var t=window.location.pathname.split("/");var o=t[t.length-1];if(o&&utils.isNumber(o)){o=Math.max(0,parseInt(o,10)-1);if(o&&window.location.search.indexOf("page=")===-1){e.scrollToElement($('[component="category/topic"][data-index="'+o+'"]'),true,0)}}}function f(t){$('[component="category/watching"], [component="category/ignoring"]').on("click",function(){var o=$(this);var e=o.attr("component")==="category/watching"?"watch":"ignore";socket.emit("categories."+e,t,function(t){if(t){return app.alertError(t.message)}$('[component="category/watching/menu"]').toggleClass("hidden",e!=="watch");$('[component="category/watching/check"]').toggleClass("fa-check",e==="watch");$('[component="category/ignoring/menu"]').toggleClass("hidden",e!=="ignore");$('[component="category/ignoring/check"]').toggleClass("fa-check",e==="ignore");app.alertSuccess("[[category:"+e+".message]]")})})}l.toTop=function(){e.scrollTop(0)};l.toBottom=function(){socket.emit("categories.getTopicCount",ajaxify.data.cid,function(t,o){if(t){return app.alertError(t.message)}e.scrollBottom(o-1)})};l.navigatorCallback=function(t,o){return o};function u(){if(!config.usePagination){e.init('[component="category/topic"]',ajaxify.data.topic_count,l.toTop,l.toBottom,l.navigatorCallback);t.init($('[component="category"]'),l.loadMoreTopics)}else{e.disable()}}l.loadMoreTopics=function(t){if(!$('[component="category"]').length||!$('[component="category"]').children().length){return}var o=$('[component="category/topic"]');var e=t>0?o.last():o.first();var a=(parseInt(e.attr("data-index"),10)||0)+(t>0?1:0);m(a,t)};function m(o,e,a){a=a||function(){};if(!utils.isNumber(o)||o===0&&r.get("category/topic","index",0).length){return a()}$(window).trigger("action:category.loading");var i=utils.params();t.loadMore("categories.loadMore",{cid:ajaxify.data.cid,after:o,direction:e,query:i,categoryTopicSort:config.categoryTopicSort},function(t,o){if(t.topics&&t.topics.length){l.onTopicsLoaded(t,e,o)}else{o()}$(window).trigger("action:category.loaded");a()})}l.onTopicsLoaded=function(o,e,a){if(!o||!o.topics.length){return a()}function i(t){return t.filter(function(t){return r.get("category/topic","tid",t.tid).length===0})}o.topics=i(o.topics);if(!o.topics.length){return a()}o.showSelect=o.privileges.editable;var n;var c;var g=$('[component="category/topic"]');if(e>0&&g.length){n=g.last()}else if(e<0&&g.length){c=g.first()}app.parseAndTranslate("category","topics",o,function(i){$('[component="category"]').removeClass("hidden");$(".category-sidebar").removeClass("hidden");$("#category-no-topics").remove();if(n){i.insertAfter(n)}else if(c){var r=$(document).height();var g=$(window).scrollTop();i.insertBefore(c);$(window).scrollTop(g+($(document).height()-r))}else{$('[component="category"]').append(i)}if(!s.getSelectedTids().length){t.removeExtra($('[component="category/topic"]'),e,config.topicsPerPage*3)}i.find(".timeago").timeago();app.createUserTooltips();utils.makeNumbersHumanReadable(i.find(".human-readable-number"));$(window).trigger("action:topics.loaded",{topics:o.topics});a()})};return l});
//# sourceMappingURL=public/src/client/category.js.map