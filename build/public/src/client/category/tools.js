"use strict";define("forum/category/tools",["forum/topic/move","forum/topic/merge","topicSelect","components","translator"],function(e,t,o,n,i){var r={};r.init=function(i){r.cid=i;o.init(a);L();n.get("topic/delete").on("click",function(){c("delete",o.getSelectedTids());return false});n.get("topic/restore").on("click",function(){c("restore",o.getSelectedTids());return false});n.get("topic/purge").on("click",function(){c("purge",o.getSelectedTids());return false});n.get("topic/lock").on("click",function(){var e=o.getSelectedTids();if(!e.length){return app.alertError("[[error:no-topics-selected]]")}socket.emit("topics.lock",{tids:e,cid:r.cid},l);return false});n.get("topic/unlock").on("click",function(){var e=o.getSelectedTids();if(!e.length){return app.alertError("[[error:no-topics-selected]]")}socket.emit("topics.unlock",{tids:e,cid:r.cid},l);return false});n.get("topic/pin").on("click",function(){var e=o.getSelectedTids();if(!e.length){return app.alertError("[[error:no-topics-selected]]")}socket.emit("topics.pin",{tids:e,cid:r.cid},l);return false});n.get("topic/unpin").on("click",function(){var e=o.getSelectedTids();if(!e.length){return app.alertError("[[error:no-topics-selected]]")}socket.emit("topics.unpin",{tids:e,cid:r.cid},l);return false});n.get("topic/mark-unread-for-all").on("click",function(){var e=o.getSelectedTids();if(!e.length){return app.alertError("[[error:no-topics-selected]]")}socket.emit("topics.markAsUnreadForAll",e,function(t){if(t){return app.alertError(t.message)}app.alertSuccess("[[topic:markAsUnreadForAll.success]]");e.forEach(function(e){$('[component="category/topic"][data-tid="'+e+'"]').addClass("unread")});l()});return false});n.get("topic/move").on("click",function(){var t=o.getSelectedTids();if(!t.length){return app.alertError("[[error:no-topics-selected]]")}e.init(t,i,l);return false});n.get("topic/move-all").on("click",function(){e.init(null,i,function(e){if(e){return app.alertError(e.message)}ajaxify.refresh()})});t.init();r.removeListeners();socket.on("event:topic_deleted",m);socket.on("event:topic_restored",m);socket.on("event:topic_purged",E);socket.on("event:topic_locked",_);socket.on("event:topic_unlocked",_);socket.on("event:topic_pinned",h);socket.on("event:topic_unpinned",h);socket.on("event:topic_moved",C)};function c(e,t){if(!t.length){return app.alertError("[[error:no-topics-selected]]")}i.translate("[[topic:thread_tools."+e+"_confirm]]",function(o){bootbox.confirm(o,function(o){if(!o){return}socket.emit("topics."+e,{tids:t,cid:r.cid},d)})})}r.removeListeners=function(){socket.removeListener("event:topic_deleted",m);socket.removeListener("event:topic_restored",m);socket.removeListener("event:topic_purged",E);socket.removeListener("event:topic_locked",_);socket.removeListener("event:topic_unlocked",_);socket.removeListener("event:topic_pinned",h);socket.removeListener("event:topic_unpinned",h);socket.removeListener("event:topic_moved",C)};function s(){$(".thread-tools.open").find(".dropdown-toggle").trigger("click")}function l(e){if(e){return app.alertError(e.message)}s();o.unselectAll()}function d(e){if(e){return app.alertError(e.message)}s();a()}function a(){var e=o.getSelectedTids();var t=p(f,e);var i=u(f,e);var r=p(v,e);var c=p(g,e);n.get("topic/delete").toggleClass("hidden",t);n.get("topic/restore").toggleClass("hidden",!t);n.get("topic/purge").toggleClass("hidden",!i);n.get("topic/lock").toggleClass("hidden",c);n.get("topic/unlock").toggleClass("hidden",!c);n.get("topic/pin").toggleClass("hidden",r);n.get("topic/unpin").toggleClass("hidden",!r)}function p(e,t){for(var o=0;o<t.length;o+=1){if(e(t[o])){return true}}return false}function u(e,t){for(var o=0;o<t.length;o+=1){if(!e(t[o])){return false}}return true}function f(e){return k(e).hasClass("deleted")}function g(e){return k(e).hasClass("locked")}function v(e){return k(e).hasClass("pinned")}function k(e){return n.get("category/topic","tid",e)}function m(e){var t=k(e.tid);t.toggleClass("deleted",e.isDeleted);t.find('[component="topic/locked"]').toggleClass("hide",!e.isDeleted)}function h(e){var t=k(e.tid);t.toggleClass("pinned",e.isPinned);t.find('[component="topic/pinned"]').toggleClass("hide",!e.isPinned);ajaxify.refresh()}function _(e){var t=k(e.tid);t.toggleClass("locked",e.isLocked);t.find('[component="topic/locked"]').toggleClass("hide",!e.isLocked)}function C(e){k(e.tid).remove()}function E(e){k(e.tid).remove()}function L(){var e=utils.findBootstrapEnvironment();if(!ajaxify.data.privileges.isAdminOrMod||e==="xs"||e==="sm"){return}app.loadJQueryUI(function(){$('[component="category"]').sortable({items:'[component="category/topic"].pinned',update:function(){var e=[];var t=$('[component="category/topic"].pinned');t.each(function(o,n){e.push({tid:$(n).attr("data-tid"),order:t.length-o-1})});socket.emit("topics.orderPinnedTopics",e,function(e){if(e){return app.alertError(e.message)}})}})})}return r});
//# sourceMappingURL=public/src/client/category/tools.js.map