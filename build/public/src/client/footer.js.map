{"version":3,"sources":["public/src/client/footer.js"],"names":["define","Notifications","Chat","components","translator","prepareDOM","updateUnreadTopicCount","url","count","utils","isNumber","$","config","relative_path","toggleClass","attr","updateUnreadChatCount","get","initUnreadTopics","unreadTopics","onNewPost","data","posts","length","post","parseInt","uid","app","user","topic","tid","increaseUnreadCount","markTopicsUnread","unreadTopicCount","isNewTopic","isMain","unreadNewTopicCount","isUnreplied","postcount","unreadUnrepliedTopicCount","socket","emit","err","isFollowed","alertError","message","unreadWatchedTopicCount","addClass","window","on","ev","match","updateUnreadCounters"],"mappings":"AAAA,aAGAA,OAAO,gBAAiB,gBAAiB,OAAQ,aAAc,cAAe,SAAUC,EAAeC,EAAMC,EAAYC,GACxHH,EAAcI,aACdH,EAAKG,aACLD,EAAWC,aAEX,SAASC,EAAuBC,EAAKC,GACpC,IAAKC,MAAMC,SAASF,GAAQ,CAC3B,OAEDG,EAAE,WAAaC,OAAOC,cAAgBN,EAAM,wBAC1CO,YAAY,eAAgBN,EAAQ,GACpCO,KAAK,eAAgBP,EAAQ,GAAK,MAAQA,GAG7C,SAASQ,EAAsBR,GAC9BL,EAAWc,IAAI,aACbH,YAAY,eAAgBN,EAAQ,GACpCO,KAAK,eAAgBP,EAAQ,GAAK,MAAQA,GAG7C,SAASU,IACR,IAAIC,KAEJ,SAASC,EAAUC,GAClB,GAAIA,GAAQA,EAAKC,OAASD,EAAKC,MAAMC,OAAQ,CAC5C,IAAIC,EAAOH,EAAKC,MAAM,GAEtB,GAAIG,SAASD,EAAKE,IAAK,MAAQD,SAASE,IAAIC,KAAKF,IAAK,MAAQP,EAAaK,EAAKK,MAAMC,KAAM,CAC3FC,EAAoBV,GACpBW,EAAiBR,EAAKK,MAAMC,KAC5BX,EAAaK,EAAKK,MAAMC,KAAO,OAKlC,SAASC,EAAoBV,GAC5B,IAAIG,EAAOH,EAAKC,MAAM,GAEtB,IAAIW,EAAmBR,SAASd,EAAE,WAAaC,OAAOC,cAAgB,+BAA+BE,KAAK,gBAAiB,IAAM,EACjIT,EAAuB,UAAW2B,GAElC,IAAIC,EAAaV,EAAKW,QAAUV,SAASD,EAAKE,IAAK,MAAQD,SAASE,IAAIC,KAAKF,IAAK,IAClF,GAAIQ,EAAY,CACf,IAAIE,EAAsBX,SAASd,EAAE,WAAaC,OAAOC,cAAgB,0CAA0CE,KAAK,gBAAiB,IAAM,EAC/IT,EAAuB,qBAAsB8B,GAG9C,IAAIC,EAAcZ,SAASD,EAAKK,MAAMS,UAAW,KAAO,EACxD,GAAID,EAAa,CAChB,IAAIE,EAA4Bd,SAASd,EAAE,WAAaC,OAAOC,cAAgB,gDAAgDE,KAAK,gBAAiB,IAAM,EAC3JT,EAAuB,2BAA4BiC,GAEpDC,OAAOC,KAAK,oBAAqBjB,EAAKK,MAAMC,IAAK,SAAUY,EAAKC,GAC/D,GAAID,EAAK,CACR,OAAOf,IAAIiB,WAAWF,EAAIG,SAE3B,GAAIF,EAAY,CACf,IAAIG,EAA0BrB,SAASd,EAAE,WAAaC,OAAOC,cAAgB,8CAA8CE,KAAK,gBAAiB,IAAM,EACvJT,EAAuB,yBAA0BwC,MAKpD,SAASd,EAAiBF,GACzBnB,EAAE,cAAgBmB,EAAM,MAAMiB,SAAS,UAGxCpC,EAAEqC,QAAQC,GAAG,qBAAsB,SAAUC,EAAI7B,GAChD,GAAIA,EAAKd,IAAK,CACb,IAAIuB,EAAMT,EAAKd,IAAI4C,MAAM,iBAEzB,GAAIrB,GAAOA,EAAI,GAAI,QACXX,EAAaW,EAAI,QAK3BU,OAAOS,GAAG,iBAAkB7B,GAG7B,SAASgC,EAAqB/B,GAC7Bf,EAAuB,UAAWe,EAAKY,kBACvC3B,EAAuB,qBAAsBe,EAAKe,qBAClD9B,EAAuB,yBAA0Be,EAAKyB,yBACtDxC,EAAuB,2BAA4Be,EAAKkB,2BAGzDC,OAAOS,GAAG,2BAA4BG,GACtCZ,OAAOS,GAAG,+BAAgCjC,GAE1CE","file":"public/src/client/footer.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/footer', ['notifications', 'chat', 'components', 'translator'], function (Notifications, Chat, components, translator) {\r\n\tNotifications.prepareDOM();\r\n\tChat.prepareDOM();\r\n\ttranslator.prepareDOM();\r\n\r\n\tfunction updateUnreadTopicCount(url, count) {\r\n\t\tif (!utils.isNumber(count)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t$('a[href=\"' + config.relative_path + url + '\"].navigation-link i')\r\n\t\t\t.toggleClass('unread-count', count > 0)\r\n\t\t\t.attr('data-content', count > 99 ? '99+' : count);\r\n\t}\r\n\r\n\tfunction updateUnreadChatCount(count) {\r\n\t\tcomponents.get('chat/icon')\r\n\t\t\t.toggleClass('unread-count', count > 0)\r\n\t\t\t.attr('data-content', count > 99 ? '99+' : count);\r\n\t}\r\n\r\n\tfunction initUnreadTopics() {\r\n\t\tvar unreadTopics = {};\r\n\r\n\t\tfunction onNewPost(data) {\r\n\t\t\tif (data && data.posts && data.posts.length) {\r\n\t\t\t\tvar post = data.posts[0];\r\n\r\n\t\t\t\tif (parseInt(post.uid, 10) !== parseInt(app.user.uid, 10) && !unreadTopics[post.topic.tid]) {\r\n\t\t\t\t\tincreaseUnreadCount(data);\r\n\t\t\t\t\tmarkTopicsUnread(post.topic.tid);\r\n\t\t\t\t\tunreadTopics[post.topic.tid] = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction increaseUnreadCount(data) {\r\n\t\t\tvar post = data.posts[0];\r\n\r\n\t\t\tvar unreadTopicCount = parseInt($('a[href=\"' + config.relative_path + '/unread\"].navigation-link i').attr('data-content'), 10) + 1;\r\n\t\t\tupdateUnreadTopicCount('/unread', unreadTopicCount);\r\n\r\n\t\t\tvar isNewTopic = post.isMain && parseInt(post.uid, 10) !== parseInt(app.user.uid, 10);\r\n\t\t\tif (isNewTopic) {\r\n\t\t\t\tvar unreadNewTopicCount = parseInt($('a[href=\"' + config.relative_path + '/unread?filter=new\"].navigation-link i').attr('data-content'), 10) + 1;\r\n\t\t\t\tupdateUnreadTopicCount('/unread?filter=new', unreadNewTopicCount);\r\n\t\t\t}\r\n\r\n\t\t\tvar isUnreplied = parseInt(post.topic.postcount, 10) <= 1;\r\n\t\t\tif (isUnreplied) {\r\n\t\t\t\tvar unreadUnrepliedTopicCount = parseInt($('a[href=\"' + config.relative_path + '/unread?filter=unreplied\"].navigation-link i').attr('data-content'), 10) + 1;\r\n\t\t\t\tupdateUnreadTopicCount('/unread?filter=unreplied', unreadUnrepliedTopicCount);\r\n\t\t\t}\r\n\t\t\tsocket.emit('topics.isFollowed', post.topic.tid, function (err, isFollowed) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\t\t\t\tif (isFollowed) {\r\n\t\t\t\t\tvar unreadWatchedTopicCount = parseInt($('a[href=\"' + config.relative_path + '/unread?filter=watched\"].navigation-link i').attr('data-content'), 10) + 1;\r\n\t\t\t\t\tupdateUnreadTopicCount('/unread?filter=watched', unreadWatchedTopicCount);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction markTopicsUnread(tid) {\r\n\t\t\t$('[data-tid=\"' + tid + '\"]').addClass('unread');\r\n\t\t}\r\n\r\n\t\t$(window).on('action:ajaxify.end', function (ev, data) {\r\n\t\t\tif (data.url) {\r\n\t\t\t\tvar tid = data.url.match(/^topic\\/(\\d+)/);\r\n\r\n\t\t\t\tif (tid && tid[1]) {\r\n\t\t\t\t\tdelete unreadTopics[tid[1]];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsocket.on('event:new_post', onNewPost);\r\n\t}\r\n\r\n\tfunction updateUnreadCounters(data) {\r\n\t\tupdateUnreadTopicCount('/unread', data.unreadTopicCount);\r\n\t\tupdateUnreadTopicCount('/unread?filter=new', data.unreadNewTopicCount);\r\n\t\tupdateUnreadTopicCount('/unread?filter=watched', data.unreadWatchedTopicCount);\r\n\t\tupdateUnreadTopicCount('/unread?filter=unreplied', data.unreadUnrepliedTopicCount);\r\n\t}\r\n\r\n\tsocket.on('event:unread.updateCount', updateUnreadCounters);\r\n\tsocket.on('event:unread.updateChatCount', updateUnreadChatCount);\r\n\r\n\tinitUnreadTopics();\r\n});\r\n"]}