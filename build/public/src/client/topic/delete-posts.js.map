{"version":3,"sources":["public/src/client/topic/delete-posts.js"],"names":["define","components","postSelect","DeletePosts","modal","deleteBtn","purgeBtn","init","$","on","onDeletePostsClicked","window","onAjaxifyStart","closeModal","off","app","parseAndTranslate","html","append","find","checkButtonEnable","showPostsSelected","deletePosts","btn","command","attr","socket","emit","tid","ajaxify","data","pids","err","removeAttr","alertError","message","length","translateHtml","remove","disable"],"mappings":"AAAA,aAGAA,OAAO,4BAA6B,aAAc,cAAe,SAAUC,EAAYC,GACtF,IAAIC,KACJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EAEJH,EAAYI,KAAO,WAClBC,EAAE,UAAUC,GAAG,QAAS,mCAAoCC,GAC5DF,EAAEG,QAAQF,GAAG,uBAAwBG,IAGtC,SAASA,IACRC,IACAL,EAAEG,QAAQG,IAAI,uBAAwBF,GAGvC,SAASF,IACR,GAAIN,EAAO,CACV,OAGDW,IAAIC,kBAAkB,iCAAmC,SAAUC,GAClEb,EAAQa,EAERT,EAAE,QAAQU,OAAOd,GAEjBC,EAAYD,EAAMe,KAAK,yBACvBb,EAAWF,EAAMe,KAAK,wBAEtBf,EAAMe,KAAK,+BAA+BV,GAAG,QAASI,GAEtDX,EAAWK,KAAK,WACfa,IACAC,MAEDA,IAEAhB,EAAUI,GAAG,QAAS,WACrBa,EAAYjB,EAAW,uBAExBC,EAASG,GAAG,QAAS,WACpBa,EAAYhB,EAAU,wBAKzB,SAASgB,EAAYC,EAAKC,GACzBD,EAAIE,KAAK,WAAY,MACrBC,OAAOC,KAAKH,GACXI,IAAKC,QAAQC,KAAKF,IAClBG,KAAM7B,EAAW6B,MACf,SAAUC,GACZT,EAAIU,WAAW,YACf,GAAID,EAAK,CACR,OAAOjB,IAAImB,WAAWF,EAAIG,SAG3BtB,MAIF,SAASQ,IACR,GAAInB,EAAW6B,KAAKK,OAAQ,CAC3BhC,EAAMe,KAAK,SAASkB,cAAc,2BAA6BnC,EAAW6B,KAAKK,OAAS,UAClF,CACNhC,EAAMe,KAAK,SAASkB,cAAc,2BAIpC,SAASjB,IACR,GAAIlB,EAAW6B,KAAKK,OAAQ,CAC3B/B,EAAU4B,WAAW,YACrB3B,EAAS2B,WAAW,gBACd,CACN5B,EAAUoB,KAAK,WAAY,MAC3BnB,EAASmB,KAAK,WAAY,OAI5B,SAASZ,IACR,GAAIT,EAAO,CACVA,EAAMkC,SACNlC,EAAQ,KAETF,EAAWqC,UAGZ,OAAOpC","file":"public/src/client/topic/delete-posts.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/topic/delete-posts', ['components', 'postSelect'], function (components, postSelect) {\r\n\tvar DeletePosts = {};\r\n\tvar modal;\r\n\tvar deleteBtn;\r\n\tvar purgeBtn;\r\n\r\n\tDeletePosts.init = function () {\r\n\t\t$('.topic').on('click', '[component=\"topic/delete/posts\"]', onDeletePostsClicked);\r\n\t\t$(window).on('action:ajaxify.start', onAjaxifyStart);\r\n\t};\r\n\r\n\tfunction onAjaxifyStart() {\r\n\t\tcloseModal();\r\n\t\t$(window).off('action:ajaxify.start', onAjaxifyStart);\r\n\t}\r\n\r\n\tfunction onDeletePostsClicked() {\r\n\t\tif (modal) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tapp.parseAndTranslate('partials/delete_posts_modal', {}, function (html) {\r\n\t\t\tmodal = html;\r\n\r\n\t\t\t$('body').append(modal);\r\n\r\n\t\t\tdeleteBtn = modal.find('#delete_posts_confirm');\r\n\t\t\tpurgeBtn = modal.find('#purge_posts_confirm');\r\n\r\n\t\t\tmodal.find('.close,#delete_posts_cancel').on('click', closeModal);\r\n\r\n\t\t\tpostSelect.init(function () {\r\n\t\t\t\tcheckButtonEnable();\r\n\t\t\t\tshowPostsSelected();\r\n\t\t\t});\r\n\t\t\tshowPostsSelected();\r\n\r\n\t\t\tdeleteBtn.on('click', function () {\r\n\t\t\t\tdeletePosts(deleteBtn, 'posts.deletePosts');\r\n\t\t\t});\r\n\t\t\tpurgeBtn.on('click', function () {\r\n\t\t\t\tdeletePosts(purgeBtn, 'posts.purgePosts');\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction deletePosts(btn, command) {\r\n\t\tbtn.attr('disabled', true);\r\n\t\tsocket.emit(command, {\r\n\t\t\ttid: ajaxify.data.tid,\r\n\t\t\tpids: postSelect.pids,\r\n\t\t}, function (err) {\r\n\t\t\tbtn.removeAttr('disabled');\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\r\n\t\t\tcloseModal();\r\n\t\t});\r\n\t}\r\n\r\n\tfunction showPostsSelected() {\r\n\t\tif (postSelect.pids.length) {\r\n\t\t\tmodal.find('#pids').translateHtml('[[topic:fork_pid_count, ' + postSelect.pids.length + ']]');\r\n\t\t} else {\r\n\t\t\tmodal.find('#pids').translateHtml('[[topic:fork_no_pids]]');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction checkButtonEnable() {\r\n\t\tif (postSelect.pids.length) {\r\n\t\t\tdeleteBtn.removeAttr('disabled');\r\n\t\t\tpurgeBtn.removeAttr('disabled');\r\n\t\t} else {\r\n\t\t\tdeleteBtn.attr('disabled', true);\r\n\t\t\tpurgeBtn.attr('disabled', true);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction closeModal() {\r\n\t\tif (modal) {\r\n\t\t\tmodal.remove();\r\n\t\t\tmodal = null;\r\n\t\t}\r\n\t\tpostSelect.disable();\r\n\t}\r\n\r\n\treturn DeletePosts;\r\n});\r\n"]}