{"version":3,"sources":["public/src/client/topic/diffs.js"],"names":["define","Images","Benchpress","translator","Diffs","open","pid","config","enablePostHistory","localeStringOpts","year","month","day","hour","minute","socket","emit","err","timestamps","app","alertError","message","parse","diffs","map","timestamp","parseInt","pretty","Date","toLocaleString","userLang","replace","numDiffs","length","html","translate","modal","bootbox","dialog","title","size","selectEl","find","postContainer","on","load","this","value","val","since","data","deleted","parseAndTranslate","posts","empty","append","unloadImages","loadImages"],"mappings":"AAAA,aAEAA,OAAO,qBAAsB,qBAAsB,aAAc,cAAe,SAAUC,EAAQC,EAAYC,GAC7G,IAAIC,KAEJA,EAAMC,KAAO,SAAUC,GACtB,IAAKC,OAAOC,kBAAmB,CAC9B,OAGD,IAAIC,GAAqBC,KAAM,UAAWC,MAAO,QAASC,IAAK,UAAWC,KAAM,UAAWC,OAAQ,WAEnGC,OAAOC,KAAK,kBAAoBV,IAAKA,GAAO,SAAUW,EAAKC,GAC1D,GAAID,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAG3BnB,EAAWoB,MAAM,gCAChBC,MAAOL,EAAWM,IAAI,SAAUC,GAC/BA,EAAYC,SAASD,EAAW,IAEhC,OACCA,UAAWA,EACXE,OAAQ,IAAIC,KAAKH,GAAWI,eAAetB,OAAOuB,SAASC,QAAQ,IAAK,KAAMtB,MAGhFuB,SAAUd,EAAWe,QACnB,SAAUC,GACZ/B,EAAWgC,UAAUD,EAAM,SAAUA,GACpC,IAAIE,EAAQC,QAAQC,QACnBC,MAAO,wBACPlB,QAASa,EACTM,KAAM,UAGP,IAAKtB,EAAWe,OAAQ,CACvB,OAGD,IAAIQ,EAAWL,EAAMM,KAAK,UAC1B,IAAIC,EAAgBP,EAAMM,KAAK,iBAE/BD,EAASG,GAAG,SAAU,WACrBxC,EAAMyC,KAAKvC,EAAKwC,KAAKC,MAAOJ,KAG7BP,EAAMQ,GAAG,iBAAkB,WAC1BxC,EAAMyC,KAAKvC,EAAKmC,EAASO,MAAOL,YAOrCvC,EAAMyC,KAAO,SAAUvC,EAAK2C,EAAON,GAClC,IAAKpC,OAAOC,kBAAmB,CAC9B,OAGDO,OAAOC,KAAK,oBAAsBV,IAAKA,EAAK2C,MAAOA,GAAS,SAAUhC,EAAKiC,GAC1E,GAAIjC,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAG3B6B,EAAKC,UAAYzB,SAASwB,EAAKC,QAAS,IAExChC,IAAIiC,kBAAkB,sBAAuB,SAC5CC,OAAQH,IACN,SAAUhB,GACZS,EAAcW,QAAQC,OAAOrB,GAC7BjC,EAAOuD,aAAatB,GACpBjC,EAAOwD,kBAKV,OAAOrD","file":"public/src/client/topic/diffs.js","sourcesContent":["'use strict';\r\n\r\ndefine('forum/topic/diffs', ['forum/topic/images', 'benchpress', 'translator'], function (Images, Benchpress, translator) {\r\n\tvar Diffs = {};\r\n\r\n\tDiffs.open = function (pid) {\r\n\t\tif (!config.enablePostHistory) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar localeStringOpts = { year: 'numeric', month: 'short', day: 'numeric', hour: 'numeric', minute: 'numeric' };\r\n\r\n\t\tsocket.emit('posts.getDiffs', { pid: pid }, function (err, timestamps) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\r\n\t\t\tBenchpress.parse('partials/modals/post_history', {\r\n\t\t\t\tdiffs: timestamps.map(function (timestamp) {\r\n\t\t\t\t\ttimestamp = parseInt(timestamp, 10);\r\n\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\ttimestamp: timestamp,\r\n\t\t\t\t\t\tpretty: new Date(timestamp).toLocaleString(config.userLang.replace('_', '-'), localeStringOpts),\r\n\t\t\t\t\t};\r\n\t\t\t\t}),\r\n\t\t\t\tnumDiffs: timestamps.length,\r\n\t\t\t}, function (html) {\r\n\t\t\t\ttranslator.translate(html, function (html) {\r\n\t\t\t\t\tvar modal = bootbox.dialog({\r\n\t\t\t\t\t\ttitle: '[[topic:diffs.title]]',\r\n\t\t\t\t\t\tmessage: html,\r\n\t\t\t\t\t\tsize: 'large',\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (!timestamps.length) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar selectEl = modal.find('select');\r\n\t\t\t\t\tvar postContainer = modal.find('ul.posts-list');\r\n\r\n\t\t\t\t\tselectEl.on('change', function () {\r\n\t\t\t\t\t\tDiffs.load(pid, this.value, postContainer);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tmodal.on('shown.bs.modal', function () {\r\n\t\t\t\t\t\tDiffs.load(pid, selectEl.val(), postContainer);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\tDiffs.load = function (pid, since, postContainer) {\r\n\t\tif (!config.enablePostHistory) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsocket.emit('posts.showPostAt', { pid: pid, since: since }, function (err, data) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\r\n\t\t\tdata.deleted = !!parseInt(data.deleted, 10);\r\n\r\n\t\t\tapp.parseAndTranslate('partials/posts_list', 'posts', {\r\n\t\t\t\tposts: [data],\r\n\t\t\t}, function (html) {\r\n\t\t\t\tpostContainer.empty().append(html);\r\n\t\t\t\tImages.unloadImages(html);\r\n\t\t\t\tImages.loadImages();\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\treturn Diffs;\r\n});\r\n"]}