"use strict";define("forum/topic/events",["forum/topic/postTools","forum/topic/threadTools","forum/topic/posts","forum/topic/images","components","translator","benchpress"],function(t,e,o,a,n,i,s){var p={};var r={"event:user_status_change":d,"event:voted":c,"event:bookmarked":u,"event:topic_deleted":e.setDeleteState,"event:topic_restored":e.setDeleteState,"event:topic_purged":l,"event:topic_locked":e.setLockedState,"event:topic_unlocked":e.setLockedState,"event:topic_pinned":e.setPinnedState,"event:topic_unpinned":e.setPinnedState,"event:topic_moved":f,"event:post_edited":g,"event:post_purged":v,"event:post_deleted":k,"event:post_restored":k,"posts.bookmark":h,"posts.unbookmark":h,"posts.upvote":I,"posts.downvote":I,"posts.unvote":I,"event:new_notification":w,"event:new_post":o.onNewPost};p.init=function(){p.removeListeners();for(var t in r){if(r.hasOwnProperty(t)){socket.on(t,r[t])}}};p.removeListeners=function(){for(var t in r){if(r.hasOwnProperty(t)){socket.removeListener(t,r[t])}}};function d(t){app.updateUserStatus($('[data-uid="'+t.uid+'"] [component="user/status"]'),t.status)}function c(t){var e=$('[data-pid="'+t.post.pid+'"] [component="post/vote-count"]').filter(function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)});var o=$('.reputation[data-uid="'+t.post.uid+'"]');e.html(t.post.votes).attr("data-votes",t.post.votes);o.html(t.user.reputation).attr("data-reputation",t.user.reputation)}function u(t){$('[data-pid="'+t.post.pid+'"] .bookmarkCount').filter(function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}).html(t.post.bookmarks).attr("data-bookmarks",t.post.bookmarks)}function l(){if(ajaxify.data.category&&ajaxify.data.category.slug){ajaxify.go("category/"+ajaxify.data.category.slug,null,true)}}function f(t){if(t&&t.slug){ajaxify.go("topic/"+t.slug,null,true)}}function g(e){if(!e||!e.post){return}var o=n.get("post/content",e.post.pid).filter(function(t,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)});var p=$('[data-pid="'+e.post.pid+'"] [component="post/editor"]').filter(function(t,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)});var r=n.get("topic/title");var d=n.get("navbar/title").find("span");var c=n.get("breadcrumb/current");if(r.length&&e.topic.title&&r.html()!==e.topic.title){ajaxify.data.title=e.topic.title;var u="topic/"+e.topic.slug+(window.location.search?window.location.search:"");history.replaceState({url:u},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+u);r.fadeOut(250,function(){r.html(e.topic.title).fadeIn(250)});c.fadeOut(250,function(){c.html(e.topic.title).fadeIn(250)});d.fadeOut(250,function(){d.html(e.topic.title).fadeIn(250)})}o.fadeOut(250,function(){o.html(i.unescape(e.post.content));o.find("img:not(.not-responsive)").addClass("img-responsive");app.replaceSelfLinks(o.find("a"));a.wrapImagesInLinks(o.parent());a.unloadImages(o.parent());a.loadImages();o.fadeIn(250);var t={editor:e.editor,editedISO:utils.toISOString(e.post.edited)};s.parse("partials/topic/post-editor",t,function(t){i.translate(t,function(o){t=$(o);p.replaceWith(t);$('[data-pid="'+e.post.pid+'"] [component="post/editor"] .timeago').timeago();$(window).trigger("action:posts.edited",e)})})});if(e.topic.tags&&m(e.topic.tags)){s.parse("partials/post_bar","tags",{tags:e.topic.tags},function(t){var e=$(".tags");e.fadeOut(250,function(){e.html(t).fadeIn(250)})})}t.removeMenu(n.get("post","pid",e.post.pid))}function m(t){if(t.length!==$(".tags").first().children().length){return true}for(var e=0;e<t.length;e+=1){if(!$('.tags .tag-item[data-tag="'+t[e].value+'"]').length){return true}}return false}function v(e){n.get("post","pid",e.pid).fadeOut(500,function(){$(this).remove();o.showBottomPostBar()});ajaxify.data.postcount-=1;t.updatePostCount(ajaxify.data.postcount);require(["forum/topic/replies"],function(t){t.onPostPurged(e)})}function k(e){var o=n.get("post","pid",e.pid);if(!o.length){return}o.toggleClass("deleted");var a=o.hasClass("deleted");t.toggle(e.pid,a);if(!ajaxify.data.privileges.isAdminOrMod&&parseInt(e.uid,10)!==parseInt(app.user.uid,10)){o.find('[component="post/tools"]').toggleClass("hidden",a);if(a){o.find('[component="post/content"]').translateHtml("[[topic:post_is_deleted]]")}else{o.find('[component="post/content"]').html(i.unescape(e.content))}}}function h(t){var e=$('[data-pid="'+t.post.pid+'"] [component="post/bookmark"]').filter(function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)});if(!e.length){return}e.attr("data-bookmarked",t.isBookmarked);e.find('[component="post/bookmark/on"]').toggleClass("hidden",!t.isBookmarked);e.find('[component="post/bookmark/off"]').toggleClass("hidden",t.isBookmarked)}function I(t){var e=$('[data-pid="'+t.post.pid+'"]');e.find('[component="post/upvote"]').filter(function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}).toggleClass("upvoted",t.upvote);e.find('[component="post/downvote"]').filter(function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}).toggleClass("downvoted",t.downvote)}function w(t){var e=ajaxify.data.tid;if(t&&t.tid&&parseInt(t.tid,10)===parseInt(e,10)){socket.emit("topics.markTopicNotificationsRead",[e])}}return p});
//# sourceMappingURL=public/src/client/topic/events.js.map