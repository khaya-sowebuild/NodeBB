{"version":3,"sources":["public/src/client/topic/events.js"],"names":["define","postTools","threadTools","posts","images","components","translator","Benchpress","Events","events","event:user_status_change","onUserStatusChange","event:voted","updatePostVotesAndUserReputation","event:bookmarked","updateBookmarkCount","event:topic_deleted","setDeleteState","event:topic_restored","event:topic_purged","onTopicPurged","event:topic_locked","setLockedState","event:topic_unlocked","event:topic_pinned","setPinnedState","event:topic_unpinned","event:topic_moved","onTopicMoved","event:post_edited","onPostEdited","event:post_purged","onPostPurged","event:post_deleted","togglePostDeleteState","event:post_restored","posts.bookmark","togglePostBookmark","posts.unbookmark","posts.upvote","togglePostVote","posts.downvote","posts.unvote","event:new_notification","onNewNotification","event:new_post","onNewPost","init","removeListeners","eventName","hasOwnProperty","socket","on","removeListener","data","app","updateUserStatus","$","uid","status","votes","post","pid","filter","index","el","parseInt","closest","attr","reputationElements","html","user","reputation","bookmarks","ajaxify","category","slug","go","editedPostEl","get","editorEl","topicTitle","navbarTitle","find","breadCrumb","length","topic","title","newUrl","window","location","search","history","replaceState","url","protocol","host","config","relative_path","fadeOut","fadeIn","unescape","content","addClass","replaceSelfLinks","wrapImagesInLinks","parent","unloadImages","loadImages","editData","editor","editedISO","utils","toISOString","edited","parse","translate","translated","replaceWith","timeago","trigger","tags","tagsUpdated","removeMenu","first","children","i","value","postData","this","remove","showBottomPostBar","postcount","updatePostCount","require","replies","postEl","toggleClass","isDeleted","hasClass","toggle","privileges","isAdminOrMod","translateHtml","isBookmarked","upvote","downvote","tid","emit"],"mappings":"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","file":"public/src/client/topic/events.js","sourcesContent":["\r\n'use strict';\r\n\r\n\r\ndefine('forum/topic/events', [\r\n\t'forum/topic/postTools',\r\n\t'forum/topic/threadTools',\r\n\t'forum/topic/posts',\r\n\t'forum/topic/images',\r\n\t'components',\r\n\t'translator',\r\n\t'benchpress',\r\n], function (postTools, threadTools, posts, images, components, translator, Benchpress) {\r\n\tvar Events = {};\r\n\r\n\tvar events = {\r\n\t\t'event:user_status_change': onUserStatusChange,\r\n\t\t'event:voted': updatePostVotesAndUserReputation,\r\n\t\t'event:bookmarked': updateBookmarkCount,\r\n\r\n\t\t'event:topic_deleted': threadTools.setDeleteState,\r\n\t\t'event:topic_restored': threadTools.setDeleteState,\r\n\t\t'event:topic_purged': onTopicPurged,\r\n\r\n\t\t'event:topic_locked': threadTools.setLockedState,\r\n\t\t'event:topic_unlocked': threadTools.setLockedState,\r\n\r\n\t\t'event:topic_pinned': threadTools.setPinnedState,\r\n\t\t'event:topic_unpinned': threadTools.setPinnedState,\r\n\r\n\t\t'event:topic_moved': onTopicMoved,\r\n\r\n\t\t'event:post_edited': onPostEdited,\r\n\t\t'event:post_purged': onPostPurged,\r\n\r\n\t\t'event:post_deleted': togglePostDeleteState,\r\n\t\t'event:post_restored': togglePostDeleteState,\r\n\r\n\t\t'posts.bookmark': togglePostBookmark,\r\n\t\t'posts.unbookmark': togglePostBookmark,\r\n\r\n\t\t'posts.upvote': togglePostVote,\r\n\t\t'posts.downvote': togglePostVote,\r\n\t\t'posts.unvote': togglePostVote,\r\n\r\n\t\t'event:new_notification': onNewNotification,\r\n\t\t'event:new_post': posts.onNewPost,\r\n\t};\r\n\r\n\tEvents.init = function () {\r\n\t\tEvents.removeListeners();\r\n\t\tfor (var eventName in events) {\r\n\t\t\tif (events.hasOwnProperty(eventName)) {\r\n\t\t\t\tsocket.on(eventName, events[eventName]);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tEvents.removeListeners = function () {\r\n\t\tfor (var eventName in events) {\r\n\t\t\tif (events.hasOwnProperty(eventName)) {\r\n\t\t\t\tsocket.removeListener(eventName, events[eventName]);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tfunction onUserStatusChange(data) {\r\n\t\tapp.updateUserStatus($('[data-uid=\"' + data.uid + '\"] [component=\"user/status\"]'), data.status);\r\n\t}\r\n\r\n\tfunction updatePostVotesAndUserReputation(data) {\r\n\t\tvar votes = $('[data-pid=\"' + data.post.pid + '\"] [component=\"post/vote-count\"]').filter(function (index, el) {\r\n\t\t\treturn parseInt($(el).closest('[data-pid]').attr('data-pid'), 10) === parseInt(data.post.pid, 10);\r\n\t\t});\r\n\t\tvar reputationElements = $('.reputation[data-uid=\"' + data.post.uid + '\"]');\r\n\t\tvotes.html(data.post.votes).attr('data-votes', data.post.votes);\r\n\t\treputationElements.html(data.user.reputation).attr('data-reputation', data.user.reputation);\r\n\t}\r\n\r\n\tfunction updateBookmarkCount(data) {\r\n\t\t$('[data-pid=\"' + data.post.pid + '\"] .bookmarkCount').filter(function (index, el) {\r\n\t\t\treturn parseInt($(el).closest('[data-pid]').attr('data-pid'), 10) === parseInt(data.post.pid, 10);\r\n\t\t}).html(data.post.bookmarks).attr('data-bookmarks', data.post.bookmarks);\r\n\t}\r\n\r\n\tfunction onTopicPurged() {\r\n\t\tif (ajaxify.data.category && ajaxify.data.category.slug) {\r\n\t\t\tajaxify.go('category/' + ajaxify.data.category.slug, null, true);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onTopicMoved(data) {\r\n\t\tif (data && data.slug) {\r\n\t\t\tajaxify.go('topic/' + data.slug, null, true);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onPostEdited(data) {\r\n\t\tif (!data || !data.post) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar editedPostEl = components.get('post/content', data.post.pid).filter(function (index, el) {\r\n\t\t\treturn parseInt($(el).closest('[data-pid]').attr('data-pid'), 10) === parseInt(data.post.pid, 10);\r\n\t\t});\r\n\r\n\t\tvar editorEl = $('[data-pid=\"' + data.post.pid + '\"] [component=\"post/editor\"]').filter(function (index, el) {\r\n\t\t\treturn parseInt($(el).closest('[data-pid]').attr('data-pid'), 10) === parseInt(data.post.pid, 10);\r\n\t\t});\r\n\t\tvar topicTitle = components.get('topic/title');\r\n\t\tvar navbarTitle = components.get('navbar/title').find('span');\r\n\t\tvar breadCrumb = components.get('breadcrumb/current');\r\n\r\n\t\tif (topicTitle.length && data.topic.title && topicTitle.html() !== data.topic.title) {\r\n\t\t\tajaxify.data.title = data.topic.title;\r\n\t\t\tvar newUrl = 'topic/' + data.topic.slug + (window.location.search ? window.location.search : '');\r\n\t\t\thistory.replaceState({ url: newUrl }, null, window.location.protocol + '//' + window.location.host + config.relative_path + '/' + newUrl);\r\n\r\n\t\t\ttopicTitle.fadeOut(250, function () {\r\n\t\t\t\ttopicTitle.html(data.topic.title).fadeIn(250);\r\n\t\t\t});\r\n\t\t\tbreadCrumb.fadeOut(250, function () {\r\n\t\t\t\tbreadCrumb.html(data.topic.title).fadeIn(250);\r\n\t\t\t});\r\n\t\t\tnavbarTitle.fadeOut(250, function () {\r\n\t\t\t\tnavbarTitle.html(data.topic.title).fadeIn(250);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\teditedPostEl.fadeOut(250, function () {\r\n\t\t\teditedPostEl.html(translator.unescape(data.post.content));\r\n\t\t\teditedPostEl.find('img:not(.not-responsive)').addClass('img-responsive');\r\n\t\t\tapp.replaceSelfLinks(editedPostEl.find('a'));\r\n\t\t\timages.wrapImagesInLinks(editedPostEl.parent());\r\n\t\t\timages.unloadImages(editedPostEl.parent());\r\n\t\t\timages.loadImages();\r\n\t\t\teditedPostEl.fadeIn(250);\r\n\r\n\t\t\tvar editData = {\r\n\t\t\t\teditor: data.editor,\r\n\t\t\t\teditedISO: utils.toISOString(data.post.edited),\r\n\t\t\t};\r\n\r\n\t\t\tBenchpress.parse('partials/topic/post-editor', editData, function (html) {\r\n\t\t\t\ttranslator.translate(html, function (translated) {\r\n\t\t\t\t\thtml = $(translated);\r\n\t\t\t\t\teditorEl.replaceWith(html);\r\n\t\t\t\t\t$('[data-pid=\"' + data.post.pid + '\"] [component=\"post/editor\"] .timeago').timeago();\r\n\t\t\t\t\t$(window).trigger('action:posts.edited', data);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tif (data.topic.tags && tagsUpdated(data.topic.tags)) {\r\n\t\t\tBenchpress.parse('partials/post_bar', 'tags', { tags: data.topic.tags }, function (html) {\r\n\t\t\t\tvar tags = $('.tags');\r\n\r\n\t\t\t\ttags.fadeOut(250, function () {\r\n\t\t\t\t\ttags.html(html).fadeIn(250);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tpostTools.removeMenu(components.get('post', 'pid', data.post.pid));\r\n\t}\r\n\r\n\tfunction tagsUpdated(tags) {\r\n\t\tif (tags.length !== $('.tags').first().children().length) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i < tags.length; i += 1) {\r\n\t\t\tif (!$('.tags .tag-item[data-tag=\"' + tags[i].value + '\"]').length) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction onPostPurged(postData) {\r\n\t\tcomponents.get('post', 'pid', postData.pid).fadeOut(500, function () {\r\n\t\t\t$(this).remove();\r\n\t\t\tposts.showBottomPostBar();\r\n\t\t});\r\n\t\tajaxify.data.postcount -= 1;\r\n\t\tpostTools.updatePostCount(ajaxify.data.postcount);\r\n\t\trequire(['forum/topic/replies'], function (replies) {\r\n\t\t\treplies.onPostPurged(postData);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction togglePostDeleteState(data) {\r\n\t\tvar postEl = components.get('post', 'pid', data.pid);\r\n\r\n\t\tif (!postEl.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tpostEl.toggleClass('deleted');\r\n\t\tvar isDeleted = postEl.hasClass('deleted');\r\n\t\tpostTools.toggle(data.pid, isDeleted);\r\n\r\n\t\tif (!ajaxify.data.privileges.isAdminOrMod && parseInt(data.uid, 10) !== parseInt(app.user.uid, 10)) {\r\n\t\t\tpostEl.find('[component=\"post/tools\"]').toggleClass('hidden', isDeleted);\r\n\t\t\tif (isDeleted) {\r\n\t\t\t\tpostEl.find('[component=\"post/content\"]').translateHtml('[[topic:post_is_deleted]]');\r\n\t\t\t} else {\r\n\t\t\t\tpostEl.find('[component=\"post/content\"]').html(translator.unescape(data.content));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction togglePostBookmark(data) {\r\n\t\tvar el = $('[data-pid=\"' + data.post.pid + '\"] [component=\"post/bookmark\"]').filter(function (index, el) {\r\n\t\t\treturn parseInt($(el).closest('[data-pid]').attr('data-pid'), 10) === parseInt(data.post.pid, 10);\r\n\t\t});\r\n\t\tif (!el.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tel.attr('data-bookmarked', data.isBookmarked);\r\n\r\n\t\tel.find('[component=\"post/bookmark/on\"]').toggleClass('hidden', !data.isBookmarked);\r\n\t\tel.find('[component=\"post/bookmark/off\"]').toggleClass('hidden', data.isBookmarked);\r\n\t}\r\n\r\n\tfunction togglePostVote(data) {\r\n\t\tvar post = $('[data-pid=\"' + data.post.pid + '\"]');\r\n\t\tpost.find('[component=\"post/upvote\"]').filter(function (index, el) {\r\n\t\t\treturn parseInt($(el).closest('[data-pid]').attr('data-pid'), 10) === parseInt(data.post.pid, 10);\r\n\t\t}).toggleClass('upvoted', data.upvote);\r\n\t\tpost.find('[component=\"post/downvote\"]').filter(function (index, el) {\r\n\t\t\treturn parseInt($(el).closest('[data-pid]').attr('data-pid'), 10) === parseInt(data.post.pid, 10);\r\n\t\t}).toggleClass('downvoted', data.downvote);\r\n\t}\r\n\r\n\tfunction onNewNotification(data) {\r\n\t\tvar tid = ajaxify.data.tid;\r\n\t\tif (data && data.tid && parseInt(data.tid, 10) === parseInt(tid, 10)) {\r\n\t\t\tsocket.emit('topics.markTopicNotificationsRead', [tid]);\r\n\t\t}\r\n\t}\r\n\r\n\treturn Events;\r\n});\r\n"]}