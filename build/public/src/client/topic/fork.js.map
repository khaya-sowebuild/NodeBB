{"version":3,"sources":["public/src/client/topic/fork.js"],"names":["define","components","postSelect","Fork","forkModal","forkCommit","init","$","on","onForkThreadClicked","window","onAjaxifyStart","closeForkModal","off","app","parseAndTranslate","html","find","document","body","append","checkForkButtonEnable","showPostsSelected","createTopicFromPosts","attr","socket","emit","title","val","pids","fromTid","ajaxify","data","tid","err","newTopic","fadeOutAndRemove","pid","get","fadeOut","this","remove","removeAttr","alertError","message","alert","timeout","type","clickfn","go","slug","forEach","length","translateHtml","disable"],"mappings":"AAAA,aAGAA,OAAO,oBAAqB,aAAc,cAAe,SAAUC,EAAYC,GAC9E,IAAIC,KACJ,IAAIC,EACJ,IAAIC,EAEJF,EAAKG,KAAO,WACXC,EAAE,UAAUC,GAAG,QAAS,2BAA4BC,GACpDF,EAAEG,QAAQF,GAAG,uBAAwBG,IAGtC,SAASA,IACRC,IACAL,EAAEG,QAAQG,IAAI,uBAAwBF,GAGvC,SAASF,IACR,GAAIL,EAAW,CACd,OAGDU,IAAIC,kBAAkB,gCAAkC,SAAUC,GACjEZ,EAAYY,EAEZX,EAAaD,EAAUa,KAAK,uBAE5BV,EAAEW,SAASC,MAAMC,OAAOhB,GAExBA,EAAUa,KAAK,8BAA8BT,GAAG,QAASI,GACzDR,EAAUa,KAAK,eAAeT,GAAG,QAASa,GAE1CnB,EAAWI,KAAK,WACfe,IACAC,MAEDA,IAEAjB,EAAWG,GAAG,QAASe,KAIzB,SAASA,IACRlB,EAAWmB,KAAK,WAAY,MAC5BC,OAAOC,KAAK,+BACXC,MAAOvB,EAAUa,KAAK,eAAeW,MACrCC,KAAM3B,EAAW2B,KACjBC,QAASC,QAAQC,KAAKC,KACpB,SAAUC,EAAKC,GACjB,SAASC,EAAiBC,GACzBpC,EAAWqC,IAAI,OAAQ,MAAOD,GAAKE,QAAQ,IAAK,WAC/ChC,EAAEiC,MAAMC,WAGVpC,EAAWqC,WAAW,YACtB,GAAIR,EAAK,CACR,OAAOpB,IAAI6B,WAAWT,EAAIU,SAG3B9B,IAAI+B,OACHC,QAAS,IACTnB,MAAO,2BACPiB,QAAS,yBACTG,KAAM,UACNC,QAAS,WACRjB,QAAQkB,GAAG,SAAWd,EAASe,SAIjChD,EAAW2B,KAAKsB,QAAQ,SAAUd,GACjCD,EAAiBC,KAGlBzB,MAIF,SAASU,IACR,GAAIpB,EAAW2B,KAAKuB,OAAQ,CAC3BhD,EAAUa,KAAK,cAAcoC,cAAc,2BAA6BnD,EAAW2B,KAAKuB,OAAS,UAC3F,CACNhD,EAAUa,KAAK,cAAcoC,cAAc,2BAI7C,SAAShC,IACR,GAAIjB,EAAUa,KAAK,eAAeW,MAAMwB,QAAUlD,EAAW2B,KAAKuB,OAAQ,CACzE/C,EAAWqC,WAAW,gBAChB,CACNrC,EAAWmB,KAAK,WAAY,OAI9B,SAASZ,IACR,GAAIR,EAAW,CACdA,EAAUqC,SACVrC,EAAY,KAGbF,EAAWoD,UAGZ,OAAOnD","file":"public/src/client/topic/fork.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/topic/fork', ['components', 'postSelect'], function (components, postSelect) {\r\n\tvar Fork = {};\r\n\tvar forkModal;\r\n\tvar forkCommit;\r\n\r\n\tFork.init = function () {\r\n\t\t$('.topic').on('click', '[component=\"topic/fork\"]', onForkThreadClicked);\r\n\t\t$(window).on('action:ajaxify.start', onAjaxifyStart);\r\n\t};\r\n\r\n\tfunction onAjaxifyStart() {\r\n\t\tcloseForkModal();\r\n\t\t$(window).off('action:ajaxify.start', onAjaxifyStart);\r\n\t}\r\n\r\n\tfunction onForkThreadClicked() {\r\n\t\tif (forkModal) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tapp.parseAndTranslate('partials/fork_thread_modal', {}, function (html) {\r\n\t\t\tforkModal = html;\r\n\r\n\t\t\tforkCommit = forkModal.find('#fork_thread_commit');\r\n\r\n\t\t\t$(document.body).append(forkModal);\r\n\r\n\t\t\tforkModal.find('.close,#fork_thread_cancel').on('click', closeForkModal);\r\n\t\t\tforkModal.find('#fork-title').on('keyup', checkForkButtonEnable);\r\n\r\n\t\t\tpostSelect.init(function () {\r\n\t\t\t\tcheckForkButtonEnable();\r\n\t\t\t\tshowPostsSelected();\r\n\t\t\t});\r\n\t\t\tshowPostsSelected();\r\n\r\n\t\t\tforkCommit.on('click', createTopicFromPosts);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction createTopicFromPosts() {\r\n\t\tforkCommit.attr('disabled', true);\r\n\t\tsocket.emit('topics.createTopicFromPosts', {\r\n\t\t\ttitle: forkModal.find('#fork-title').val(),\r\n\t\t\tpids: postSelect.pids,\r\n\t\t\tfromTid: ajaxify.data.tid,\r\n\t\t}, function (err, newTopic) {\r\n\t\t\tfunction fadeOutAndRemove(pid) {\r\n\t\t\t\tcomponents.get('post', 'pid', pid).fadeOut(500, function () {\r\n\t\t\t\t\t$(this).remove();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tforkCommit.removeAttr('disabled');\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\r\n\t\t\tapp.alert({\r\n\t\t\t\ttimeout: 5000,\r\n\t\t\t\ttitle: '[[global:alert.success]]',\r\n\t\t\t\tmessage: '[[topic:fork_success]]',\r\n\t\t\t\ttype: 'success',\r\n\t\t\t\tclickfn: function () {\r\n\t\t\t\t\tajaxify.go('topic/' + newTopic.slug);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\r\n\t\t\tpostSelect.pids.forEach(function (pid) {\r\n\t\t\t\tfadeOutAndRemove(pid);\r\n\t\t\t});\r\n\r\n\t\t\tcloseForkModal();\r\n\t\t});\r\n\t}\r\n\r\n\tfunction showPostsSelected() {\r\n\t\tif (postSelect.pids.length) {\r\n\t\t\tforkModal.find('#fork-pids').translateHtml('[[topic:fork_pid_count, ' + postSelect.pids.length + ']]');\r\n\t\t} else {\r\n\t\t\tforkModal.find('#fork-pids').translateHtml('[[topic:fork_no_pids]]');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction checkForkButtonEnable() {\r\n\t\tif (forkModal.find('#fork-title').val().length && postSelect.pids.length) {\r\n\t\t\tforkCommit.removeAttr('disabled');\r\n\t\t} else {\r\n\t\t\tforkCommit.attr('disabled', true);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction closeForkModal() {\r\n\t\tif (forkModal) {\r\n\t\t\tforkModal.remove();\r\n\t\t\tforkModal = null;\r\n\t\t}\r\n\r\n\t\tpostSelect.disable();\r\n\t}\r\n\r\n\treturn Fork;\r\n});\r\n"]}