{"version":3,"sources":["public/src/client/topic/merge.js"],"names":["define","Merge","modal","mergeBtn","selectedTids","init","$","on","onMergeTopicsClicked","app","parseAndTranslate","html","append","find","closeModal","onTopicClicked","showTopicsSelected","mergeTopics","ev","tid","this","parents","attr","socket","emit","err","topicData","alertError","title","checkButtonEnable","preventDefault","stopPropagation","btn","tids","Object","keys","removeAttr","message","ajaxify","go","sort","a","b","topics","map","length","translateHtml","remove","off"],"mappings":"AAAA,aAGAA,OAAO,oBAAqB,WAC3B,IAAIC,KACJ,IAAIC,EACJ,IAAIC,EAEJ,IAAIC,KAEJH,EAAMI,KAAO,WACZC,EAAE,aAAaC,GAAG,QAAS,4BAA6BC,IAGzD,SAASA,IACR,GAAIN,EAAO,CACV,OAEDO,IAAIC,kBAAkB,iCAAmC,SAAUC,GAClET,EAAQS,EAERL,EAAE,QAAQM,OAAOV,GAEjBC,EAAWD,EAAMW,KAAK,yBAEtBX,EAAMW,KAAK,+BAA+BN,GAAG,QAASO,GAEtDR,EAAE,YAAYC,GAAG,QAAS,wDAAyDQ,GAEnFC,IAEAb,EAASI,GAAG,QAAS,WACpBU,EAAYd,OAKf,SAASY,EAAeG,GACvB,IAAIC,EAAMb,EAAEc,MAAMC,QAAQ,gCAAgCC,KAAK,YAC/DC,OAAOC,KAAK,kBAAmBL,EAAK,SAAUM,EAAKC,GAClD,GAAID,EAAK,CACR,OAAOhB,IAAIkB,WAAWF,GAEvB,IAAIG,EAAQF,EAAYA,EAAUE,MAAQ,WAC1C,GAAIxB,EAAae,GAAM,QACff,EAAae,OACd,CACNf,EAAae,GAAOS,EAErBC,IACAb,MAEDE,EAAGY,iBACHZ,EAAGa,kBACH,OAAO,MAGR,SAASd,EAAYe,GACpBA,EAAIV,KAAK,WAAY,MACrB,IAAIW,EAAOC,OAAOC,KAAK/B,GACvBmB,OAAOC,KAAK,eAAgBS,EAAM,SAAUR,GAC3CO,EAAII,WAAW,YACf,GAAIX,EAAK,CACR,OAAOhB,IAAIkB,WAAWF,EAAIY,SAE3BC,QAAQC,GAAG,UAAYN,EAAK,IAC5BnB,MAIF,SAASE,IACR,IAAIiB,EAAOC,OAAOC,KAAK/B,GACvB6B,EAAKO,KAAK,SAAUC,EAAGC,GACtB,OAAOD,EAAIC,IAGZ,IAAIC,EAASV,EAAKW,IAAI,SAAUzB,GAC/B,OAASA,IAAKA,EAAKS,MAAOxB,EAAae,MAGxC,GAAIc,EAAKY,OAAQ,CAChBpC,IAAIC,kBAAkB,8BAA+B,UAAYiC,OAAQA,GAAU,SAAUhC,GAC5FT,EAAMW,KAAK,mBAAmBF,KAAKA,SAE9B,CACNT,EAAMW,KAAK,mBAAmBiC,cAAc,iCAI9C,SAASjB,IACR,GAAIK,OAAOC,KAAK/B,GAAcyC,OAAQ,CACrC1C,EAASiC,WAAW,gBACd,CACNjC,EAASmB,KAAK,WAAY,OAI5B,SAASR,IACR,GAAIZ,EAAO,CACVA,EAAM6C,SACN7C,EAAQ,KAETE,KACAE,EAAE,YAAY0C,IAAI,QAAS,wDAAyDjC,GAGrF,OAAOd","file":"public/src/client/topic/merge.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/topic/merge', function () {\r\n\tvar Merge = {};\r\n\tvar modal;\r\n\tvar mergeBtn;\r\n\r\n\tvar selectedTids = {};\r\n\r\n\tMerge.init = function () {\r\n\t\t$('.category').on('click', '[component=\"topic/merge\"]', onMergeTopicsClicked);\r\n\t};\r\n\r\n\tfunction onMergeTopicsClicked() {\r\n\t\tif (modal) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tapp.parseAndTranslate('partials/merge_topics_modal', {}, function (html) {\r\n\t\t\tmodal = html;\r\n\r\n\t\t\t$('body').append(modal);\r\n\r\n\t\t\tmergeBtn = modal.find('#merge_topics_confirm');\r\n\r\n\t\t\tmodal.find('.close,#merge_topics_cancel').on('click', closeModal);\r\n\r\n\t\t\t$('#content').on('click', '[component=\"category\"] [component=\"category/topic\"] a', onTopicClicked);\r\n\r\n\t\t\tshowTopicsSelected();\r\n\r\n\t\t\tmergeBtn.on('click', function () {\r\n\t\t\t\tmergeTopics(mergeBtn);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction onTopicClicked(ev) {\r\n\t\tvar tid = $(this).parents('[component=\"category/topic\"]').attr('data-tid');\r\n\t\tsocket.emit('topics.getTopic', tid, function (err, topicData) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err);\r\n\t\t\t}\r\n\t\t\tvar title = topicData ? topicData.title : 'No title';\r\n\t\t\tif (selectedTids[tid]) {\r\n\t\t\t\tdelete selectedTids[tid];\r\n\t\t\t} else {\r\n\t\t\t\tselectedTids[tid] = title;\r\n\t\t\t}\r\n\t\t\tcheckButtonEnable();\r\n\t\t\tshowTopicsSelected();\r\n\t\t});\r\n\t\tev.preventDefault();\r\n\t\tev.stopPropagation();\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction mergeTopics(btn) {\r\n\t\tbtn.attr('disabled', true);\r\n\t\tvar tids = Object.keys(selectedTids);\r\n\t\tsocket.emit('topics.merge', tids, function (err) {\r\n\t\t\tbtn.removeAttr('disabled');\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\t\t\tajaxify.go('/topic/' + tids[0]);\r\n\t\t\tcloseModal();\r\n\t\t});\r\n\t}\r\n\r\n\tfunction showTopicsSelected() {\r\n\t\tvar tids = Object.keys(selectedTids);\r\n\t\ttids.sort(function (a, b) {\r\n\t\t\treturn a - b;\r\n\t\t});\r\n\r\n\t\tvar topics = tids.map(function (tid) {\r\n\t\t\treturn { tid: tid, title: selectedTids[tid] };\r\n\t\t});\r\n\r\n\t\tif (tids.length) {\r\n\t\t\tapp.parseAndTranslate('partials/merge_topics_modal', 'topics', { topics: topics }, function (html) {\r\n\t\t\t\tmodal.find('.topics-section').html(html);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tmodal.find('.topics-section').translateHtml('[[error:no-topics-selected]]');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction checkButtonEnable() {\r\n\t\tif (Object.keys(selectedTids).length) {\r\n\t\t\tmergeBtn.removeAttr('disabled');\r\n\t\t} else {\r\n\t\t\tmergeBtn.attr('disabled', true);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction closeModal() {\r\n\t\tif (modal) {\r\n\t\t\tmodal.remove();\r\n\t\t\tmodal = null;\r\n\t\t}\r\n\t\tselectedTids = {};\r\n\t\t$('#content').off('click', '[component=\"category\"] [component=\"category/topic\"] a', onTopicClicked);\r\n\t}\r\n\r\n\treturn Merge;\r\n});\r\n"]}