{"version":3,"sources":["public/src/client/topic/move-post.js"],"names":["define","components","postSelect","MovePost","moveModal","moveCommit","init","$","on","onMovePostsClicked","window","onAjaxifyStart","closeMoveModal","off","openMovePostModal","showPostsSelected","pids","length","find","translateHtml","checkMoveButtonEnable","val","removeAttr","attr","postEl","app","parseAndTranslate","html","document","body","append","onPostToggled","togglePostSelection","movePosts","tid","socket","emit","err","alertError","message","forEach","pid","get","fadeOut","this","remove","disable"],"mappings":"AAAA,aAGAA,OAAO,yBAA0B,aAAc,cAAe,SAAUC,EAAYC,GACnF,IAAIC,KAEJ,IAAIC,EACJ,IAAIC,EAEJF,EAASG,KAAO,WACfC,EAAE,UAAUC,GAAG,QAAS,iCAAkCC,GAC1DF,EAAEG,QAAQF,GAAG,uBAAwBG,IAGtC,SAASA,IACRC,IACAL,EAAEG,QAAQG,IAAI,uBAAwBF,GAGvC,SAASF,IACRN,EAASW,oBAGV,SAASC,IACR,GAAIb,EAAWc,KAAKC,OAAQ,CAC3Bb,EAAUc,KAAK,SAASC,cAAc,2BAA6BjB,EAAWc,KAAKC,OAAS,UACtF,CACNb,EAAUc,KAAK,SAASC,cAAc,2BAIxC,SAASC,IACR,GAAIhB,EAAUc,KAAK,YAAYG,MAAMJ,QAAUf,EAAWc,KAAKC,OAAQ,CACtEZ,EAAWiB,WAAW,gBAChB,CACNjB,EAAWkB,KAAK,WAAY,OAI9BpB,EAASW,kBAAoB,SAAUU,GACtCC,IAAIC,kBAAkB,8BAAgC,SAAUC,GAC/DvB,EAAYuB,EAEZtB,EAAaD,EAAUc,KAAK,uBAE5BX,EAAEqB,SAASC,MAAMC,OAAO1B,GAExBA,EAAUc,KAAK,6BAA6BV,GAAG,QAASI,GACxDR,EAAUc,KAAK,YAAYV,GAAG,QAASY,GACvClB,EAAWI,KAAKyB,GAChBhB,IAEA,GAAIS,EAAQ,CACXtB,EAAW8B,oBAAoBR,EAAQO,GAGxC1B,EAAWG,GAAG,QAAS,WACtByB,SAKH,SAASF,IACRX,IACAL,IAGD,SAASkB,IACR,IAAIC,EAAM9B,EAAUc,KAAK,YAAYG,MACrCc,OAAOC,KAAK,mBAAqBpB,KAAMd,EAAWc,KAAMkB,IAAKA,GAAO,SAAUG,GAC7E,GAAIA,EAAK,CACR,OAAOZ,IAAIa,WAAWD,EAAIE,SAE3BrC,EAAWc,KAAKwB,QAAQ,SAAUC,GACjCxC,EAAWyC,IAAI,OAAQ,MAAOD,GAAKE,QAAQ,IAAK,WAC/CpC,EAAEqC,MAAMC,aAIVjC,MAIF,SAASA,IACR,GAAIR,EAAW,CACdA,EAAUyC,SACVzC,EAAY,KAGbF,EAAW4C,UAIZ,OAAO3C","file":"public/src/client/topic/move-post.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/topic/move-post', ['components', 'postSelect'], function (components, postSelect) {\r\n\tvar MovePost = {};\r\n\r\n\tvar moveModal;\r\n\tvar moveCommit;\r\n\r\n\tMovePost.init = function () {\r\n\t\t$('.topic').on('click', '[component=\"topic/move-posts\"]', onMovePostsClicked);\r\n\t\t$(window).on('action:ajaxify.start', onAjaxifyStart);\r\n\t};\r\n\r\n\tfunction onAjaxifyStart() {\r\n\t\tcloseMoveModal();\r\n\t\t$(window).off('action:ajaxify.start', onAjaxifyStart);\r\n\t}\r\n\r\n\tfunction onMovePostsClicked() {\r\n\t\tMovePost.openMovePostModal();\r\n\t}\r\n\r\n\tfunction showPostsSelected() {\r\n\t\tif (postSelect.pids.length) {\r\n\t\t\tmoveModal.find('#pids').translateHtml('[[topic:fork_pid_count, ' + postSelect.pids.length + ']]');\r\n\t\t} else {\r\n\t\t\tmoveModal.find('#pids').translateHtml('[[topic:fork_no_pids]]');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction checkMoveButtonEnable() {\r\n\t\tif (moveModal.find('#topicId').val().length && postSelect.pids.length) {\r\n\t\t\tmoveCommit.removeAttr('disabled');\r\n\t\t} else {\r\n\t\t\tmoveCommit.attr('disabled', true);\r\n\t\t}\r\n\t}\r\n\r\n\tMovePost.openMovePostModal = function (postEl) {\r\n\t\tapp.parseAndTranslate('partials/move_post_modal', {}, function (html) {\r\n\t\t\tmoveModal = html;\r\n\r\n\t\t\tmoveCommit = moveModal.find('#move_posts_confirm');\r\n\r\n\t\t\t$(document.body).append(moveModal);\r\n\r\n\t\t\tmoveModal.find('.close,#move_posts_cancel').on('click', closeMoveModal);\r\n\t\t\tmoveModal.find('#topicId').on('keyup', checkMoveButtonEnable);\r\n\t\t\tpostSelect.init(onPostToggled);\r\n\t\t\tshowPostsSelected();\r\n\r\n\t\t\tif (postEl) {\r\n\t\t\t\tpostSelect.togglePostSelection(postEl, onPostToggled);\r\n\t\t\t}\r\n\r\n\t\t\tmoveCommit.on('click', function () {\r\n\t\t\t\tmovePosts();\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\tfunction onPostToggled() {\r\n\t\tcheckMoveButtonEnable();\r\n\t\tshowPostsSelected();\r\n\t}\r\n\r\n\tfunction movePosts() {\r\n\t\tvar tid = moveModal.find('#topicId').val();\r\n\t\tsocket.emit('posts.movePosts', { pids: postSelect.pids, tid: tid }, function (err) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\t\t\tpostSelect.pids.forEach(function (pid) {\r\n\t\t\t\tcomponents.get('post', 'pid', pid).fadeOut(500, function () {\r\n\t\t\t\t\t$(this).remove();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tcloseMoveModal();\r\n\t\t});\r\n\t}\r\n\r\n\tfunction closeMoveModal() {\r\n\t\tif (moveModal) {\r\n\t\t\tmoveModal.remove();\r\n\t\t\tmoveModal = null;\r\n\t\t}\r\n\r\n\t\tpostSelect.disable();\r\n\t}\r\n\r\n\r\n\treturn MovePost;\r\n});\r\n"]}