{"version":3,"sources":["public/src/client/topic/move.js"],"names":["define","categorySelector","Move","modal","selectedCategory","init","tids","currentCid","onComplete","moveAll","socket","emit","onCategoriesLoaded","err","categories","app","alertError","message","parseModal","on","remove","find","addClass","length","translateText","onCategorySelected","onCommitClicked","callback","parseAndTranslate","html","$","category","prop","commitEl","cid","moveTopics","data","window","trigger","alertSuccess","name"],"mappings":"AAAA,aAGAA,OAAO,oBAAqB,oBAAqB,SAAUC,GAC1D,IAAIC,KACJ,IAAIC,EACJ,IAAIC,EAEJF,EAAKG,KAAO,SAAUC,EAAMC,EAAYC,GACvCN,EAAKI,KAAOA,EACZJ,EAAKK,WAAaA,EAClBL,EAAKM,WAAaA,EAClBN,EAAKO,SAAWH,EAEhBI,OAAOC,KAAK,+BAAgCC,IAG7C,SAASA,EAAmBC,EAAKC,GAChC,GAAID,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAG3BC,EAAWJ,EAAY,WACtBX,EAAMgB,GAAG,kBAAmB,WAC3BhB,EAAMiB,WAGPjB,EAAMkB,KAAK,iBAAiBC,SAAS,QAErC,GAAIpB,EAAKO,SAAYP,EAAKI,MAAQJ,EAAKI,KAAKiB,OAAS,EAAI,CACxDpB,EAAMkB,KAAK,oBAAoBG,cAAc,yBAG9CvB,EAAiBI,KAAKF,EAAMkB,KAAK,mCAAoCI,GAErEtB,EAAMkB,KAAK,uBAAuBF,GAAG,QAASO,GAE9CvB,EAAMA,MAAM,UAId,SAASe,EAAWJ,EAAYa,GAC/BZ,IAAIa,kBAAkB,8BAAgCd,WAAYA,GAAc,SAAUe,GACzF1B,EAAQ2B,EAAED,GAEVF,MAIF,SAASF,EAAmBM,GAC3B3B,EAAmB2B,EACnB5B,EAAMkB,KAAK,uBAAuBW,KAAK,WAAY,OAGpD,SAASN,IACR,IAAIO,EAAW9B,EAAMkB,KAAK,uBAE1B,IAAKY,EAASD,KAAK,aAAe5B,GAAoBA,EAAiB8B,IAAK,CAC3ED,EAASD,KAAK,WAAY,MAE1BG,KAIF,SAASA,IACR,IAAIC,GACH9B,KAAMJ,EAAKI,KACX4B,IAAK9B,EAAiB8B,IACtB3B,WAAYL,EAAKK,YAGlBuB,EAAEO,QAAQC,QAAQ,oBAAqBF,GAEvC1B,OAAOC,KAAKT,EAAKO,QAAU,iBAAmB,cAAe2B,EAAM,SAAUvB,GAC5EV,EAAMA,MAAM,QAEZ,GAAIU,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAG3BF,IAAIwB,aAAa,+BAAiCnC,EAAiBoC,KAAO,MAC1E,UAAWtC,EAAKM,aAAe,WAAY,CAC1CN,EAAKM,gBAMR,OAAON","file":"public/src/client/topic/move.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/topic/move', ['categorySelector'], function (categorySelector) {\r\n\tvar Move = {};\r\n\tvar modal;\r\n\tvar selectedCategory;\r\n\r\n\tMove.init = function (tids, currentCid, onComplete) {\r\n\t\tMove.tids = tids;\r\n\t\tMove.currentCid = currentCid;\r\n\t\tMove.onComplete = onComplete;\r\n\t\tMove.moveAll = !tids;\r\n\r\n\t\tsocket.emit('categories.getMoveCategories', onCategoriesLoaded);\r\n\t};\r\n\r\n\tfunction onCategoriesLoaded(err, categories) {\r\n\t\tif (err) {\r\n\t\t\treturn app.alertError(err.message);\r\n\t\t}\r\n\r\n\t\tparseModal(categories, function () {\r\n\t\t\tmodal.on('hidden.bs.modal', function () {\r\n\t\t\t\tmodal.remove();\r\n\t\t\t});\r\n\r\n\t\t\tmodal.find('#move-confirm').addClass('hide');\r\n\r\n\t\t\tif (Move.moveAll || (Move.tids && Move.tids.length > 1)) {\r\n\t\t\t\tmodal.find('.modal-header h3').translateText('[[topic:move_topics]]');\r\n\t\t\t}\r\n\r\n\t\t\tcategorySelector.init(modal.find('[component=\"category-selector\"]'), onCategorySelected);\r\n\r\n\t\t\tmodal.find('#move_thread_commit').on('click', onCommitClicked);\r\n\r\n\t\t\tmodal.modal('show');\r\n\t\t});\r\n\t}\r\n\r\n\tfunction parseModal(categories, callback) {\r\n\t\tapp.parseAndTranslate('partials/move_thread_modal', { categories: categories }, function (html) {\r\n\t\t\tmodal = $(html);\r\n\r\n\t\t\tcallback();\r\n\t\t});\r\n\t}\r\n\r\n\tfunction onCategorySelected(category) {\r\n\t\tselectedCategory = category;\r\n\t\tmodal.find('#move_thread_commit').prop('disabled', false);\r\n\t}\r\n\r\n\tfunction onCommitClicked() {\r\n\t\tvar commitEl = modal.find('#move_thread_commit');\r\n\r\n\t\tif (!commitEl.prop('disabled') && selectedCategory && selectedCategory.cid) {\r\n\t\t\tcommitEl.prop('disabled', true);\r\n\r\n\t\t\tmoveTopics();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction moveTopics() {\r\n\t\tvar data = {\r\n\t\t\ttids: Move.tids,\r\n\t\t\tcid: selectedCategory.cid,\r\n\t\t\tcurrentCid: Move.currentCid,\r\n\t\t};\r\n\r\n\t\t$(window).trigger('action:topic.move', data);\r\n\r\n\t\tsocket.emit(Move.moveAll ? 'topics.moveAll' : 'topics.move', data, function (err) {\r\n\t\t\tmodal.modal('hide');\r\n\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\r\n\t\t\tapp.alertSuccess('[[topic:topic_move_success, ' + selectedCategory.name + ']]');\r\n\t\t\tif (typeof Move.onComplete === 'function') {\r\n\t\t\t\tMove.onComplete();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\r\n\treturn Move;\r\n});\r\n"]}