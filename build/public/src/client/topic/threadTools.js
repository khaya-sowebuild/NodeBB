"use strict";define("forum/topic/threadTools",["forum/topic/fork","forum/topic/move","forum/topic/delete-posts","forum/topic/move-post","components","translator","benchpress"],function(t,e,o,i,n,c,a){var s={};s.init=function(n){l();var c=$(".topic");c.on("click",'[component="topic/delete"]',function(){d("delete",n);return false});c.on("click",'[component="topic/restore"]',function(){d("restore",n);return false});c.on("click",'[component="topic/purge"]',function(){d("purge",n);return false});c.on("click",'[component="topic/lock"]',function(){socket.emit("topics.lock",{tids:[n],cid:ajaxify.data.cid});return false});c.on("click",'[component="topic/unlock"]',function(){socket.emit("topics.unlock",{tids:[n],cid:ajaxify.data.cid});return false});c.on("click",'[component="topic/pin"]',function(){socket.emit("topics.pin",{tids:[n],cid:ajaxify.data.cid});return false});c.on("click",'[component="topic/unpin"]',function(){socket.emit("topics.unpin",{tids:[n],cid:ajaxify.data.cid});return false});c.on("click",'[component="topic/mark-unread"]',function(){socket.emit("topics.markUnread",n,function(t){if(t){return app.alertError(t)}app.alertSuccess("[[topic:mark_unread.success]]")});return false});c.on("click",'[component="topic/mark-unread-for-all"]',function(){var t=$(this);socket.emit("topics.markAsUnreadForAll",[n],function(e){if(e){return app.alertError(e.message)}app.alertSuccess("[[topic:markAsUnreadForAll.success]]");t.parents(".thread-tools.open").find(".dropdown-toggle").trigger("click")});return false});c.on("click",'[component="topic/move"]',function(){e.init([n],ajaxify.data.cid);return false});o.init();t.init();i.init();$(".topic").on("click",'[component="topic/following"]',function(){a("follow")});$(".topic").on("click",'[component="topic/not-following"]',function(){a("unfollow")});$(".topic").on("click",'[component="topic/ignoring"]',function(){a("ignore")});function a(t){socket.emit("topics.changeWatching",{tid:n,type:t},function(e){if(e){return app.alert({type:"danger",alert_id:"topic_follow",title:"[[global:please_log_in]]",message:"[[topic:login_to_subscribe]]",timeout:5e3})}var o="";if(t==="follow"){o="[[topic:following_topic.message]]"}else if(t==="unfollow"){o="[[topic:not_following_topic.message]]"}else if(t==="ignore"){o="[[topic:ignoring_topic.message]]"}p(t);app.alert({alert_id:"follow_thread",message:o,type:"success",timeout:5e3});$(window).trigger("action:topics.changeWatching",{tid:n,type:t})});return false}};function l(){$(".topic").on("show.bs.dropdown",".thread-tools",function(){var t=$(this);var e=t.find(".dropdown-menu");if(e.html()){return}socket.emit("topics.loadTopicTools",{tid:ajaxify.data.tid,cid:ajaxify.data.cid},function(t,o){if(t){return app.alertError(t)}a.parse("partials/topic/topic-menu-list",o,function(t){c.translate(t,function(t){e.html(t);$(window).trigger("action:topic.tools.load")})})})})}function d(t,e){c.translate("[[topic:thread_tools."+t+"_confirm]]",function(o){bootbox.confirm(o,function(o){if(!o){return}socket.emit("topics."+t,{tids:[e],cid:ajaxify.data.cid},function(t){if(t){app.alertError(t.message)}})})})}s.setLockedState=function(t){var e=n.get("topic");if(parseInt(t.tid,10)!==parseInt(e.attr("data-tid"),10)){return}var o=t.isLocked&&!ajaxify.data.privileges.isAdminOrMod;n.get("topic/lock").toggleClass("hidden",t.isLocked);n.get("topic/unlock").toggleClass("hidden",!t.isLocked);var i=(t.isLocked||ajaxify.data.deleted)&&!ajaxify.data.privileges.isAdminOrMod;n.get("topic/reply/container").toggleClass("hidden",i);n.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!t.isLocked||ajaxify.data.deleted);e.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",i);e.find('[component="post/edit"], [component="post/delete"]').toggleClass("hidden",o);e.find('[component="post"][data-uid="'+app.user.uid+'"].deleted [component="post/tools"]').toggleClass("hidden",o);$('[component="post/header"] i.fa-lock').toggleClass("hidden",!t.isLocked);$('[component="post/tools"] .dropdown-menu').html("");ajaxify.data.locked=t.isLocked};s.setDeleteState=function(t){var e=n.get("topic");if(parseInt(t.tid,10)!==parseInt(e.attr("data-tid"),10)){return}n.get("topic/delete").toggleClass("hidden",t.isDelete);n.get("topic/restore").toggleClass("hidden",!t.isDelete);n.get("topic/purge").toggleClass("hidden",!t.isDelete);n.get("topic/deleted/message").toggleClass("hidden",!t.isDelete);var o=t.isDelete&&!ajaxify.data.privileges.isAdminOrMod;n.get("topic/reply/container").toggleClass("hidden",o);n.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!ajaxify.data.locked||t.isDelete);e.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",o);e.toggleClass("deleted",t.isDelete);ajaxify.data.deleted=t.isDelete};s.setPinnedState=function(t){var e=n.get("topic");if(parseInt(t.tid,10)!==parseInt(e.attr("data-tid"),10)){return}n.get("topic/pin").toggleClass("hidden",t.isPinned);n.get("topic/unpin").toggleClass("hidden",!t.isPinned);$('[component="post/header"] i.fa-thumb-tack').toggleClass("hidden",!t.isPinned);ajaxify.data.pinned=t.isPinned};function p(t){var e=n.get("topic/following/menu");e.toggleClass("hidden",t!=="follow");n.get("topic/following/check").toggleClass("fa-check",t==="follow");e=n.get("topic/not-following/menu");e.toggleClass("hidden",t!=="unfollow");n.get("topic/not-following/check").toggleClass("fa-check",t==="unfollow");e=n.get("topic/ignoring/menu");e.toggleClass("hidden",t!=="ignore");n.get("topic/ignoring/check").toggleClass("fa-check",t==="ignore")}return s});
//# sourceMappingURL=public/src/client/topic/threadTools.js.map