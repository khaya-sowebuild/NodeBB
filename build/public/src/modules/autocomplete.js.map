{"version":3,"sources":["public/src/modules/autocomplete.js"],"names":["define","module","user","input","onselect","app","loadJQueryUI","autocomplete","delay","open","$","this","css","select","event","ui","handleOnSelect","source","request","response","socket","emit","query","term","paginate","err","result","alertError","message","users","names","map","username","html","text","label","value","uid","name","slug","userslug","picture","icon:text","icon:bgColor","attr","group","results","length","tag","cid","ajaxify","data","tags","e","jQuery","Event","which","keyCode","setTimeout","trigger"],"mappings":"AACA,aAGAA,OAAO,eAAgB,WACtB,IAAIC,KAEJA,EAAOC,KAAO,SAAUC,EAAOC,GAC9BC,IAAIC,aAAa,WAChBH,EAAMI,cACLC,MAAO,IACPC,KAAM,WACLC,EAAEC,MAAMJ,aAAa,UAAUK,IAAI,UAAW,SAE/CC,OAAQ,SAAUC,EAAOC,GACxBC,EAAeb,EAAOC,EAAUU,EAAOC,IAExCE,OAAQ,SAAUC,EAASC,GAC1BC,OAAOC,KAAK,eACXC,MAAOJ,EAAQK,KACfC,SAAU,OACR,SAAUC,EAAKC,GACjB,GAAID,EAAK,CACR,OAAOpB,IAAIsB,WAAWF,EAAIG,SAG3B,GAAIF,GAAUA,EAAOG,MAAO,CAC3B,IAAIC,EAAQJ,EAAOG,MAAME,IAAI,SAAU7B,GACtC,IAAI8B,EAAWtB,EAAE,UAAUuB,KAAK/B,EAAK8B,UAAUE,OAC/C,OAAOhC,IACNiC,MAAOH,EACPI,MAAOJ,EACP9B,MACCmC,IAAKnC,EAAKmC,IACVC,KAAMpC,EAAK8B,SACXO,KAAMrC,EAAKsC,SACXR,SAAU9B,EAAK8B,SACfQ,SAAUtC,EAAKsC,SACfC,QAASvC,EAAKuC,QACdC,YAAaxC,EAAK,aAClByC,eAAgBzC,EAAK,oBAIxBiB,EAASW,GAEVpB,EAAE,sBAAsBkC,KAAK,eAAgB,iBAOlD3C,EAAO4C,MAAQ,SAAU1C,EAAOC,GAC/BC,IAAIC,aAAa,WAChBH,EAAMI,cACLC,MAAO,IACPK,OAAQT,EACRa,OAAQ,SAAUC,EAASC,GAC1BC,OAAOC,KAAK,iBACXC,MAAOJ,EAAQK,MACb,SAAUE,EAAKqB,GACjB,GAAIrB,EAAK,CACR,OAAOpB,IAAIsB,WAAWF,EAAIG,SAG3B,GAAIkB,GAAWA,EAAQC,OAAQ,CAC9B,IAAIjB,EAAQgB,EAAQf,IAAI,SAAUc,GACjC,OAAOA,IACNV,MAAOU,EAAMP,KACbF,MAAOS,EAAMP,KACbO,OACCP,KAAMO,EAAMP,KACZC,KAAMM,EAAMN,SAIfpB,EAASW,GAEVpB,EAAE,sBAAsBkC,KAAK,eAAgB,iBAOlD3C,EAAO+C,IAAM,SAAU7C,EAAOC,GAC7BC,IAAIC,aAAa,WAChBH,EAAMI,cACLC,MAAO,IACPC,KAAM,WACLC,EAAEC,MAAMJ,aAAa,UAAUK,IAAI,UAAW,MAE/CC,OAAQ,SAAUC,EAAOC,GACxBC,EAAeb,EAAOC,EAAUU,EAAOC,IAExCE,OAAQ,SAAUC,EAASC,GAC1BC,OAAOC,KAAK,2BACXC,MAAOJ,EAAQK,KACf0B,IAAKC,QAAQC,KAAKF,KAAO,GACvB,SAAUxB,EAAK2B,GACjB,GAAI3B,EAAK,CACR,OAAOpB,IAAIsB,WAAWF,EAAIG,SAE3B,GAAIwB,EAAM,CACTjC,EAASiC,GAEV1C,EAAE,sBAAsBkC,KAAK,eAAgB,iBAOlD,SAAS5B,EAAeb,EAAOC,EAAUU,EAAOC,GAC/CX,EAAWA,GAAY,aACvB,IAAIiD,EAAIC,OAAOC,MAAM,YACrBF,EAAEG,MAAQ,GACVH,EAAEI,QAAU,GACZC,WAAW,WACVvD,EAAMwD,QAAQN,IACZ,KACHjD,EAASU,EAAOC,GAGjB,OAAOd","file":"public/src/modules/autocomplete.js","sourcesContent":["\r\n'use strict';\r\n\r\n\r\ndefine('autocomplete', function () {\r\n\tvar module = {};\r\n\r\n\tmodule.user = function (input, onselect) {\r\n\t\tapp.loadJQueryUI(function () {\r\n\t\t\tinput.autocomplete({\r\n\t\t\t\tdelay: 200,\r\n\t\t\t\topen: function () {\r\n\t\t\t\t\t$(this).autocomplete('widget').css('z-index', 100005);\r\n\t\t\t\t},\r\n\t\t\t\tselect: function (event, ui) {\r\n\t\t\t\t\thandleOnSelect(input, onselect, event, ui);\r\n\t\t\t\t},\r\n\t\t\t\tsource: function (request, response) {\r\n\t\t\t\t\tsocket.emit('user.search', {\r\n\t\t\t\t\t\tquery: request.term,\r\n\t\t\t\t\t\tpaginate: false,\r\n\t\t\t\t\t}, function (err, result) {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (result && result.users) {\r\n\t\t\t\t\t\t\tvar names = result.users.map(function (user) {\r\n\t\t\t\t\t\t\t\tvar username = $('<div/>').html(user.username).text();\r\n\t\t\t\t\t\t\t\treturn user && {\r\n\t\t\t\t\t\t\t\t\tlabel: username,\r\n\t\t\t\t\t\t\t\t\tvalue: username,\r\n\t\t\t\t\t\t\t\t\tuser: {\r\n\t\t\t\t\t\t\t\t\t\tuid: user.uid,\r\n\t\t\t\t\t\t\t\t\t\tname: user.username,\r\n\t\t\t\t\t\t\t\t\t\tslug: user.userslug,\r\n\t\t\t\t\t\t\t\t\t\tusername: user.username,\r\n\t\t\t\t\t\t\t\t\t\tuserslug: user.userslug,\r\n\t\t\t\t\t\t\t\t\t\tpicture: user.picture,\r\n\t\t\t\t\t\t\t\t\t\t'icon:text': user['icon:text'],\r\n\t\t\t\t\t\t\t\t\t\t'icon:bgColor': user['icon:bgColor'],\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tresponse(names);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$('.ui-autocomplete a').attr('data-ajaxify', 'false');\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\tmodule.group = function (input, onselect) {\r\n\t\tapp.loadJQueryUI(function () {\r\n\t\t\tinput.autocomplete({\r\n\t\t\t\tdelay: 200,\r\n\t\t\t\tselect: onselect,\r\n\t\t\t\tsource: function (request, response) {\r\n\t\t\t\t\tsocket.emit('groups.search', {\r\n\t\t\t\t\t\tquery: request.term,\r\n\t\t\t\t\t}, function (err, results) {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (results && results.length) {\r\n\t\t\t\t\t\t\tvar names = results.map(function (group) {\r\n\t\t\t\t\t\t\t\treturn group && {\r\n\t\t\t\t\t\t\t\t\tlabel: group.name,\r\n\t\t\t\t\t\t\t\t\tvalue: group.name,\r\n\t\t\t\t\t\t\t\t\tgroup: {\r\n\t\t\t\t\t\t\t\t\t\tname: group.name,\r\n\t\t\t\t\t\t\t\t\t\tslug: group.slug,\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tresponse(names);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$('.ui-autocomplete a').attr('data-ajaxify', 'false');\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\tmodule.tag = function (input, onselect) {\r\n\t\tapp.loadJQueryUI(function () {\r\n\t\t\tinput.autocomplete({\r\n\t\t\t\tdelay: 100,\r\n\t\t\t\topen: function () {\r\n\t\t\t\t\t$(this).autocomplete('widget').css('z-index', 20000);\r\n\t\t\t\t},\r\n\t\t\t\tselect: function (event, ui) {\r\n\t\t\t\t\thandleOnSelect(input, onselect, event, ui);\r\n\t\t\t\t},\r\n\t\t\t\tsource: function (request, response) {\r\n\t\t\t\t\tsocket.emit('topics.autocompleteTags', {\r\n\t\t\t\t\t\tquery: request.term,\r\n\t\t\t\t\t\tcid: ajaxify.data.cid || 0,\r\n\t\t\t\t\t}, function (err, tags) {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (tags) {\r\n\t\t\t\t\t\t\tresponse(tags);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$('.ui-autocomplete a').attr('data-ajaxify', 'false');\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\tfunction handleOnSelect(input, onselect, event, ui) {\r\n\t\tonselect = onselect || function () {};\r\n\t\tvar e = jQuery.Event('keypress');\r\n\t\te.which = 13;\r\n\t\te.keyCode = 13;\r\n\t\tsetTimeout(function () {\r\n\t\t\tinput.trigger(e);\r\n\t\t}, 100);\r\n\t\tonselect(event, ui);\r\n\t}\r\n\r\n\treturn module;\r\n});\r\n"]}