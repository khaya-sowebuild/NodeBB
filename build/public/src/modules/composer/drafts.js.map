{"version":3,"sources":["node_modules/nodebb-plugin-composer-default/static/lib/composer/drafts.js"],"names":["define","drafts","saveThrottleId","saving","init","postContainer","postData","bodyEl","find","on","resetTimeout","setTimeout","saveDraft","clearTimeout","getDraft","save_id","localStorage","getItem","raw","canSave","length","val","setItem","removeDraft","updateVisibility","removeItem","set","add","open","JSON","parse","e","console","warn","idx","indexOf","push","splice","stringify"],"mappings":"AAAA,aAIAA,OAAO,kBAAmB,WAEzB,IAAIC,KACJ,IAAIC,EACJ,IAAIC,EAAS,MAEbF,EAAOG,KAAO,SAASC,EAAeC,GACrC,IAAIC,EAASF,EAAcG,KAAK,YAChCD,EAAOE,GAAG,QAAS,WAClBC,IAEAR,EAAiBS,WAAW,WAC3BC,EAAUP,EAAeC,IACvB,QAIL,SAASI,IACR,GAAIR,EAAgB,CACnBW,aAAaX,GACbA,EAAiB,GAInBD,EAAOa,SAAW,SAASC,GAC1B,OAAOC,aAAaC,QAAQF,IAG7B,SAASH,EAAUP,EAAeC,GACjC,IAAIY,EAEJ,GAAIC,KAAab,GAAYA,EAASS,SAAWV,EAAce,OAAQ,CACtEF,EAAMb,EAAcG,KAAK,YAAYa,MACrC,GAAIH,EAAIE,OAAQ,CACfJ,aAAaM,QAAQhB,EAASS,QAASG,OACjC,CACNjB,EAAOsB,YAAYjB,EAASS,WAK/Bd,EAAOsB,YAAc,SAASR,GAC7B,IAAKA,EAAS,CACb,OAEDL,IAEAT,EAAOuB,iBAAiB,YAAaT,GACrCd,EAAOuB,iBAAiB,OAAQT,GAEhC,OAAOC,aAAaS,WAAWV,IAGhCd,EAAOuB,iBAAoB,SAAUE,EAAKX,EAASY,GAClD,IAAKR,MAAcJ,EAAS,CAC3B,OAGD,IACC,IAAIa,EAAOZ,aAAaC,QAAQ,UAAYS,GAC5CE,EAAOA,EAAOC,KAAKC,MAAMF,MACxB,MAAOG,GACRC,QAAQC,KAAK,wDACb,IAAIL,KAEL,IAAIM,EAAMN,EAAKO,QAAQpB,GAEvB,GAAIY,GAAOO,KAAS,EAAG,CACtBN,EAAKQ,KAAKrB,QACJ,IAAKY,GAAOO,KAAS,EAAG,CAC9BN,EAAKS,OAAOH,EAAK,GAGlBlB,aAAaM,QAAQ,UAAYI,EAAKG,KAAKS,UAAUV,KAGtD,SAAST,IACR,GAAIhB,EAAQ,CACX,OAAOA,EAGR,IACCa,aAAaM,QAAQ,OAAQ,QAC7BN,aAAaS,WAAW,QACxBtB,EAAS,KACT,OAAO,KACN,MAAM4B,GACP5B,EAAS,MACT,OAAO,OAIT,OAAOF","file":"node_modules/nodebb-plugin-composer-default/static/lib/composer/drafts.js","sourcesContent":["'use strict';\r\n\r\n/* globals define */\r\n\r\ndefine('composer/drafts', function() {\r\n\r\n\tvar drafts = {};\r\n\tvar\tsaveThrottleId;\r\n\tvar saving = false;\r\n\r\n\tdrafts.init = function(postContainer, postData) {\r\n\t\tvar bodyEl = postContainer.find('textarea');\r\n\t\tbodyEl.on('keyup', function() {\r\n\t\t\tresetTimeout();\r\n\r\n\t\t\tsaveThrottleId = setTimeout(function() {\r\n\t\t\t\tsaveDraft(postContainer, postData);\r\n\t\t\t}, 1000);\r\n\t\t});\r\n\t};\r\n\r\n\tfunction resetTimeout() {\r\n\t\tif (saveThrottleId) {\r\n\t\t\tclearTimeout(saveThrottleId);\r\n\t\t\tsaveThrottleId = 0;\r\n\t\t}\r\n\t}\r\n\r\n\tdrafts.getDraft = function(save_id) {\r\n\t\treturn localStorage.getItem(save_id);\r\n\t};\r\n\r\n\tfunction saveDraft(postContainer, postData) {\r\n\t\tvar raw;\r\n\r\n\t\tif (canSave() && postData && postData.save_id && postContainer.length) {\r\n\t\t\traw = postContainer.find('textarea').val();\r\n\t\t\tif (raw.length) {\r\n\t\t\t\tlocalStorage.setItem(postData.save_id, raw);\r\n\t\t\t} else {\r\n\t\t\t\tdrafts.removeDraft(postData.save_id);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tdrafts.removeDraft = function(save_id) {\r\n\t\tif (!save_id) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tresetTimeout();\r\n\t\t// Remove save_id from list of open and available drafts\r\n\t\tdrafts.updateVisibility('available', save_id);\r\n\t\tdrafts.updateVisibility('open', save_id);\r\n\r\n\t\treturn localStorage.removeItem(save_id);\r\n\t};\r\n\r\n\tdrafts.updateVisibility =  function (set, save_id, add) {\r\n\t\tif (!canSave() || !save_id) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tvar open = localStorage.getItem('drafts:' + set);\r\n\t\t\topen = open ? JSON.parse(open) : [];\r\n\t\t} catch (e) {\r\n\t\t\tconsole.warn('[composer/drafts] Could not read list of open drafts');\r\n\t\t\tvar open = [];\r\n\t\t}\r\n\t\tvar idx = open.indexOf(save_id);\r\n\r\n\t\tif (add && idx === -1) {\r\n\t\t\topen.push(save_id);\r\n\t\t} else if (!add && idx !== -1) {\r\n\t\t\topen.splice(idx, 1);\r\n\t\t}\t// otherwise do nothing\r\n\r\n\t\tlocalStorage.setItem('drafts:' + set, JSON.stringify(open));\r\n\t};\r\n\r\n\tfunction canSave() {\r\n\t\tif (saving) {\r\n\t\t\treturn saving;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tlocalStorage.setItem('test', 'test');\r\n\t\t\tlocalStorage.removeItem('test');\r\n\t\t\tsaving = true;\r\n\t\t\treturn true;\r\n\t\t} catch(e) {\r\n\t\t\tsaving = false;\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\treturn drafts;\r\n});"]}