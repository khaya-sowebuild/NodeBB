define("emoji-dialog",["require","exports","translator","benchpress","composer/controls","scrollStop","emoji"],function(e,t,n,o,i,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var s=$("html");t.dialogActions={open:function(e){s.addClass("emoji-insert");e.addClass("open");e.find(".emoji-dialog-search").focus();return e},close:function(e){s.removeClass("emoji-insert");return e.removeClass("open")}};var l={people:10,nature:9,food:8,activity:7,travel:6,objects:5,symbols:4,flags:3,regional:2,modifier:1,other:0};var c=n.Translator.create();function u(e){Promise.all([$.getJSON(r.base+"/emoji/categories.json?"+r.buster),$.getJSON(r.base+"/emoji/packs.json?"+r.buster),new Promise(function(e){return r.init(e)})]).then(function(e){var t=e[0],n=e[1];var i=Object.keys(t).map(function(e){var n=t[e].map(function(e){return r.table[e]});return{name:e,emojis:n.map(function(e){return{name:e.name,html:r.buildEmoji(e,true)}})}}).sort(function(e,t){var n=l[e.name]||0;var o=l[t.name]||0;return o-n});return o.render("partials/emoji-dialog",{categories:i,packs:n})}).then(function(e){return c.translate(e)}).then(function(n){var o=$(n).appendTo("body");o.find(".emoji-dialog-search").on("input",function(e){var t=e.target.value;if(!t){o.find(".emoji-dialog-search-results").addClass("hidden");o.find(".nav-tabs .emoji-dialog-search-results").next().find("a").tab("show");return}var n=r.search(t).slice(0,100).map(function(e){return'<a class="emoji-link" name="'+e.name+'" href="#">'+r.buildEmoji(e,false)+"</a>"}).join("\n");o.find(".tab-pane.emoji-dialog-search-results").html(n);o.find(".emoji-dialog-search-results").removeClass("hidden");o.find(".nav-tabs .emoji-dialog-search-results a").tab("show")});var i=o.find(".emoji-tabs .tab-content");function s(e){var t=i[0].getBoundingClientRect();var n=Math.ceil(t.width*t.height/(40*40));e.find(".emoji-link img.defer").filter(function(e,o){if(e<=n){return true}var i=o.getBoundingClientRect();return i.right>t.left&&i.left<t.right&&i.bottom>t.top&&i.top<t.bottom}).removeClass("defer").each(function(e,t){var n=t.getAttribute("data-src");t.setAttribute("src",n)})}var l=o.find(".emoji-tabs .nav-tabs a").click(function(e){e.preventDefault();$(e.target).tab("show")}).on("show.bs.tab",function(e){s($(e.target.getAttribute("href")))}).eq(1);setTimeout(function(){return l.trigger("show.bs.tab")},10);i.on("scroll",function(e){s(i.find(".tab-pane.active"))});a.apply(i[0]);var c=function(){return t.dialogActions.close(o)};$(window).on("action:composer.discard action:composer.submit",c);o.find(".close").click(c);if(o.draggable){o.draggable({handle:".top-bar"})}e(o)}).catch(function(e){console.error("Failed to initialize emoji dialog",e)})}t.init=u;function f(e,n){function o(o){if(o.hasClass("open")){t.dialogActions.close(o);return}o.off("click").on("click",".emoji-link",function(e){e.preventDefault();var t=e.currentTarget.name;n(e,t,o)});var i=e.getBoundingClientRect();var a={bottom:"auto",top:"auto",right:"auto",left:"auto"};if(i.top>440){a.top=i.top-400+"px"}else{a.top=i.top+40+"px"}if(i.left<window.innerWidth/2){a.left=i.left+40+"px"}else{a.left=i.left-400+"px"}o.css(a);t.dialogActions.open(o)}var i=$("#emoji-dialog");if(i.length){o(i)}else{u(o)}}t.toggle=f;function d(e){f($('[data-format="emoji-add-emoji"]').filter(":visible")[0],function(t,n){var o=":"+n+": ";var a=e.selectionStart,r=e.selectionEnd;var s=r+o.length;var l=a===r?s:a;i.insertIntoTextarea(e,o);i.updateTextareaSelection(e,l,s);$(e).trigger("input")})}t.toggleForInsert=d});
//# sourceMappingURL=node_modules/nodebb-plugin-emoji/build/public/lib/emoji-dialog.js.map