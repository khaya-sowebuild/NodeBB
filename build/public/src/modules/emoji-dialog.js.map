{"version":3,"sources":["node_modules/nodebb-plugin-emoji/build/public/lib/emoji-dialog.js"],"names":["define","require","exports","translator_1","benchpress_1","controls_1","scrollStop_1","emoji_1","Object","defineProperty","value","$html","$","dialogActions","open","dialog","addClass","find","focus","close","removeClass","priorities","people","nature","food","activity","travel","objects","symbols","flags","regional","modifier","other","translator","Translator","create","init","callback","Promise","all","getJSON","base","buster","resolve","then","_a","categoriesInfo","packs","categories","keys","map","category","emojis","name","table","emoji","html","buildEmoji","sort","a","b","aPriority","bPriority","render","result","translate","appendTo","on","e","target","next","tab","search","slice","join","tabContent","showDeferred","container","rect","getBoundingClientRect","num","Math","ceil","width","height","filter","i","elem","elemRect","right","left","bottom","top","each","src","getAttribute","setAttribute","firstTab","click","preventDefault","eq","setTimeout","trigger","apply","window","draggable","handle","catch","err","console","error","toggle","opener","onClick","after","hasClass","off","currentTarget","buttonRect","position","innerWidth","css","length","toggleForInsert","textarea","text","selectionStart","selectionEnd","end","start","insertIntoTextarea","updateTextareaSelection"],"mappings":"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","file":"node_modules/nodebb-plugin-emoji/build/public/lib/emoji-dialog.js","sourcesContent":["/// <amd-module name=\"emoji-dialog\"/>\r\ndefine(\"emoji-dialog\", [\"require\", \"exports\", \"translator\", \"benchpress\", \"composer/controls\", \"scrollStop\", \"emoji\"], function (require, exports, translator_1, benchpress_1, controls_1, scrollStop_1, emoji_1) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    var $html = $('html');\r\n    exports.dialogActions = {\r\n        open: function (dialog) {\r\n            $html.addClass('emoji-insert');\r\n            dialog.addClass('open');\r\n            dialog.find('.emoji-dialog-search').focus();\r\n            return dialog;\r\n        },\r\n        close: function (dialog) {\r\n            $html.removeClass('emoji-insert');\r\n            return dialog.removeClass('open');\r\n        },\r\n    };\r\n    var priorities = {\r\n        people: 10,\r\n        nature: 9,\r\n        food: 8,\r\n        activity: 7,\r\n        travel: 6,\r\n        objects: 5,\r\n        symbols: 4,\r\n        flags: 3,\r\n        regional: 2,\r\n        modifier: 1,\r\n        other: 0,\r\n    };\r\n    var translator = translator_1.Translator.create();\r\n    // create modal\r\n    function init(callback) {\r\n        Promise.all([\r\n            $.getJSON(emoji_1.base + \"/emoji/categories.json?\" + emoji_1.buster),\r\n            $.getJSON(emoji_1.base + \"/emoji/packs.json?\" + emoji_1.buster),\r\n            new Promise(function (resolve) { return emoji_1.init(resolve); }),\r\n        ]).then(function (_a) {\r\n            var categoriesInfo = _a[0], packs = _a[1];\r\n            var categories = Object.keys(categoriesInfo).map(function (category) {\r\n                var emojis = categoriesInfo[category].map(function (name) { return emoji_1.table[name]; });\r\n                return {\r\n                    name: category,\r\n                    emojis: emojis.map(function (emoji) { return ({\r\n                        name: emoji.name,\r\n                        html: emoji_1.buildEmoji(emoji, true),\r\n                    }); }),\r\n                };\r\n            }).sort(function (a, b) {\r\n                var aPriority = priorities[a.name] || 0;\r\n                var bPriority = priorities[b.name] || 0;\r\n                return bPriority - aPriority;\r\n            });\r\n            return benchpress_1.render('partials/emoji-dialog', {\r\n                categories: categories,\r\n                packs: packs,\r\n            });\r\n        }).then(function (result) { return translator.translate(result); }).then(function (html) {\r\n            var dialog = $(html).appendTo('body');\r\n            dialog.find('.emoji-dialog-search').on('input', function (e) {\r\n                var value = e.target.value;\r\n                if (!value) {\r\n                    dialog.find('.emoji-dialog-search-results').addClass('hidden');\r\n                    dialog.find('.nav-tabs .emoji-dialog-search-results').next().find('a').tab('show');\r\n                    return;\r\n                }\r\n                var html = emoji_1.search(value)\r\n                    .slice(0, 100)\r\n                    .map(function (emoji) {\r\n                    return \"<a class=\\\"emoji-link\\\" name=\\\"\" + emoji.name + \"\\\" href=\\\"#\\\">\" + emoji_1.buildEmoji(emoji, false) + \"</a>\";\r\n                })\r\n                    .join('\\n');\r\n                dialog.find('.tab-pane.emoji-dialog-search-results').html(html);\r\n                dialog.find('.emoji-dialog-search-results').removeClass('hidden');\r\n                dialog.find('.nav-tabs .emoji-dialog-search-results a').tab('show');\r\n            });\r\n            var tabContent = dialog.find('.emoji-tabs .tab-content');\r\n            function showDeferred(container) {\r\n                var rect = tabContent[0].getBoundingClientRect();\r\n                var num = Math.ceil((rect.width * rect.height) / (40 * 40));\r\n                container\r\n                    .find('.emoji-link img.defer')\r\n                    .filter(function (i, elem) {\r\n                    if (i <= num) {\r\n                        return true;\r\n                    }\r\n                    var elemRect = elem.getBoundingClientRect();\r\n                    return elemRect.right > rect.left &&\r\n                        elemRect.left < rect.right &&\r\n                        elemRect.bottom > rect.top &&\r\n                        elemRect.top < rect.bottom;\r\n                })\r\n                    .removeClass('defer')\r\n                    .each(function (i, elem) {\r\n                    var src = elem.getAttribute('data-src');\r\n                    elem.setAttribute('src', src);\r\n                });\r\n            }\r\n            var firstTab = dialog.find('.emoji-tabs .nav-tabs a').click(function (e) {\r\n                e.preventDefault();\r\n                $(e.target).tab('show');\r\n            }).on('show.bs.tab', function (e) {\r\n                showDeferred($(e.target.getAttribute('href')));\r\n            }).eq(1);\r\n            setTimeout(function () { return firstTab.trigger('show.bs.tab'); }, 10);\r\n            tabContent.on('scroll', function (e) {\r\n                showDeferred(tabContent.find('.tab-pane.active'));\r\n            });\r\n            scrollStop_1.apply(tabContent[0]);\r\n            var close = function () { return exports.dialogActions.close(dialog); };\r\n            $(window).on('action:composer.discard action:composer.submit', close);\r\n            dialog.find('.close').click(close);\r\n            if (dialog.draggable) {\r\n                dialog.draggable({\r\n                    handle: '.top-bar',\r\n                });\r\n            }\r\n            callback(dialog);\r\n        }).catch(function (err) {\r\n            console.error('Failed to initialize emoji dialog', err);\r\n        });\r\n    }\r\n    exports.init = init;\r\n    function toggle(opener, onClick) {\r\n        function after(dialog) {\r\n            if (dialog.hasClass('open')) {\r\n                exports.dialogActions.close(dialog);\r\n                return;\r\n            }\r\n            dialog.off('click').on('click', '.emoji-link', function (e) {\r\n                e.preventDefault();\r\n                var name = e.currentTarget.name;\r\n                onClick(e, name, dialog);\r\n            });\r\n            var buttonRect = opener.getBoundingClientRect();\r\n            var position = {\r\n                bottom: 'auto',\r\n                top: 'auto',\r\n                right: 'auto',\r\n                left: 'auto',\r\n            };\r\n            if (buttonRect.top > 440) {\r\n                position.top = buttonRect.top - 400 + \"px\";\r\n            }\r\n            else {\r\n                position.top = buttonRect.top + 40 + \"px\";\r\n            }\r\n            if (buttonRect.left < window.innerWidth / 2) {\r\n                position.left = buttonRect.left + 40 + \"px\";\r\n            }\r\n            else {\r\n                position.left = buttonRect.left - 400 + \"px\";\r\n            }\r\n            dialog.css(position);\r\n            exports.dialogActions.open(dialog);\r\n        }\r\n        var dialog = $('#emoji-dialog');\r\n        if (dialog.length) {\r\n            after(dialog);\r\n        }\r\n        else {\r\n            init(after);\r\n        }\r\n    }\r\n    exports.toggle = toggle;\r\n    function toggleForInsert(textarea) {\r\n        toggle($('[data-format=\"emoji-add-emoji\"]').filter(':visible')[0], function (e, name) {\r\n            var text = \":\" + name + \": \";\r\n            var selectionStart = textarea.selectionStart, selectionEnd = textarea.selectionEnd;\r\n            var end = selectionEnd + text.length;\r\n            var start = selectionStart === selectionEnd ? end : selectionStart;\r\n            controls_1.insertIntoTextarea(textarea, text);\r\n            controls_1.updateTextareaSelection(textarea, start, end);\r\n            $(textarea).trigger('input');\r\n        });\r\n    }\r\n    exports.toggleForInsert = toggleForInsert;\r\n});\r\n//# sourceMappingURL=emoji-dialog.js.map"]}