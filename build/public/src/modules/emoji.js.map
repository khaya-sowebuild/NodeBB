{"version":3,"sources":["node_modules/nodebb-plugin-emoji/build/public/lib/emoji.js"],"names":["define","require","exports","Object","defineProperty","value","base","window","config","relative_path","buster","buildEmoji","emoji","defer","whole","name","deferClass","image","pack","character","strategy","match","search","term","callback","toLowerCase","replace","slice","index","template","cache","initialized","init","setTimeout","Promise","all","resolve_1","reject_1","resolve_2","reject_2","resolve_3","reject_3","$","getJSON","then","_a","fuzzy","leven","formatting","tableData","table","keys","map","aliases","keywords","fuzzyFind","arr","l","length","i","fuzzySearch","score","weight","weighted","startsWith","filter","obj","aliasMatch","keywordMatch","sort","a","b","aPrefixed","bPrefixed","addButtonDispatch","textarea","resolve_4","reject_4","toggleForInsert","catch","err","e","Error","console","error","app","alertError"],"mappings":"AACAA,OAAO,SAAU,UAAW,WAAY,SAAUC,EAASC,GACvD,aACAC,OAAOC,eAAeF,EAAS,cAAgBG,MAAO,OACtD,IAAIC,EAAOC,OAAOC,OAAOC,cAAgB,+BACzCP,EAAQI,KAAOA,EACf,IAAII,EAASH,OAAOC,OAAO,gBAC3BN,EAAQQ,OAASA,EACjB,SAASC,EAAWC,EAAOC,GACvB,IAAIC,EAAQ,IAAMF,EAAMG,KAAO,IAC/B,IAAIC,EAAaH,EAAQ,SAAW,GACpC,GAAID,EAAMK,MAAO,CACb,MAAO,gBAAkBJ,EAAQ,QAAU,IAAM,QAAWP,EAAO,UAAYM,EAAMM,KAAO,IAAMN,EAAMK,MAAQ,IAAMP,EAAS,8CAAkDE,EAAMM,KAAO,WAAaN,EAAMG,KAAO,IAAMC,EAAa,mBAAuBF,EAAQ,iBAAqBF,EAAMO,UAAY,YAErT,MAAO,2BAA8BP,EAAMM,KAAO,WAAaN,EAAMG,KAAO,iBAAqBD,EAAQ,eAAkBF,EAAMO,UAAY,iBAEjJjB,EAAQS,WAAaA,EACrBT,EAAQkB,UACJC,MAAO,kBACPC,OAAQ,SAAUC,EAAMC,GACpBA,EAAStB,EAAQoB,OAAOC,EAAKE,cAAcC,QAAQ,QAAS,KAAKC,MAAM,EAAG,MAE9EC,MAAO,EACPF,QAAS,SAAUd,GACf,MAAO,IAAMA,EAAMG,KAAO,MAE9Bc,SAAU,SAAUjB,GAChB,OAAOD,EAAWC,GAAS,IAAMA,EAAMG,MAE3Ce,MAAO,MAEX,IAAIC,EAAc,MAClB,SAASC,EAAKR,GACV,GAAIO,EAAa,CACb,GAAIP,EAAU,CACVS,WAAWT,EAAU,GAEzB,OAEJO,EAAc,KACdG,QAAQC,KACJ,IAAID,QAAQ,SAAUE,EAAWC,GAAYpC,GAAS,eAAgBmC,EAAWC,KACjF,IAAIH,QAAQ,SAAUI,EAAWC,GAAYtC,GAAS,SAAUqC,EAAWC,KAC3E,IAAIL,QAAQ,SAAUM,EAAWC,GAAYxC,GAAS,uBAAwBuC,EAAWC,KACzFC,EAAEC,QAAQrC,EAAO,qBAAuBI,KACzCkC,KAAK,SAAUC,GACd,IAAIC,EAAQD,EAAG,GAAIE,EAAQF,EAAG,GAAIG,EAAaH,EAAG,GAAII,EAAYJ,EAAG,GACrE3C,EAAQgD,MAAQD,EAChB,IAAId,EAAMhC,OAAOgD,KAAKjD,EAAQgD,OAAOE,IAAI,SAAUrC,GAC/C,IAAIH,EAAQV,EAAQgD,MAAMnC,GAC1B,OACIA,KAAMA,EACNsC,QAASzC,EAAMyC,QACfC,SAAU1C,EAAM0C,SAChBnC,UAAWP,EAAMO,UACjBF,MAAOL,EAAMK,MACbC,KAAMN,EAAMM,QAGpB,SAASqC,EAAUhC,EAAMiC,GACrB,IAAIC,EAAID,EAAIE,OACZ,IAAK,IAAIC,EAAI,EAAGA,EAAIF,EAAGE,GAAK,EAAG,CAC3B,GAAIb,EAAMvB,EAAMiC,EAAIG,IAAK,CACrB,OAAOH,EAAIG,IAGnB,OAAO,KAEX,SAASC,EAAYrC,GACjB,SAASsC,EAAMxC,EAAOyC,GAClB,IAAIC,EAAWD,GAAU,EAAIf,EAAMxB,EAAMF,IACzC,OAAOA,EAAM2C,WAAWzC,GAAQwC,EAAW,EAAIA,EAEnD,OAAO5B,EAAI8B,OAAO,SAAUC,GACxB,GAAIpB,EAAMvB,EAAM2C,EAAInD,MAAO,CACvBmD,EAAIL,MAAQA,EAAMK,EAAInD,KAAM,GAC5B,OAAO,KAEX,IAAIoD,EAAaZ,EAAUhC,EAAM2C,EAAIb,SACrC,GAAIc,EAAY,CACZD,EAAIL,MAAQA,EAAMM,EAAY,GAC9B,OAAO,KAEX,IAAIC,EAAeb,EAAUhC,EAAM2C,EAAIZ,UACvC,GAAIc,EAAc,CACdF,EAAIL,MAAQA,EAAMO,EAAc,GAChC,OAAO,KAEX,OAAO,QACRC,KAAK,SAAUC,EAAGC,GAAK,OAAOD,EAAET,MAAQU,EAAEV,QAAUQ,KAAK,SAAUC,EAAGC,GACrE,IAAIC,GAAaF,EAAEvD,KAAKiD,WAAWzC,GACnC,IAAIkD,GAAaF,EAAExD,KAAKiD,WAAWzC,GACnC,OAAOkD,EAAYD,IAG3BtE,EAAQoB,OAASsC,EACjBZ,EAAW0B,kBAAkB,kBAAmB,SAAUC,GACtD,IAAIzC,QAAQ,SAAU0C,EAAWC,GAAY5E,GAAS,gBAAiB2E,EAAWC,KAAcjC,KAAK,SAAUC,GAC3G,IAAIiC,EAAkBjC,EAAGiC,gBACzB,OAAOA,EAAgBH,OAG/B,GAAInD,EAAU,CACVS,WAAWT,EAAU,MAE1BuD,MAAM,SAAUC,GACf,IAAIC,EAAIC,MAAM,8BACdC,QAAQC,MAAMH,GACd1E,OAAO8E,IAAIC,WAAWL,GACtB,MAAMD,IAGd9E,EAAQ8B,KAAOA","file":"node_modules/nodebb-plugin-emoji/build/public/lib/emoji.js","sourcesContent":["/// <amd-module name=\"emoji\"/>\r\ndefine(\"emoji\", [\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    var base = window.config.relative_path + \"/plugins/nodebb-plugin-emoji\";\r\n    exports.base = base;\r\n    var buster = window.config['cache-buster'];\r\n    exports.buster = buster;\r\n    function buildEmoji(emoji, defer) {\r\n        var whole = \":\" + emoji.name + \":\";\r\n        var deferClass = defer ? ' defer' : '';\r\n        if (emoji.image) {\r\n            return \"<img\\n      \" + (defer ? 'data-' : '') + \"src=\\\"\" + base + \"/emoji/\" + emoji.pack + \"/\" + emoji.image + \"?\" + buster + \"\\\"\\n      class=\\\"not-responsive emoji emoji-\" + emoji.pack + \" emoji--\" + emoji.name + \" \" + deferClass + \"\\\"\\n      title=\\\"\" + whole + \"\\\"\\n      alt=\\\"\" + emoji.character + \"\\\"\\n    />\";\r\n        }\r\n        return \"<span\\n    class=\\\"emoji-\" + emoji.pack + \" emoji--\" + emoji.name + \"\\\"\\n    title=\\\"\" + whole + \"\\\"\\n  ><span>\" + emoji.character + \"</span></span>\";\r\n    }\r\n    exports.buildEmoji = buildEmoji;\r\n    exports.strategy = {\r\n        match: /\\B:([^\\s\\n:]+)$/,\r\n        search: function (term, callback) {\r\n            callback(exports.search(term.toLowerCase().replace(/[_-]/g, '')).slice(0, 10));\r\n        },\r\n        index: 1,\r\n        replace: function (emoji) {\r\n            return \":\" + emoji.name + \": \";\r\n        },\r\n        template: function (emoji) {\r\n            return buildEmoji(emoji) + \" \" + emoji.name;\r\n        },\r\n        cache: true,\r\n    };\r\n    var initialized = false;\r\n    function init(callback) {\r\n        if (initialized) {\r\n            if (callback) {\r\n                setTimeout(callback, 0);\r\n            }\r\n            return;\r\n        }\r\n        initialized = true;\r\n        Promise.all([\r\n            new Promise(function (resolve_1, reject_1) { require(['fuzzysearch'], resolve_1, reject_1); }),\r\n            new Promise(function (resolve_2, reject_2) { require(['leven'], resolve_2, reject_2); }),\r\n            new Promise(function (resolve_3, reject_3) { require(['composer/formatting'], resolve_3, reject_3); }),\r\n            $.getJSON(base + \"/emoji/table.json?\" + buster),\r\n        ]).then(function (_a) {\r\n            var fuzzy = _a[0], leven = _a[1], formatting = _a[2], tableData = _a[3];\r\n            exports.table = tableData;\r\n            var all = Object.keys(exports.table).map(function (name) {\r\n                var emoji = exports.table[name];\r\n                return {\r\n                    name: name,\r\n                    aliases: emoji.aliases,\r\n                    keywords: emoji.keywords,\r\n                    character: emoji.character,\r\n                    image: emoji.image,\r\n                    pack: emoji.pack,\r\n                };\r\n            });\r\n            function fuzzyFind(term, arr) {\r\n                var l = arr.length;\r\n                for (var i = 0; i < l; i += 1) {\r\n                    if (fuzzy(term, arr[i])) {\r\n                        return arr[i];\r\n                    }\r\n                }\r\n                return null;\r\n            }\r\n            function fuzzySearch(term) {\r\n                function score(match, weight) {\r\n                    var weighted = weight * (1 + leven(term, match));\r\n                    return match.startsWith(term) ? weighted - 2 : weighted;\r\n                }\r\n                return all.filter(function (obj) {\r\n                    if (fuzzy(term, obj.name)) {\r\n                        obj.score = score(obj.name, 1);\r\n                        return true;\r\n                    }\r\n                    var aliasMatch = fuzzyFind(term, obj.aliases);\r\n                    if (aliasMatch) {\r\n                        obj.score = score(aliasMatch, 3);\r\n                        return true;\r\n                    }\r\n                    var keywordMatch = fuzzyFind(term, obj.keywords);\r\n                    if (keywordMatch) {\r\n                        obj.score = score(keywordMatch, 7);\r\n                        return true;\r\n                    }\r\n                    return false;\r\n                }).sort(function (a, b) { return a.score - b.score; }).sort(function (a, b) {\r\n                    var aPrefixed = +a.name.startsWith(term);\r\n                    var bPrefixed = +b.name.startsWith(term);\r\n                    return bPrefixed - aPrefixed;\r\n                });\r\n            }\r\n            exports.search = fuzzySearch;\r\n            formatting.addButtonDispatch('emoji-add-emoji', function (textarea) {\r\n                new Promise(function (resolve_4, reject_4) { require(['emoji-dialog'], resolve_4, reject_4); }).then(function (_a) {\r\n                    var toggleForInsert = _a.toggleForInsert;\r\n                    return toggleForInsert(textarea);\r\n                });\r\n            });\r\n            if (callback) {\r\n                setTimeout(callback, 0);\r\n            }\r\n        }).catch(function (err) {\r\n            var e = Error('[[emoji:meta-load-failed]]');\r\n            console.error(e);\r\n            window.app.alertError(e);\r\n            throw err;\r\n        });\r\n    }\r\n    exports.init = init;\r\n});\r\n//# sourceMappingURL=emoji.js.map"]}