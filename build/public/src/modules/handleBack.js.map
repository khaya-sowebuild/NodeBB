{"version":3,"sources":["public/src/modules/handleBack.js"],"names":["define","components","storage","navigator","pagination","handleBack","loadTopicsMethod","init","_loadTopicsMethod","saveClickedIndex","$","window","off","onBackClicked","on","clickedIndex","this","parents","attr","each","index","el","offset","top","scrollTop","setItem","ajaxify","data","template","category","recent","bookmarkIndex","getItem","removeItem","utils","isNumber","Math","max","parseInt","config","usePagination","page","ceil","topicsPerPage","currentPage","loadPage","scrollToTopic","highlightTopic","empty","one","topicIndex","highlight","get","length","hasClass","addClass","setTimeout","removeClass","duration","scrollTo","animate","undefined","update"],"mappings":"AAAA,aAEAA,OAAO,cACN,aACA,UACA,YACA,oBACE,SAAUC,EAAYC,EAASC,EAAWC,GAC5C,IAAIC,KACJ,IAAIC,EAEJD,EAAWE,KAAO,SAAUC,GAC3BF,EAAmBE,EACnBC,IACAC,EAAEC,QAAQC,IAAI,kBAAmBC,GAAeC,GAAG,kBAAmBD,IAGvE,SAASJ,IACRC,EAAE,0BAA0BI,GAAG,QAAS,6BAA8B,WACrE,IAAIC,EAAeL,EAAEM,MAAMC,QAAQ,gBAAgBC,KAAK,cACxDR,EAAE,gCAAgCS,KAAK,SAAUC,EAAOC,GACvD,GAAIX,EAAEW,GAAIC,SAASC,IAAMb,EAAEC,QAAQa,YAAc,EAAG,CACnDtB,EAAQuB,QAAQ,oBAAqBf,EAAEW,GAAIH,KAAK,eAChDhB,EAAQuB,QAAQ,4BAA6BV,GAC7C,OAAO,WAMX,SAASF,IACR,GAAKa,QAAQC,KAAKC,SAASC,UAAYH,QAAQC,KAAKC,SAASE,OAAS,CACrE,IAAIC,EAAgB7B,EAAQ8B,QAAQ,qBACpC,IAAIjB,EAAeb,EAAQ8B,QAAQ,6BAEnC9B,EAAQ+B,WAAW,qBACnB/B,EAAQ+B,WAAW,6BACnB,IAAKC,MAAMC,SAASJ,GAAgB,CACnC,OAGDA,EAAgBK,KAAKC,IAAI,EAAGC,SAASP,EAAe,KAAO,GAC3DhB,EAAeqB,KAAKC,IAAI,EAAGC,SAASvB,EAAc,KAAO,GAEzD,IAAKgB,IAAkBhB,EAAc,CACpC,OAGD,GAAIwB,OAAOC,cAAe,CACzB,IAAIC,EAAOL,KAAKM,MAAMJ,SAASP,EAAe,IAAM,GAAKQ,OAAOI,eAChE,GAAIL,SAASG,EAAM,MAAQf,QAAQC,KAAKvB,WAAWwC,YAAa,CAC/DxC,EAAWyC,SAASJ,EAAM,WACzBpC,EAAWyC,cAAcf,EAAehB,EAAc,SAEjD,CACNV,EAAWyC,cAAcf,EAAehB,EAAc,QAEjD,CACN,GAAIgB,IAAkB,EAAG,CACxB1B,EAAW0C,eAAehC,GAC1B,OAGDL,EAAE,0BAA0BsC,QAC5B1C,EAAiB8B,KAAKC,IAAI,EAAGN,EAAgB,GAAK,EAAG,WACpDrB,EAAEC,QAAQsC,IAAI,uBAAwB,WACrC5C,EAAWyC,cAAcf,EAAehB,EAAc,SAO3DV,EAAW0C,eAAiB,SAAUG,GACrC,IAAIC,EAAYlD,EAAWmD,IAAI,iBAAkB,QAASF,GAE1D,GAAIC,EAAUE,SAAWF,EAAUG,SAAS,aAAc,CACzDH,EAAUI,SAAS,aACnBC,WAAW,WACVL,EAAUM,YAAY,cACpB,OAILpD,EAAWyC,cAAgB,SAAUf,EAAehB,EAAc2C,EAAUpC,GAC3E,IAAKY,MAAMC,SAASJ,GAAgB,CACnC,OAGD,IAAKT,EAAQ,CACZA,EAAS,EAGV,IAAIqC,EAAW1D,EAAWmD,IAAI,iBAAkB,QAASrB,GAEzD,GAAI4B,EAASN,OAAQ,CACpB3C,EAAE,cAAckD,SACfpC,UAAYmC,EAASrC,SAASC,IAAMD,EAAU,MAC5CoC,IAAaG,UAAYH,EAAW,IAAK,WAC3CrD,EAAW0C,eAAehC,GAC1BZ,EAAU2D,aAKb,OAAOzD","file":"public/src/modules/handleBack.js","sourcesContent":["'use strict';\r\n\r\ndefine('handleBack', [\r\n\t'components',\r\n\t'storage',\r\n\t'navigator',\r\n\t'forum/pagination',\r\n], function (components, storage, navigator, pagination) {\r\n\tvar handleBack = {};\r\n\tvar loadTopicsMethod;\r\n\r\n\thandleBack.init = function (_loadTopicsMethod) {\r\n\t\tloadTopicsMethod = _loadTopicsMethod;\r\n\t\tsaveClickedIndex();\r\n\t\t$(window).off('action:popstate', onBackClicked).on('action:popstate', onBackClicked);\r\n\t};\r\n\r\n\tfunction saveClickedIndex() {\r\n\t\t$('[component=\"category\"]').on('click', '[component=\"topic/header\"]', function () {\r\n\t\t\tvar clickedIndex = $(this).parents('[data-index]').attr('data-index');\r\n\t\t\t$('[component=\"category/topic\"]').each(function (index, el) {\r\n\t\t\t\tif ($(el).offset().top - $(window).scrollTop() > 0) {\r\n\t\t\t\t\tstorage.setItem('category:bookmark', $(el).attr('data-index'));\r\n\t\t\t\t\tstorage.setItem('category:bookmark:clicked', clickedIndex);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction onBackClicked() {\r\n\t\tif ((ajaxify.data.template.category || ajaxify.data.template.recent)) {\r\n\t\t\tvar bookmarkIndex = storage.getItem('category:bookmark');\r\n\t\t\tvar clickedIndex = storage.getItem('category:bookmark:clicked');\r\n\r\n\t\t\tstorage.removeItem('category:bookmark');\r\n\t\t\tstorage.removeItem('category:bookmark:clicked');\r\n\t\t\tif (!utils.isNumber(bookmarkIndex)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tbookmarkIndex = Math.max(0, parseInt(bookmarkIndex, 10) || 0);\r\n\t\t\tclickedIndex = Math.max(0, parseInt(clickedIndex, 10) || 0);\r\n\r\n\t\t\tif (!bookmarkIndex && !clickedIndex) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (config.usePagination) {\r\n\t\t\t\tvar page = Math.ceil((parseInt(bookmarkIndex, 10) + 1) / config.topicsPerPage);\r\n\t\t\t\tif (parseInt(page, 10) !== ajaxify.data.pagination.currentPage) {\r\n\t\t\t\t\tpagination.loadPage(page, function () {\r\n\t\t\t\t\t\thandleBack.scrollToTopic(bookmarkIndex, clickedIndex, 0);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\thandleBack.scrollToTopic(bookmarkIndex, clickedIndex, 0);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (bookmarkIndex === 0) {\r\n\t\t\t\t\thandleBack.highlightTopic(clickedIndex);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$('[component=\"category\"]').empty();\r\n\t\t\t\tloadTopicsMethod(Math.max(0, bookmarkIndex - 1) + 1, function () {\r\n\t\t\t\t\t$(window).one('action:topics.loaded', function () {\r\n\t\t\t\t\t\thandleBack.scrollToTopic(bookmarkIndex, clickedIndex, 0);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\thandleBack.highlightTopic = function (topicIndex) {\r\n\t\tvar highlight = components.get('category/topic', 'index', topicIndex);\r\n\r\n\t\tif (highlight.length && !highlight.hasClass('highlight')) {\r\n\t\t\thighlight.addClass('highlight');\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\thighlight.removeClass('highlight');\r\n\t\t\t}, 5000);\r\n\t\t}\r\n\t};\r\n\r\n\thandleBack.scrollToTopic = function (bookmarkIndex, clickedIndex, duration, offset) {\r\n\t\tif (!utils.isNumber(bookmarkIndex)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!offset) {\r\n\t\t\toffset = 0;\r\n\t\t}\r\n\r\n\t\tvar scrollTo = components.get('category/topic', 'index', bookmarkIndex);\r\n\r\n\t\tif (scrollTo.length) {\r\n\t\t\t$('html, body').animate({\r\n\t\t\t\tscrollTop: (scrollTo.offset().top - offset) + 'px',\r\n\t\t\t}, duration !== undefined ? duration : 400, function () {\r\n\t\t\t\thandleBack.highlightTopic(clickedIndex);\r\n\t\t\t\tnavigator.update();\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\treturn handleBack;\r\n});\r\n"]}