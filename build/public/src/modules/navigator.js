"use strict";define("navigator",["forum/pagination","components"],function(o,t){var n={};var e=1;var i=0;var a;n.scrollActive=false;$(window).on("action:ajaxify.start",function(){$(window).off("keydown",l)});n.init=function(o,t,i,a,l,s){e=1;n.selector=o;n.callback=l;n.toTop=i||function(){};n.toBottom=a||function(){};$(window).off("scroll",n.delayedUpdate).on("scroll",n.delayedUpdate);$(".pagination-block .dropdown-menu").off("click").on("click",function(o){o.stopPropagation()});$(".pagination-block").off("shown.bs.dropdown",".dropdown").on("shown.bs.dropdown",".dropdown",function(){setTimeout(function(){$(".pagination-block input").focus()},100)});$(".pagination-block .pageup").off("click").on("click",n.scrollUp);$(".pagination-block .pagedown").off("click").on("click",n.scrollDown);$(".pagination-block .pagetop").off("click").on("click",n.toTop);$(".pagination-block .pagebottom").off("click").on("click",n.toBottom);$(".pagination-block input").on("keydown",function(o){if(o.which===13){var n=$(this);if(!utils.isNumber(n.val())){n.val("");return}var e=parseInt(n.val(),10);if(typeof s==="function"){e=s(e,t)}var i=c(e);n.val("");$(".pagination-block .dropdown-toggle").trigger("click");ajaxify.go(i)}});r();n.setCount(t);n.update(0)};function r(){if(!config.usePagination){$(window).off("keydown",l).on("keydown",l)}}function l(o){if(o.target.nodeName==="BODY"){if(o.shiftKey||o.ctrlKey||o.altKey){return}if(o.which===36&&n.toTop){n.toTop();return false}else if(o.which===35&&n.toBottom){n.toBottom();return false}}}function c(o){var t=window.location.pathname.replace(config.relative_path,"");var n=t.split("/");return n[1]+"/"+n[2]+"/"+n[3]+(o?"/"+o:"")}n.setCount=function(o){i=parseInt(o,10);n.updateTextAndProgressBar()};n.show=function(){s(true)};n.disable=function(){i=0;e=1;n.callback=null;n.selector=null;$(window).off("scroll",n.delayedUpdate);s(false)};function s(o){var t=ajaxify.removeRelativePath(window.location.pathname.slice(1));if(o&&(!t.startsWith("topic")&&!t.startsWith("category"))){return}$(".pagination-block").toggleClass("ready",o)}n.delayedUpdate=function(){if(!a){a=setTimeout(function(){n.update();a=undefined},100)}};n.update=function(o){o=typeof o==="number"?o:undefined;var a=$(n.selector);if(a.length){e=parseInt(a.first().attr("data-index"),10)+1}var r=$(window).scrollTop();var l=$(window).height();var c=$(document).height();var f=r+l/2;var p=Number.MAX_VALUE;a.each(function(){var o=Math.abs(f-$(this).offset().top);if(o>p){return false}if(o<p){e=parseInt($(this).attr("data-index"),10)+1;p=o}});var d=r===0&&parseInt(a.first().attr("data-index"),10)===0;var u=r+l>c-100&&parseInt(a.last().attr("data-index"),10)===i-1;if(d){e=1}else if(u){e=i}if(o===undefined&&ajaxify.data.template.topic===true){if(d){o=0}else{var g=t.get("post/anchor",e-1);if(g.length){var h=g.get(0).getBoundingClientRect();o=h.top}}}if(typeof n.callback==="function"){n.callback(e,i,o)}n.updateTextAndProgressBar();s(!!i)};n.updateTextAndProgressBar=function(){if(!utils.isNumber(e)){return}e=e>i?i:e;var o=f();$(".pagination-block .pagination-text").translateHtml("[[global:pagination.out_of, "+o+", "+i+"]]");var t=(o-1)/(i-1||1);$(".pagination-block meter").val(t);$(".pagination-block .progress-bar").width(t*100+"%")};function f(){var o=e;if(o===1){return 1}if(ajaxify.data.template.topic){if(config.topicPostSort==="most_votes"||config.topicPostSort==="newest_to_oldest"){o=ajaxify.data.postcount-e+2}}return o}n.scrollUp=function(){var t=$(window);if(config.usePagination){var n=t.scrollTop()<=0;if(n){return o.previousPage(function(){$("body,html").scrollTop($(document).height()-t.height())})}}$("body,html").animate({scrollTop:t.scrollTop()-t.height()})};n.scrollDown=function(){var t=$(window);if(config.usePagination){var n=t.scrollTop()>=$(document).height()-t.height();if(n){return o.nextPage()}}$("body,html").animate({scrollTop:t.scrollTop()+t.height()})};n.scrollTop=function(o){if($(n.selector+'[data-index="'+o+'"]').length){n.scrollToIndex(o,true)}else{ajaxify.go(c())}};n.scrollBottom=function(o){if(parseInt(o,10)<0){return}if($(n.selector+'[data-index="'+o+'"]').length){n.scrollToIndex(o,true)}else{o=parseInt(o,10)+1;ajaxify.go(c(o))}};n.scrollToIndex=function(e,i,a){var r=!!t.get("topic").length;var l=!!t.get("category").length;if(!utils.isNumber(e)||!r&&!l){return}a=a!==undefined?a:400;n.scrollActive=true;if(r&&t.get("post/anchor",e).length){return n.scrollToPostIndex(e,i,a)}if(l&&$('[component="category/topic"][data-index="'+e+'"]').length){return n.scrollToTopicIndex(e,i,a)}if(!config.usePagination){n.scrollActive=false;e=parseInt(e,10)+1;ajaxify.go(c(e));return}var s=r?n.scrollToPostIndex:n.scrollToTopicIndex;if(r){if(config.topicPostSort==="most_votes"||config.topicPostSort==="newest_to_oldest"){e=ajaxify.data.postcount-e}}else if(l){if(config.categoryTopicSort==="most_posts"||config.categoryTopicSort==="oldest_to_newest"){e=ajaxify.data.topic_count-e}}var f=Math.max(1,Math.ceil((e+1)/config.postsPerPage));if(parseInt(f,10)!==ajaxify.data.pagination.currentPage){o.loadPage(f,function(){s(e,i,a)})}else{s(e,i,a)}};n.scrollToPostIndex=function(o,e,i){var a=t.get("post","index",o);n.scrollToElement(a,e,i)};n.scrollToTopicIndex=function(o,t,e){var i=$('[component="category/topic"][data-index="'+o+'"]');n.scrollToElement(i,t,e)};n.scrollToElement=function(o,e,i){if(!o.length){n.scrollActive=false;return}var a=o.height();var r=$(window).height();var l=t.get("navbar").height();$(window).off("scroll",n.update);i=i!==undefined?i:400;n.scrollActive=true;var c=false;function s(){var t=0;if(a<r){t=o.offset().top-r/2+a/2}else{t=o.offset().top-l}$("html, body").animate({scrollTop:t+"px"},i,function(){if(c){$(window).on("scroll",n.update);var t=o.get(0).getBoundingClientRect();n.update(t.top);return}c=true;n.scrollActive=false;f();$("body").scrollTop($("body").scrollTop()-1);$("html").scrollTop($("html").scrollTop()-1)})}function f(){if(e){o.addClass("highlight");setTimeout(function(){o.removeClass("highlight")},1e4)}}s()};return n});
//# sourceMappingURL=public/src/modules/navigator.js.map